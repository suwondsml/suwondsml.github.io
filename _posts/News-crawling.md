---
layout: post
title: News-crawling
authors: [Soyoung Lee]
categories: [1기 AI/SW developers(개인 프로젝트)]
---

{
 "cells": [
  {
   "cell_type": "code",
   "execution_count": 1,
   "id": "f116bcc4",
   "metadata": {},
   "outputs": [],
   "source": [
    "import pandas_datareader as wb\n",
    "import pandas as pd\n",
    "import datetime\n",
    "import matplotlib.pyplot as plt\n",
    "import os"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "d7441b7a",
   "metadata": {},
   "source": [
    "!pip install pandas_datareader"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "4d2dcdad",
   "metadata": {},
   "source": [
    "## 데이터 불러오기"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 2,
   "id": "da61b4ff",
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/html": [
       "<div>\n",
       "<style scoped>\n",
       "    .dataframe tbody tr th:only-of-type {\n",
       "        vertical-align: middle;\n",
       "    }\n",
       "\n",
       "    .dataframe tbody tr th {\n",
       "        vertical-align: top;\n",
       "    }\n",
       "\n",
       "    .dataframe thead th {\n",
       "        text-align: right;\n",
       "    }\n",
       "</style>\n",
       "<table border=\"1\" class=\"dataframe\">\n",
       "  <thead>\n",
       "    <tr style=\"text-align: right;\">\n",
       "      <th></th>\n",
       "      <th>종목명</th>\n",
       "      <th>거래일자</th>\n",
       "      <th>종가</th>\n",
       "      <th>시가</th>\n",
       "      <th>저가</th>\n",
       "      <th>고가</th>\n",
       "      <th>등락률</th>\n",
       "    </tr>\n",
       "  </thead>\n",
       "  <tbody>\n",
       "    <tr>\n",
       "      <th>13</th>\n",
       "      <td>동화약품보통주</td>\n",
       "      <td>20200319</td>\n",
       "      <td>4985</td>\n",
       "      <td>5630</td>\n",
       "      <td>4800</td>\n",
       "      <td>6450</td>\n",
       "      <td>0.129388</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>8</th>\n",
       "      <td>동화약품보통주</td>\n",
       "      <td>20200312</td>\n",
       "      <td>6420</td>\n",
       "      <td>6760</td>\n",
       "      <td>6300</td>\n",
       "      <td>6760</td>\n",
       "      <td>0.052960</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>10</th>\n",
       "      <td>동화약품보통주</td>\n",
       "      <td>20200316</td>\n",
       "      <td>5710</td>\n",
       "      <td>5870</td>\n",
       "      <td>5700</td>\n",
       "      <td>6050</td>\n",
       "      <td>0.028021</td>\n",
       "    </tr>\n",
       "  </tbody>\n",
       "</table>\n",
       "</div>"
      ],
      "text/plain": [
       "        종목명      거래일자    종가    시가    저가    고가       등락률\n",
       "13  동화약품보통주  20200319  4985  5630  4800  6450  0.129388\n",
       "8   동화약품보통주  20200312  6420  6760  6300  6760  0.052960\n",
       "10  동화약품보통주  20200316  5710  5870  5700  6050  0.028021"
      ]
     },
     "execution_count": 2,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "path_유가증권_1=\"C:\\KRX예선데이터\\KRX예선데이터\\주식\\[유가증권]일별 시세정보(주문번호-1300-27)/\"\n",
    "\n",
    "file_list=os.listdir(path_유가증권_1)\n",
    "file_list=[file for file in file_list if file.endswith(\".csv\")] \n",
    "\n",
    "for file in file_list:\n",
    "    df_11 = pd.read_csv(path_유가증권_1+file, encoding=\"cp949\").sort_values(\"거래량\", ascending=False)[[\"종목명\",\"거래일자\",\"종가\",\"시가\",\"저가\",\"고가\"]]\n",
    "    df_11 = pd.DataFrame(df_11)\n",
    "\n",
    "df_11['등락률'] = (df_11['시가']-df_11['종가'])/df_11['종가']\n",
    "df_11[df_11['종목명']=='동화약품보통주'].head(3)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 3,
   "id": "47478def",
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/html": [
       "<div>\n",
       "<style scoped>\n",
       "    .dataframe tbody tr th:only-of-type {\n",
       "        vertical-align: middle;\n",
       "    }\n",
       "\n",
       "    .dataframe tbody tr th {\n",
       "        vertical-align: top;\n",
       "    }\n",
       "\n",
       "    .dataframe thead th {\n",
       "        text-align: right;\n",
       "    }\n",
       "</style>\n",
       "<table border=\"1\" class=\"dataframe\">\n",
       "  <thead>\n",
       "    <tr style=\"text-align: right;\">\n",
       "      <th></th>\n",
       "      <th>종목명</th>\n",
       "      <th>거래일자</th>\n",
       "      <th>종가</th>\n",
       "      <th>시가</th>\n",
       "      <th>저가</th>\n",
       "      <th>고가</th>\n",
       "      <th>등락률</th>\n",
       "    </tr>\n",
       "  </thead>\n",
       "  <tbody>\n",
       "    <tr>\n",
       "      <th>4</th>\n",
       "      <td>동화약품보통주</td>\n",
       "      <td>20210308</td>\n",
       "      <td>14400</td>\n",
       "      <td>15200</td>\n",
       "      <td>14400</td>\n",
       "      <td>17200</td>\n",
       "      <td>0.055556</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>5</th>\n",
       "      <td>동화약품보통주</td>\n",
       "      <td>20210309</td>\n",
       "      <td>14750</td>\n",
       "      <td>14900</td>\n",
       "      <td>14050</td>\n",
       "      <td>15300</td>\n",
       "      <td>0.010169</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>6</th>\n",
       "      <td>동화약품보통주</td>\n",
       "      <td>20210310</td>\n",
       "      <td>14200</td>\n",
       "      <td>14800</td>\n",
       "      <td>14200</td>\n",
       "      <td>14850</td>\n",
       "      <td>0.042254</td>\n",
       "    </tr>\n",
       "  </tbody>\n",
       "</table>\n",
       "</div>"
      ],
      "text/plain": [
       "       종목명      거래일자     종가     시가     저가     고가       등락률\n",
       "4  동화약품보통주  20210308  14400  15200  14400  17200  0.055556\n",
       "5  동화약품보통주  20210309  14750  14900  14050  15300  0.010169\n",
       "6  동화약품보통주  20210310  14200  14800  14200  14850  0.042254"
      ]
     },
     "execution_count": 3,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "path_유가증권_2=\"C:\\KRX예선데이터\\KRX예선데이터\\주식\\[유가증권]일별 시세정보(주문번호-1300-30)/\"\n",
    "\n",
    "file_list=os.listdir(path_유가증권_2)\n",
    "file_list=[file for file in file_list if file.endswith(\".csv\")] \n",
    "\n",
    "for file in file_list:\n",
    "    df_12 = pd.read_csv(path_유가증권_2+file, encoding=\"cp949\").sort_values(\"거래량\", ascending=False)[[\"종목명\",\"거래일자\",\"종가\",\"시가\",\"저가\",\"고가\"]]\n",
    "    df_12 = pd.DataFrame(df_12)\n",
    "\n",
    "df_12['등락률'] = (df_12['시가']-df_12['종가'])/df_12['종가']\n",
    "df_12[df_12['종목명']=='동화약품보통주'].head(3)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 4,
   "id": "65695382",
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/html": [
       "<div>\n",
       "<style scoped>\n",
       "    .dataframe tbody tr th:only-of-type {\n",
       "        vertical-align: middle;\n",
       "    }\n",
       "\n",
       "    .dataframe tbody tr th {\n",
       "        vertical-align: top;\n",
       "    }\n",
       "\n",
       "    .dataframe thead th {\n",
       "        text-align: right;\n",
       "    }\n",
       "</style>\n",
       "<table border=\"1\" class=\"dataframe\">\n",
       "  <thead>\n",
       "    <tr style=\"text-align: right;\">\n",
       "      <th></th>\n",
       "      <th>종목명</th>\n",
       "      <th>거래일자</th>\n",
       "      <th>종가</th>\n",
       "      <th>시가</th>\n",
       "      <th>저가</th>\n",
       "      <th>고가</th>\n",
       "      <th>등락률</th>\n",
       "    </tr>\n",
       "  </thead>\n",
       "  <tbody>\n",
       "    <tr>\n",
       "      <th>11</th>\n",
       "      <td>동화약품보통주</td>\n",
       "      <td>20220318</td>\n",
       "      <td>14350</td>\n",
       "      <td>14050</td>\n",
       "      <td>13600</td>\n",
       "      <td>15350</td>\n",
       "      <td>-0.020906</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>10</th>\n",
       "      <td>동화약품보통주</td>\n",
       "      <td>20220317</td>\n",
       "      <td>13550</td>\n",
       "      <td>13350</td>\n",
       "      <td>13200</td>\n",
       "      <td>14300</td>\n",
       "      <td>-0.014760</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>12</th>\n",
       "      <td>동화약품보통주</td>\n",
       "      <td>20220321</td>\n",
       "      <td>13850</td>\n",
       "      <td>14450</td>\n",
       "      <td>13800</td>\n",
       "      <td>14550</td>\n",
       "      <td>0.043321</td>\n",
       "    </tr>\n",
       "  </tbody>\n",
       "</table>\n",
       "</div>"
      ],
      "text/plain": [
       "        종목명      거래일자     종가     시가     저가     고가       등락률\n",
       "11  동화약품보통주  20220318  14350  14050  13600  15350 -0.020906\n",
       "10  동화약품보통주  20220317  13550  13350  13200  14300 -0.014760\n",
       "12  동화약품보통주  20220321  13850  14450  13800  14550  0.043321"
      ]
     },
     "execution_count": 4,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "path_유가증권_3=\"C:\\KRX예선데이터\\KRX예선데이터\\주식\\[유가증권]일별 시세정보(주문번호-1300-33)/\"\n",
    "\n",
    "file_list=os.listdir(path_유가증권_3)\n",
    "file_list=[file for file in file_list if file.endswith(\".csv\")] \n",
    "\n",
    "for file in file_list:\n",
    "    df_13 = pd.read_csv(path_유가증권_3+file, encoding=\"cp949\").sort_values(\"거래량\", ascending=False)[[\"종목명\",\"거래일자\",\"종가\",\"시가\",\"저가\",\"고가\"]]\n",
    "    df_13 = pd.DataFrame(df_13)\n",
    "\n",
    "df_13['등락률'] = (df_13['시가']-df_13['종가'])/df_13['종가']\n",
    "df_13[df_13['종목명']=='동화약품보통주'].head(3)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 5,
   "id": "004459a8",
   "metadata": {},
   "outputs": [],
   "source": [
    "df11 = df_11[df_11['종목명']=='동화약품보통주']\n",
    "df12 = df_12[df_12['종목명']=='동화약품보통주']\n",
    "df13 = df_13[df_13['종목명']=='동화약품보통주']"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 6,
   "id": "765b7138",
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/html": [
       "<div>\n",
       "<style scoped>\n",
       "    .dataframe tbody tr th:only-of-type {\n",
       "        vertical-align: middle;\n",
       "    }\n",
       "\n",
       "    .dataframe tbody tr th {\n",
       "        vertical-align: top;\n",
       "    }\n",
       "\n",
       "    .dataframe thead th {\n",
       "        text-align: right;\n",
       "    }\n",
       "</style>\n",
       "<table border=\"1\" class=\"dataframe\">\n",
       "  <thead>\n",
       "    <tr style=\"text-align: right;\">\n",
       "      <th></th>\n",
       "      <th>종목명</th>\n",
       "      <th>거래일자</th>\n",
       "      <th>종가</th>\n",
       "      <th>시가</th>\n",
       "      <th>저가</th>\n",
       "      <th>고가</th>\n",
       "      <th>등락률</th>\n",
       "    </tr>\n",
       "  </thead>\n",
       "  <tbody>\n",
       "    <tr>\n",
       "      <th>0</th>\n",
       "      <td>동화약품보통주</td>\n",
       "      <td>20200319</td>\n",
       "      <td>4985</td>\n",
       "      <td>5630</td>\n",
       "      <td>4800</td>\n",
       "      <td>6450</td>\n",
       "      <td>0.129388</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>1</th>\n",
       "      <td>동화약품보통주</td>\n",
       "      <td>20200312</td>\n",
       "      <td>6420</td>\n",
       "      <td>6760</td>\n",
       "      <td>6300</td>\n",
       "      <td>6760</td>\n",
       "      <td>0.052960</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2</th>\n",
       "      <td>동화약품보통주</td>\n",
       "      <td>20200316</td>\n",
       "      <td>5710</td>\n",
       "      <td>5870</td>\n",
       "      <td>5700</td>\n",
       "      <td>6050</td>\n",
       "      <td>0.028021</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>3</th>\n",
       "      <td>동화약품보통주</td>\n",
       "      <td>20200313</td>\n",
       "      <td>5870</td>\n",
       "      <td>5960</td>\n",
       "      <td>5560</td>\n",
       "      <td>6150</td>\n",
       "      <td>0.015332</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>4</th>\n",
       "      <td>동화약품보통주</td>\n",
       "      <td>20200326</td>\n",
       "      <td>5900</td>\n",
       "      <td>5720</td>\n",
       "      <td>5540</td>\n",
       "      <td>6050</td>\n",
       "      <td>-0.030508</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>...</th>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>60</th>\n",
       "      <td>동화약품보통주</td>\n",
       "      <td>20220302</td>\n",
       "      <td>12800</td>\n",
       "      <td>12650</td>\n",
       "      <td>12600</td>\n",
       "      <td>12900</td>\n",
       "      <td>-0.011719</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>61</th>\n",
       "      <td>동화약품보통주</td>\n",
       "      <td>20220308</td>\n",
       "      <td>12850</td>\n",
       "      <td>12700</td>\n",
       "      <td>12600</td>\n",
       "      <td>13050</td>\n",
       "      <td>-0.011673</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>62</th>\n",
       "      <td>동화약품보통주</td>\n",
       "      <td>20220314</td>\n",
       "      <td>12550</td>\n",
       "      <td>12850</td>\n",
       "      <td>12500</td>\n",
       "      <td>12850</td>\n",
       "      <td>0.023904</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>63</th>\n",
       "      <td>동화약품보통주</td>\n",
       "      <td>20220310</td>\n",
       "      <td>12900</td>\n",
       "      <td>13000</td>\n",
       "      <td>12850</td>\n",
       "      <td>13050</td>\n",
       "      <td>0.007752</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>64</th>\n",
       "      <td>동화약품보통주</td>\n",
       "      <td>20220311</td>\n",
       "      <td>12850</td>\n",
       "      <td>12900</td>\n",
       "      <td>12750</td>\n",
       "      <td>13050</td>\n",
       "      <td>0.003891</td>\n",
       "    </tr>\n",
       "  </tbody>\n",
       "</table>\n",
       "<p>65 rows × 7 columns</p>\n",
       "</div>"
      ],
      "text/plain": [
       "        종목명      거래일자     종가     시가     저가     고가       등락률\n",
       "0   동화약품보통주  20200319   4985   5630   4800   6450  0.129388\n",
       "1   동화약품보통주  20200312   6420   6760   6300   6760  0.052960\n",
       "2   동화약품보통주  20200316   5710   5870   5700   6050  0.028021\n",
       "3   동화약품보통주  20200313   5870   5960   5560   6150  0.015332\n",
       "4   동화약품보통주  20200326   5900   5720   5540   6050 -0.030508\n",
       "..      ...       ...    ...    ...    ...    ...       ...\n",
       "60  동화약품보통주  20220302  12800  12650  12600  12900 -0.011719\n",
       "61  동화약품보통주  20220308  12850  12700  12600  13050 -0.011673\n",
       "62  동화약품보통주  20220314  12550  12850  12500  12850  0.023904\n",
       "63  동화약품보통주  20220310  12900  13000  12850  13050  0.007752\n",
       "64  동화약품보통주  20220311  12850  12900  12750  13050  0.003891\n",
       "\n",
       "[65 rows x 7 columns]"
      ]
     },
     "execution_count": 6,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "df = pd.concat([df11, df12, df13])\n",
    "df = df.reset_index(drop = True)\n",
    "df"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 7,
   "id": "bcfd46e0",
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/plain": [
       "0.0035760191805379814"
      ]
     },
     "execution_count": 7,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "df_mean = df['등락률'].mean()\n",
    "df_mean"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 8,
   "id": "8cda1e42",
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/plain": [
       "[-0.024287283327218974, 0.031439321688294934]"
      ]
     },
     "execution_count": 8,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "[df_mean - df['등락률'].std(), df_mean + df['등락률'].std()]"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 9,
   "id": "c8b4a8d7",
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/plain": [
       "65"
      ]
     },
     "execution_count": 9,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "len(df.index)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 10,
   "id": "489f9551",
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/html": [
       "<div>\n",
       "<style scoped>\n",
       "    .dataframe tbody tr th:only-of-type {\n",
       "        vertical-align: middle;\n",
       "    }\n",
       "\n",
       "    .dataframe tbody tr th {\n",
       "        vertical-align: top;\n",
       "    }\n",
       "\n",
       "    .dataframe thead th {\n",
       "        text-align: right;\n",
       "    }\n",
       "</style>\n",
       "<table border=\"1\" class=\"dataframe\">\n",
       "  <thead>\n",
       "    <tr style=\"text-align: right;\">\n",
       "      <th></th>\n",
       "      <th>종목명</th>\n",
       "      <th>거래일자</th>\n",
       "      <th>종가</th>\n",
       "      <th>시가</th>\n",
       "      <th>저가</th>\n",
       "      <th>고가</th>\n",
       "      <th>등락률</th>\n",
       "    </tr>\n",
       "  </thead>\n",
       "  <tbody>\n",
       "    <tr>\n",
       "      <th>0</th>\n",
       "      <td>동화약품보통주</td>\n",
       "      <td>20200319</td>\n",
       "      <td>4985</td>\n",
       "      <td>5630</td>\n",
       "      <td>4800</td>\n",
       "      <td>6450</td>\n",
       "      <td>0.129388</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>1</th>\n",
       "      <td>동화약품보통주</td>\n",
       "      <td>20200312</td>\n",
       "      <td>6420</td>\n",
       "      <td>6760</td>\n",
       "      <td>6300</td>\n",
       "      <td>6760</td>\n",
       "      <td>0.052960</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2</th>\n",
       "      <td>동화약품보통주</td>\n",
       "      <td>20200316</td>\n",
       "      <td>5710</td>\n",
       "      <td>5870</td>\n",
       "      <td>5700</td>\n",
       "      <td>6050</td>\n",
       "      <td>0.028021</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>7</th>\n",
       "      <td>동화약품보통주</td>\n",
       "      <td>20200327</td>\n",
       "      <td>6130</td>\n",
       "      <td>6300</td>\n",
       "      <td>5900</td>\n",
       "      <td>6300</td>\n",
       "      <td>0.027732</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>11</th>\n",
       "      <td>동화약품보통주</td>\n",
       "      <td>20200311</td>\n",
       "      <td>6770</td>\n",
       "      <td>6980</td>\n",
       "      <td>6730</td>\n",
       "      <td>7110</td>\n",
       "      <td>0.031019</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>12</th>\n",
       "      <td>동화약품보통주</td>\n",
       "      <td>20200318</td>\n",
       "      <td>5420</td>\n",
       "      <td>5630</td>\n",
       "      <td>5420</td>\n",
       "      <td>5780</td>\n",
       "      <td>0.038745</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>20</th>\n",
       "      <td>동화약품보통주</td>\n",
       "      <td>20200309</td>\n",
       "      <td>7060</td>\n",
       "      <td>7230</td>\n",
       "      <td>7030</td>\n",
       "      <td>7230</td>\n",
       "      <td>0.024079</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>22</th>\n",
       "      <td>동화약품보통주</td>\n",
       "      <td>20210308</td>\n",
       "      <td>14400</td>\n",
       "      <td>15200</td>\n",
       "      <td>14400</td>\n",
       "      <td>17200</td>\n",
       "      <td>0.055556</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>24</th>\n",
       "      <td>동화약품보통주</td>\n",
       "      <td>20210310</td>\n",
       "      <td>14200</td>\n",
       "      <td>14800</td>\n",
       "      <td>14200</td>\n",
       "      <td>14850</td>\n",
       "      <td>0.042254</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>28</th>\n",
       "      <td>동화약품보통주</td>\n",
       "      <td>20210304</td>\n",
       "      <td>13750</td>\n",
       "      <td>14200</td>\n",
       "      <td>13600</td>\n",
       "      <td>14250</td>\n",
       "      <td>0.032727</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>30</th>\n",
       "      <td>동화약품보통주</td>\n",
       "      <td>20210302</td>\n",
       "      <td>14300</td>\n",
       "      <td>14750</td>\n",
       "      <td>14100</td>\n",
       "      <td>14750</td>\n",
       "      <td>0.031469</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>31</th>\n",
       "      <td>동화약품보통주</td>\n",
       "      <td>20210322</td>\n",
       "      <td>14650</td>\n",
       "      <td>15050</td>\n",
       "      <td>14600</td>\n",
       "      <td>15050</td>\n",
       "      <td>0.027304</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>46</th>\n",
       "      <td>동화약품보통주</td>\n",
       "      <td>20220321</td>\n",
       "      <td>13850</td>\n",
       "      <td>14450</td>\n",
       "      <td>13800</td>\n",
       "      <td>14550</td>\n",
       "      <td>0.043321</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>47</th>\n",
       "      <td>동화약품보통주</td>\n",
       "      <td>20220322</td>\n",
       "      <td>13650</td>\n",
       "      <td>13950</td>\n",
       "      <td>13550</td>\n",
       "      <td>14200</td>\n",
       "      <td>0.021978</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>52</th>\n",
       "      <td>동화약품보통주</td>\n",
       "      <td>20220331</td>\n",
       "      <td>13650</td>\n",
       "      <td>13950</td>\n",
       "      <td>13600</td>\n",
       "      <td>13950</td>\n",
       "      <td>0.021978</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>62</th>\n",
       "      <td>동화약품보통주</td>\n",
       "      <td>20220314</td>\n",
       "      <td>12550</td>\n",
       "      <td>12850</td>\n",
       "      <td>12500</td>\n",
       "      <td>12850</td>\n",
       "      <td>0.023904</td>\n",
       "    </tr>\n",
       "  </tbody>\n",
       "</table>\n",
       "</div>"
      ],
      "text/plain": [
       "        종목명      거래일자     종가     시가     저가     고가       등락률\n",
       "0   동화약품보통주  20200319   4985   5630   4800   6450  0.129388\n",
       "1   동화약품보통주  20200312   6420   6760   6300   6760  0.052960\n",
       "2   동화약품보통주  20200316   5710   5870   5700   6050  0.028021\n",
       "7   동화약품보통주  20200327   6130   6300   5900   6300  0.027732\n",
       "11  동화약품보통주  20200311   6770   6980   6730   7110  0.031019\n",
       "12  동화약품보통주  20200318   5420   5630   5420   5780  0.038745\n",
       "20  동화약품보통주  20200309   7060   7230   7030   7230  0.024079\n",
       "22  동화약품보통주  20210308  14400  15200  14400  17200  0.055556\n",
       "24  동화약품보통주  20210310  14200  14800  14200  14850  0.042254\n",
       "28  동화약품보통주  20210304  13750  14200  13600  14250  0.032727\n",
       "30  동화약품보통주  20210302  14300  14750  14100  14750  0.031469\n",
       "31  동화약품보통주  20210322  14650  15050  14600  15050  0.027304\n",
       "46  동화약품보통주  20220321  13850  14450  13800  14550  0.043321\n",
       "47  동화약품보통주  20220322  13650  13950  13550  14200  0.021978\n",
       "52  동화약품보통주  20220331  13650  13950  13600  13950  0.021978\n",
       "62  동화약품보통주  20220314  12550  12850  12500  12850  0.023904"
      ]
     },
     "execution_count": 10,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "df_upper = df[df['등락률'] > 0] # 32개\n",
    "df_upper # 상승한 날"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 11,
   "id": "33d5d780",
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/html": [
       "<div>\n",
       "<style scoped>\n",
       "    .dataframe tbody tr th:only-of-type {\n",
       "        vertical-align: middle;\n",
       "    }\n",
       "\n",
       "    .dataframe tbody tr th {\n",
       "        vertical-align: top;\n",
       "    }\n",
       "\n",
       "    .dataframe thead th {\n",
       "        text-align: right;\n",
       "    }\n",
       "</style>\n",
       "<table border=\"1\" class=\"dataframe\">\n",
       "  <thead>\n",
       "    <tr style=\"text-align: right;\">\n",
       "      <th></th>\n",
       "      <th>종목명</th>\n",
       "      <th>거래일자</th>\n",
       "      <th>종가</th>\n",
       "      <th>시가</th>\n",
       "      <th>저가</th>\n",
       "      <th>고가</th>\n",
       "      <th>등락률</th>\n",
       "    </tr>\n",
       "  </thead>\n",
       "  <tbody>\n",
       "    <tr>\n",
       "      <th>4</th>\n",
       "      <td>동화약품보통주</td>\n",
       "      <td>20200326</td>\n",
       "      <td>5900</td>\n",
       "      <td>5720</td>\n",
       "      <td>5540</td>\n",
       "      <td>6050</td>\n",
       "      <td>-0.030508</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>5</th>\n",
       "      <td>동화약품보통주</td>\n",
       "      <td>20200320</td>\n",
       "      <td>5190</td>\n",
       "      <td>5010</td>\n",
       "      <td>5000</td>\n",
       "      <td>5290</td>\n",
       "      <td>-0.034682</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>6</th>\n",
       "      <td>동화약품보통주</td>\n",
       "      <td>20200324</td>\n",
       "      <td>5330</td>\n",
       "      <td>5170</td>\n",
       "      <td>5100</td>\n",
       "      <td>5570</td>\n",
       "      <td>-0.030019</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>8</th>\n",
       "      <td>동화약품보통주</td>\n",
       "      <td>20200330</td>\n",
       "      <td>6350</td>\n",
       "      <td>6130</td>\n",
       "      <td>6000</td>\n",
       "      <td>6350</td>\n",
       "      <td>-0.034646</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>9</th>\n",
       "      <td>동화약품보통주</td>\n",
       "      <td>20200325</td>\n",
       "      <td>5630</td>\n",
       "      <td>5510</td>\n",
       "      <td>5440</td>\n",
       "      <td>5670</td>\n",
       "      <td>-0.021314</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>13</th>\n",
       "      <td>동화약품보통주</td>\n",
       "      <td>20200317</td>\n",
       "      <td>5570</td>\n",
       "      <td>5250</td>\n",
       "      <td>5250</td>\n",
       "      <td>5730</td>\n",
       "      <td>-0.057451</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>14</th>\n",
       "      <td>동화약품보통주</td>\n",
       "      <td>20200331</td>\n",
       "      <td>6550</td>\n",
       "      <td>6400</td>\n",
       "      <td>6360</td>\n",
       "      <td>6650</td>\n",
       "      <td>-0.022901</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>15</th>\n",
       "      <td>동화약품보통주</td>\n",
       "      <td>20200323</td>\n",
       "      <td>5020</td>\n",
       "      <td>4900</td>\n",
       "      <td>4850</td>\n",
       "      <td>5170</td>\n",
       "      <td>-0.023904</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>26</th>\n",
       "      <td>동화약품보통주</td>\n",
       "      <td>20210316</td>\n",
       "      <td>14700</td>\n",
       "      <td>14350</td>\n",
       "      <td>14350</td>\n",
       "      <td>14850</td>\n",
       "      <td>-0.023810</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>32</th>\n",
       "      <td>동화약품보통주</td>\n",
       "      <td>20210305</td>\n",
       "      <td>13950</td>\n",
       "      <td>13600</td>\n",
       "      <td>13400</td>\n",
       "      <td>13950</td>\n",
       "      <td>-0.025090</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>44</th>\n",
       "      <td>동화약품보통주</td>\n",
       "      <td>20220318</td>\n",
       "      <td>14350</td>\n",
       "      <td>14050</td>\n",
       "      <td>13600</td>\n",
       "      <td>15350</td>\n",
       "      <td>-0.020906</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>55</th>\n",
       "      <td>동화약품보통주</td>\n",
       "      <td>20220315</td>\n",
       "      <td>12850</td>\n",
       "      <td>12500</td>\n",
       "      <td>12350</td>\n",
       "      <td>12950</td>\n",
       "      <td>-0.027237</td>\n",
       "    </tr>\n",
       "  </tbody>\n",
       "</table>\n",
       "</div>"
      ],
      "text/plain": [
       "        종목명      거래일자     종가     시가     저가     고가       등락률\n",
       "4   동화약품보통주  20200326   5900   5720   5540   6050 -0.030508\n",
       "5   동화약품보통주  20200320   5190   5010   5000   5290 -0.034682\n",
       "6   동화약품보통주  20200324   5330   5170   5100   5570 -0.030019\n",
       "8   동화약품보통주  20200330   6350   6130   6000   6350 -0.034646\n",
       "9   동화약품보통주  20200325   5630   5510   5440   5670 -0.021314\n",
       "13  동화약품보통주  20200317   5570   5250   5250   5730 -0.057451\n",
       "14  동화약품보통주  20200331   6550   6400   6360   6650 -0.022901\n",
       "15  동화약품보통주  20200323   5020   4900   4850   5170 -0.023904\n",
       "26  동화약품보통주  20210316  14700  14350  14350  14850 -0.023810\n",
       "32  동화약품보통주  20210305  13950  13600  13400  13950 -0.025090\n",
       "44  동화약품보통주  20220318  14350  14050  13600  15350 -0.020906\n",
       "55  동화약품보통주  20220315  12850  12500  12350  12950 -0.027237"
      ]
     },
     "execution_count": 11,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "df_lower = df[df['등락률'] <= 0] # 33개\n",
    "df_lower # 하락한 날"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 12,
   "id": "75478180",
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/plain": [
       "21    20200302\n",
       "16    20200303\n",
       "18    20200304\n",
       "19    20200305\n",
       "17    20200306\n",
       "        ...   \n",
       "51    20220325\n",
       "58    20220328\n",
       "57    20220329\n",
       "49    20220330\n",
       "52    20220331\n",
       "Name: 거래일자, Length: 65, dtype: int64"
      ]
     },
     "execution_count": 12,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "df['거래일자'].sort_values()"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "a27779e8",
   "metadata": {},
   "source": [
    "## 거래량 변동하는 날짜 출력\n",
    "### 상승하는 날짜(등락률이 0보다 큰 날)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 13,
   "id": "dca41eee",
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/plain": [
       "[20200309,\n",
       " 20200311,\n",
       " 20200312,\n",
       " 20200316,\n",
       " 20200318,\n",
       " 20200319,\n",
       " 20200327,\n",
       " 20210302,\n",
       " 20210304,\n",
       " 20210308,\n",
       " 20210310,\n",
       " 20210322,\n",
       " 20220314,\n",
       " 20220321,\n",
       " 20220322,\n",
       " 20220331]"
      ]
     },
     "execution_count": 13,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "up_list = df_upper['거래일자'].sort_values().unique().tolist()\n",
    "up_list"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "201f87a3",
   "metadata": {},
   "source": [
    "### 하락하는 날짜(등락률이 0보다 작거나 같은 날)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 14,
   "id": "b88e8fa6",
   "metadata": {
    "scrolled": true
   },
   "outputs": [
    {
     "data": {
      "text/plain": [
       "[20200317,\n",
       " 20200320,\n",
       " 20200323,\n",
       " 20200324,\n",
       " 20200325,\n",
       " 20200326,\n",
       " 20200330,\n",
       " 20200331,\n",
       " 20210305,\n",
       " 20210316,\n",
       " 20220315,\n",
       " 20220318]"
      ]
     },
     "execution_count": 14,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "down_list = df_lower['거래일자'].sort_values().unique().tolist()\n",
    "down_list"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "b0427082",
   "metadata": {},
   "source": [
    "## 라벨링"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 15,
   "id": "8f98c4cc",
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/plain": [
       "[0.12938816449348045,\n",
       " 0.0529595015576324,\n",
       " 0.028021015761821366,\n",
       " 0.02773246329526917,\n",
       " 0.0310192023633678,\n",
       " 0.03874538745387454,\n",
       " 0.024079320113314446,\n",
       " 0.05555555555555555,\n",
       " 0.04225352112676056,\n",
       " 0.03272727272727273,\n",
       " 0.03146853146853147,\n",
       " 0.027303754266211604,\n",
       " 0.04332129963898917,\n",
       " 0.02197802197802198,\n",
       " 0.02390438247011952]"
      ]
     },
     "execution_count": 15,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "up = df_upper['등락률'].unique().tolist()\n",
    "up"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 16,
   "id": "e0bb29eb",
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/plain": [
       "[-0.030508474576271188,\n",
       " -0.03468208092485549,\n",
       " -0.0300187617260788,\n",
       " -0.03464566929133858,\n",
       " -0.021314387211367674,\n",
       " -0.05745062836624776,\n",
       " -0.022900763358778626,\n",
       " -0.02390438247011952,\n",
       " -0.023809523809523808,\n",
       " -0.025089605734767026,\n",
       " -0.020905923344947737,\n",
       " -0.027237354085603113]"
      ]
     },
     "execution_count": 16,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "down = df_lower['등락률'].unique().tolist()\n",
    "down"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 17,
   "id": "b0eb1956",
   "metadata": {
    "scrolled": true
   },
   "outputs": [
    {
     "data": {
      "text/html": [
       "<div>\n",
       "<style scoped>\n",
       "    .dataframe tbody tr th:only-of-type {\n",
       "        vertical-align: middle;\n",
       "    }\n",
       "\n",
       "    .dataframe tbody tr th {\n",
       "        vertical-align: top;\n",
       "    }\n",
       "\n",
       "    .dataframe thead th {\n",
       "        text-align: right;\n",
       "    }\n",
       "</style>\n",
       "<table border=\"1\" class=\"dataframe\">\n",
       "  <thead>\n",
       "    <tr style=\"text-align: right;\">\n",
       "      <th></th>\n",
       "      <th>종목명</th>\n",
       "      <th>거래일자</th>\n",
       "      <th>종가</th>\n",
       "      <th>시가</th>\n",
       "      <th>저가</th>\n",
       "      <th>고가</th>\n",
       "      <th>등락률</th>\n",
       "      <th>label</th>\n",
       "    </tr>\n",
       "  </thead>\n",
       "  <tbody>\n",
       "    <tr>\n",
       "      <th>0</th>\n",
       "      <td>동화약품보통주</td>\n",
       "      <td>20200319</td>\n",
       "      <td>4985</td>\n",
       "      <td>5630</td>\n",
       "      <td>4800</td>\n",
       "      <td>6450</td>\n",
       "      <td>0.129388</td>\n",
       "      <td>0</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>1</th>\n",
       "      <td>동화약품보통주</td>\n",
       "      <td>20200312</td>\n",
       "      <td>6420</td>\n",
       "      <td>6760</td>\n",
       "      <td>6300</td>\n",
       "      <td>6760</td>\n",
       "      <td>0.052960</td>\n",
       "      <td>0</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2</th>\n",
       "      <td>동화약품보통주</td>\n",
       "      <td>20200316</td>\n",
       "      <td>5710</td>\n",
       "      <td>5870</td>\n",
       "      <td>5700</td>\n",
       "      <td>6050</td>\n",
       "      <td>0.028021</td>\n",
       "      <td>0</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>3</th>\n",
       "      <td>동화약품보통주</td>\n",
       "      <td>20200313</td>\n",
       "      <td>5870</td>\n",
       "      <td>5960</td>\n",
       "      <td>5560</td>\n",
       "      <td>6150</td>\n",
       "      <td>0.015332</td>\n",
       "      <td>0</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>4</th>\n",
       "      <td>동화약품보통주</td>\n",
       "      <td>20200326</td>\n",
       "      <td>5900</td>\n",
       "      <td>5720</td>\n",
       "      <td>5540</td>\n",
       "      <td>6050</td>\n",
       "      <td>-0.030508</td>\n",
       "      <td>0</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>...</th>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>60</th>\n",
       "      <td>동화약품보통주</td>\n",
       "      <td>20220302</td>\n",
       "      <td>12800</td>\n",
       "      <td>12650</td>\n",
       "      <td>12600</td>\n",
       "      <td>12900</td>\n",
       "      <td>-0.011719</td>\n",
       "      <td>0</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>61</th>\n",
       "      <td>동화약품보통주</td>\n",
       "      <td>20220308</td>\n",
       "      <td>12850</td>\n",
       "      <td>12700</td>\n",
       "      <td>12600</td>\n",
       "      <td>13050</td>\n",
       "      <td>-0.011673</td>\n",
       "      <td>0</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>62</th>\n",
       "      <td>동화약품보통주</td>\n",
       "      <td>20220314</td>\n",
       "      <td>12550</td>\n",
       "      <td>12850</td>\n",
       "      <td>12500</td>\n",
       "      <td>12850</td>\n",
       "      <td>0.023904</td>\n",
       "      <td>0</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>63</th>\n",
       "      <td>동화약품보통주</td>\n",
       "      <td>20220310</td>\n",
       "      <td>12900</td>\n",
       "      <td>13000</td>\n",
       "      <td>12850</td>\n",
       "      <td>13050</td>\n",
       "      <td>0.007752</td>\n",
       "      <td>0</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>64</th>\n",
       "      <td>동화약품보통주</td>\n",
       "      <td>20220311</td>\n",
       "      <td>12850</td>\n",
       "      <td>12900</td>\n",
       "      <td>12750</td>\n",
       "      <td>13050</td>\n",
       "      <td>0.003891</td>\n",
       "      <td>0</td>\n",
       "    </tr>\n",
       "  </tbody>\n",
       "</table>\n",
       "<p>65 rows × 8 columns</p>\n",
       "</div>"
      ],
      "text/plain": [
       "        종목명      거래일자     종가     시가     저가     고가       등락률  label\n",
       "0   동화약품보통주  20200319   4985   5630   4800   6450  0.129388      0\n",
       "1   동화약품보통주  20200312   6420   6760   6300   6760  0.052960      0\n",
       "2   동화약품보통주  20200316   5710   5870   5700   6050  0.028021      0\n",
       "3   동화약품보통주  20200313   5870   5960   5560   6150  0.015332      0\n",
       "4   동화약품보통주  20200326   5900   5720   5540   6050 -0.030508      0\n",
       "..      ...       ...    ...    ...    ...    ...       ...    ...\n",
       "60  동화약품보통주  20220302  12800  12650  12600  12900 -0.011719      0\n",
       "61  동화약품보통주  20220308  12850  12700  12600  13050 -0.011673      0\n",
       "62  동화약품보통주  20220314  12550  12850  12500  12850  0.023904      0\n",
       "63  동화약품보통주  20220310  12900  13000  12850  13050  0.007752      0\n",
       "64  동화약품보통주  20220311  12850  12900  12750  13050  0.003891      0\n",
       "\n",
       "[65 rows x 8 columns]"
      ]
     },
     "execution_count": 17,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "df['label'] = 0\n",
    "df"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "add8a582",
   "metadata": {},
   "source": [
    "### 상승한 날 label = 1 / 하락한 날 label = 0"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 18,
   "id": "13298280",
   "metadata": {
    "scrolled": true
   },
   "outputs": [],
   "source": [
    "for i in df[df['등락률'] > 0].index:\n",
    "    df.at[i, 'label'] = 1 "
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 20,
   "id": "1b7ef92a",
   "metadata": {
    "scrolled": true
   },
   "outputs": [
    {
     "data": {
      "text/html": [
       "<div>\n",
       "<style scoped>\n",
       "    .dataframe tbody tr th:only-of-type {\n",
       "        vertical-align: middle;\n",
       "    }\n",
       "\n",
       "    .dataframe tbody tr th {\n",
       "        vertical-align: top;\n",
       "    }\n",
       "\n",
       "    .dataframe thead th {\n",
       "        text-align: right;\n",
       "    }\n",
       "</style>\n",
       "<table border=\"1\" class=\"dataframe\">\n",
       "  <thead>\n",
       "    <tr style=\"text-align: right;\">\n",
       "      <th></th>\n",
       "      <th>종목명</th>\n",
       "      <th>거래일자</th>\n",
       "      <th>종가</th>\n",
       "      <th>시가</th>\n",
       "      <th>저가</th>\n",
       "      <th>고가</th>\n",
       "      <th>등락률</th>\n",
       "      <th>label</th>\n",
       "    </tr>\n",
       "  </thead>\n",
       "  <tbody>\n",
       "    <tr>\n",
       "      <th>0</th>\n",
       "      <td>동화약품보통주</td>\n",
       "      <td>20200319</td>\n",
       "      <td>4985</td>\n",
       "      <td>5630</td>\n",
       "      <td>4800</td>\n",
       "      <td>6450</td>\n",
       "      <td>0.129388</td>\n",
       "      <td>1</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>1</th>\n",
       "      <td>동화약품보통주</td>\n",
       "      <td>20200312</td>\n",
       "      <td>6420</td>\n",
       "      <td>6760</td>\n",
       "      <td>6300</td>\n",
       "      <td>6760</td>\n",
       "      <td>0.052960</td>\n",
       "      <td>1</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2</th>\n",
       "      <td>동화약품보통주</td>\n",
       "      <td>20200316</td>\n",
       "      <td>5710</td>\n",
       "      <td>5870</td>\n",
       "      <td>5700</td>\n",
       "      <td>6050</td>\n",
       "      <td>0.028021</td>\n",
       "      <td>1</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>4</th>\n",
       "      <td>동화약품보통주</td>\n",
       "      <td>20200326</td>\n",
       "      <td>5900</td>\n",
       "      <td>5720</td>\n",
       "      <td>5540</td>\n",
       "      <td>6050</td>\n",
       "      <td>-0.030508</td>\n",
       "      <td>1</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>5</th>\n",
       "      <td>동화약품보통주</td>\n",
       "      <td>20200320</td>\n",
       "      <td>5190</td>\n",
       "      <td>5010</td>\n",
       "      <td>5000</td>\n",
       "      <td>5290</td>\n",
       "      <td>-0.034682</td>\n",
       "      <td>1</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>6</th>\n",
       "      <td>동화약품보통주</td>\n",
       "      <td>20200324</td>\n",
       "      <td>5330</td>\n",
       "      <td>5170</td>\n",
       "      <td>5100</td>\n",
       "      <td>5570</td>\n",
       "      <td>-0.030019</td>\n",
       "      <td>1</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>7</th>\n",
       "      <td>동화약품보통주</td>\n",
       "      <td>20200327</td>\n",
       "      <td>6130</td>\n",
       "      <td>6300</td>\n",
       "      <td>5900</td>\n",
       "      <td>6300</td>\n",
       "      <td>0.027732</td>\n",
       "      <td>1</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>8</th>\n",
       "      <td>동화약품보통주</td>\n",
       "      <td>20200330</td>\n",
       "      <td>6350</td>\n",
       "      <td>6130</td>\n",
       "      <td>6000</td>\n",
       "      <td>6350</td>\n",
       "      <td>-0.034646</td>\n",
       "      <td>1</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>9</th>\n",
       "      <td>동화약품보통주</td>\n",
       "      <td>20200325</td>\n",
       "      <td>5630</td>\n",
       "      <td>5510</td>\n",
       "      <td>5440</td>\n",
       "      <td>5670</td>\n",
       "      <td>-0.021314</td>\n",
       "      <td>1</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>11</th>\n",
       "      <td>동화약품보통주</td>\n",
       "      <td>20200311</td>\n",
       "      <td>6770</td>\n",
       "      <td>6980</td>\n",
       "      <td>6730</td>\n",
       "      <td>7110</td>\n",
       "      <td>0.031019</td>\n",
       "      <td>1</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>12</th>\n",
       "      <td>동화약품보통주</td>\n",
       "      <td>20200318</td>\n",
       "      <td>5420</td>\n",
       "      <td>5630</td>\n",
       "      <td>5420</td>\n",
       "      <td>5780</td>\n",
       "      <td>0.038745</td>\n",
       "      <td>1</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>13</th>\n",
       "      <td>동화약품보통주</td>\n",
       "      <td>20200317</td>\n",
       "      <td>5570</td>\n",
       "      <td>5250</td>\n",
       "      <td>5250</td>\n",
       "      <td>5730</td>\n",
       "      <td>-0.057451</td>\n",
       "      <td>1</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>14</th>\n",
       "      <td>동화약품보통주</td>\n",
       "      <td>20200331</td>\n",
       "      <td>6550</td>\n",
       "      <td>6400</td>\n",
       "      <td>6360</td>\n",
       "      <td>6650</td>\n",
       "      <td>-0.022901</td>\n",
       "      <td>1</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>15</th>\n",
       "      <td>동화약품보통주</td>\n",
       "      <td>20200323</td>\n",
       "      <td>5020</td>\n",
       "      <td>4900</td>\n",
       "      <td>4850</td>\n",
       "      <td>5170</td>\n",
       "      <td>-0.023904</td>\n",
       "      <td>1</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>20</th>\n",
       "      <td>동화약품보통주</td>\n",
       "      <td>20200309</td>\n",
       "      <td>7060</td>\n",
       "      <td>7230</td>\n",
       "      <td>7030</td>\n",
       "      <td>7230</td>\n",
       "      <td>0.024079</td>\n",
       "      <td>1</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>22</th>\n",
       "      <td>동화약품보통주</td>\n",
       "      <td>20210308</td>\n",
       "      <td>14400</td>\n",
       "      <td>15200</td>\n",
       "      <td>14400</td>\n",
       "      <td>17200</td>\n",
       "      <td>0.055556</td>\n",
       "      <td>1</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>24</th>\n",
       "      <td>동화약품보통주</td>\n",
       "      <td>20210310</td>\n",
       "      <td>14200</td>\n",
       "      <td>14800</td>\n",
       "      <td>14200</td>\n",
       "      <td>14850</td>\n",
       "      <td>0.042254</td>\n",
       "      <td>1</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>26</th>\n",
       "      <td>동화약품보통주</td>\n",
       "      <td>20210316</td>\n",
       "      <td>14700</td>\n",
       "      <td>14350</td>\n",
       "      <td>14350</td>\n",
       "      <td>14850</td>\n",
       "      <td>-0.023810</td>\n",
       "      <td>1</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>28</th>\n",
       "      <td>동화약품보통주</td>\n",
       "      <td>20210304</td>\n",
       "      <td>13750</td>\n",
       "      <td>14200</td>\n",
       "      <td>13600</td>\n",
       "      <td>14250</td>\n",
       "      <td>0.032727</td>\n",
       "      <td>1</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>30</th>\n",
       "      <td>동화약품보통주</td>\n",
       "      <td>20210302</td>\n",
       "      <td>14300</td>\n",
       "      <td>14750</td>\n",
       "      <td>14100</td>\n",
       "      <td>14750</td>\n",
       "      <td>0.031469</td>\n",
       "      <td>1</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>31</th>\n",
       "      <td>동화약품보통주</td>\n",
       "      <td>20210322</td>\n",
       "      <td>14650</td>\n",
       "      <td>15050</td>\n",
       "      <td>14600</td>\n",
       "      <td>15050</td>\n",
       "      <td>0.027304</td>\n",
       "      <td>1</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>32</th>\n",
       "      <td>동화약품보통주</td>\n",
       "      <td>20210305</td>\n",
       "      <td>13950</td>\n",
       "      <td>13600</td>\n",
       "      <td>13400</td>\n",
       "      <td>13950</td>\n",
       "      <td>-0.025090</td>\n",
       "      <td>1</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>44</th>\n",
       "      <td>동화약품보통주</td>\n",
       "      <td>20220318</td>\n",
       "      <td>14350</td>\n",
       "      <td>14050</td>\n",
       "      <td>13600</td>\n",
       "      <td>15350</td>\n",
       "      <td>-0.020906</td>\n",
       "      <td>1</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>46</th>\n",
       "      <td>동화약품보통주</td>\n",
       "      <td>20220321</td>\n",
       "      <td>13850</td>\n",
       "      <td>14450</td>\n",
       "      <td>13800</td>\n",
       "      <td>14550</td>\n",
       "      <td>0.043321</td>\n",
       "      <td>1</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>47</th>\n",
       "      <td>동화약품보통주</td>\n",
       "      <td>20220322</td>\n",
       "      <td>13650</td>\n",
       "      <td>13950</td>\n",
       "      <td>13550</td>\n",
       "      <td>14200</td>\n",
       "      <td>0.021978</td>\n",
       "      <td>1</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>52</th>\n",
       "      <td>동화약품보통주</td>\n",
       "      <td>20220331</td>\n",
       "      <td>13650</td>\n",
       "      <td>13950</td>\n",
       "      <td>13600</td>\n",
       "      <td>13950</td>\n",
       "      <td>0.021978</td>\n",
       "      <td>1</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>55</th>\n",
       "      <td>동화약품보통주</td>\n",
       "      <td>20220315</td>\n",
       "      <td>12850</td>\n",
       "      <td>12500</td>\n",
       "      <td>12350</td>\n",
       "      <td>12950</td>\n",
       "      <td>-0.027237</td>\n",
       "      <td>1</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>62</th>\n",
       "      <td>동화약품보통주</td>\n",
       "      <td>20220314</td>\n",
       "      <td>12550</td>\n",
       "      <td>12850</td>\n",
       "      <td>12500</td>\n",
       "      <td>12850</td>\n",
       "      <td>0.023904</td>\n",
       "      <td>1</td>\n",
       "    </tr>\n",
       "  </tbody>\n",
       "</table>\n",
       "</div>"
      ],
      "text/plain": [
       "        종목명      거래일자     종가     시가     저가     고가       등락률  label\n",
       "0   동화약품보통주  20200319   4985   5630   4800   6450  0.129388      1\n",
       "1   동화약품보통주  20200312   6420   6760   6300   6760  0.052960      1\n",
       "2   동화약품보통주  20200316   5710   5870   5700   6050  0.028021      1\n",
       "4   동화약품보통주  20200326   5900   5720   5540   6050 -0.030508      1\n",
       "5   동화약품보통주  20200320   5190   5010   5000   5290 -0.034682      1\n",
       "6   동화약품보통주  20200324   5330   5170   5100   5570 -0.030019      1\n",
       "7   동화약품보통주  20200327   6130   6300   5900   6300  0.027732      1\n",
       "8   동화약품보통주  20200330   6350   6130   6000   6350 -0.034646      1\n",
       "9   동화약품보통주  20200325   5630   5510   5440   5670 -0.021314      1\n",
       "11  동화약품보통주  20200311   6770   6980   6730   7110  0.031019      1\n",
       "12  동화약품보통주  20200318   5420   5630   5420   5780  0.038745      1\n",
       "13  동화약품보통주  20200317   5570   5250   5250   5730 -0.057451      1\n",
       "14  동화약품보통주  20200331   6550   6400   6360   6650 -0.022901      1\n",
       "15  동화약품보통주  20200323   5020   4900   4850   5170 -0.023904      1\n",
       "20  동화약품보통주  20200309   7060   7230   7030   7230  0.024079      1\n",
       "22  동화약품보통주  20210308  14400  15200  14400  17200  0.055556      1\n",
       "24  동화약품보통주  20210310  14200  14800  14200  14850  0.042254      1\n",
       "26  동화약품보통주  20210316  14700  14350  14350  14850 -0.023810      1\n",
       "28  동화약품보통주  20210304  13750  14200  13600  14250  0.032727      1\n",
       "30  동화약품보통주  20210302  14300  14750  14100  14750  0.031469      1\n",
       "31  동화약품보통주  20210322  14650  15050  14600  15050  0.027304      1\n",
       "32  동화약품보통주  20210305  13950  13600  13400  13950 -0.025090      1\n",
       "44  동화약품보통주  20220318  14350  14050  13600  15350 -0.020906      1\n",
       "46  동화약품보통주  20220321  13850  14450  13800  14550  0.043321      1\n",
       "47  동화약품보통주  20220322  13650  13950  13550  14200  0.021978      1\n",
       "52  동화약품보통주  20220331  13650  13950  13600  13950  0.021978      1\n",
       "55  동화약품보통주  20220315  12850  12500  12350  12950 -0.027237      1\n",
       "62  동화약품보통주  20220314  12550  12850  12500  12850  0.023904      1"
      ]
     },
     "execution_count": 20,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "df_label = df[df['label'] == 1]\n",
    "df_label"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 21,
   "id": "a28f21d6",
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/plain": [
       "28"
      ]
     },
     "execution_count": 21,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "len(df[df['label'] == 1])"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "id": "9148ad17",
   "metadata": {},
   "outputs": [],
   "source": [
    "df"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "9a730ab3",
   "metadata": {},
   "source": [
    "## 크롤링"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 22,
   "id": "860af8ca",
   "metadata": {},
   "outputs": [
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "C:\\Users\\cupid\\AppData\\Local\\Temp\\ipykernel_19280\\749267265.py:14: SettingWithCopyWarning: \n",
      "A value is trying to be set on a copy of a slice from a DataFrame\n",
      "\n",
      "See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy\n",
      "  df['Price'][i] = 0\n",
      "C:\\Users\\cupid\\AppData\\Local\\Temp\\ipykernel_19280\\749267265.py:12: SettingWithCopyWarning: \n",
      "A value is trying to be set on a copy of a slice from a DataFrame\n",
      "\n",
      "See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy\n",
      "  df['Price'][i] = 1\n"
     ]
    }
   ],
   "source": [
    "# 동화약품 크롤링\n",
    "start = datetime.datetime(2020, 1, 1)\n",
    "end = datetime.datetime(2022, 3, 31)\n",
    "df_null = wb.DataReader(\"000020.KS\",\"yahoo\",start,end)     # 000020.KS : 동화약품\n",
    "df = df_null.dropna()                                  # 결측치 제거\n",
    "\n",
    "# 새로운 칼럼 생성\n",
    "# (Price : 당일 대비 다음날 주가가 상승했으면 1, 하락했으면 0 표시)\n",
    "df['Price'] = 0\n",
    "for i in range(0, 120):\n",
    "    if df['Close'][i] < df['Close'][i+1]:\n",
    "        df['Price'][i] = 1\n",
    "    else:\n",
    "        df['Price'][i] = 0"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 23,
   "id": "cd1e2932",
   "metadata": {
    "scrolled": true
   },
   "outputs": [],
   "source": [
    "df.to_csv('동화약품_주가데이터.csv')\n",
    "df['등락률'] = (df['Open']-df['Adj Close'])/df['Adj Close']\n",
    "df=df\n",
    "#df[df['Price']==0][\"Date\"]"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 24,
   "id": "55b8d622",
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/html": [
       "<div>\n",
       "<style scoped>\n",
       "    .dataframe tbody tr th:only-of-type {\n",
       "        vertical-align: middle;\n",
       "    }\n",
       "\n",
       "    .dataframe tbody tr th {\n",
       "        vertical-align: top;\n",
       "    }\n",
       "\n",
       "    .dataframe thead th {\n",
       "        text-align: right;\n",
       "    }\n",
       "</style>\n",
       "<table border=\"1\" class=\"dataframe\">\n",
       "  <thead>\n",
       "    <tr style=\"text-align: right;\">\n",
       "      <th></th>\n",
       "      <th>High</th>\n",
       "      <th>Low</th>\n",
       "      <th>Open</th>\n",
       "      <th>Close</th>\n",
       "      <th>Volume</th>\n",
       "      <th>Adj Close</th>\n",
       "      <th>Price</th>\n",
       "      <th>등락률</th>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>Date</th>\n",
       "      <th></th>\n",
       "      <th></th>\n",
       "      <th></th>\n",
       "      <th></th>\n",
       "      <th></th>\n",
       "      <th></th>\n",
       "      <th></th>\n",
       "      <th></th>\n",
       "    </tr>\n",
       "  </thead>\n",
       "  <tbody>\n",
       "    <tr>\n",
       "      <th>2020-01-02</th>\n",
       "      <td>8400.0</td>\n",
       "      <td>8290.0</td>\n",
       "      <td>8340.0</td>\n",
       "      <td>8400.0</td>\n",
       "      <td>111305.0</td>\n",
       "      <td>8215.657227</td>\n",
       "      <td>0</td>\n",
       "      <td>0.015135</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2020-01-03</th>\n",
       "      <td>8450.0</td>\n",
       "      <td>8290.0</td>\n",
       "      <td>8400.0</td>\n",
       "      <td>8360.0</td>\n",
       "      <td>96437.0</td>\n",
       "      <td>8176.536133</td>\n",
       "      <td>0</td>\n",
       "      <td>0.027330</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2020-01-06</th>\n",
       "      <td>8330.0</td>\n",
       "      <td>8120.0</td>\n",
       "      <td>8290.0</td>\n",
       "      <td>8180.0</td>\n",
       "      <td>73230.0</td>\n",
       "      <td>8000.485840</td>\n",
       "      <td>0</td>\n",
       "      <td>0.036187</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2020-01-07</th>\n",
       "      <td>8280.0</td>\n",
       "      <td>8090.0</td>\n",
       "      <td>8200.0</td>\n",
       "      <td>8160.0</td>\n",
       "      <td>117904.0</td>\n",
       "      <td>7980.925293</td>\n",
       "      <td>0</td>\n",
       "      <td>0.027450</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2020-01-08</th>\n",
       "      <td>8170.0</td>\n",
       "      <td>7830.0</td>\n",
       "      <td>8170.0</td>\n",
       "      <td>7930.0</td>\n",
       "      <td>263246.0</td>\n",
       "      <td>7755.972656</td>\n",
       "      <td>0</td>\n",
       "      <td>0.053382</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>...</th>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2022-03-25</th>\n",
       "      <td>13950.0</td>\n",
       "      <td>13500.0</td>\n",
       "      <td>13700.0</td>\n",
       "      <td>13900.0</td>\n",
       "      <td>248995.0</td>\n",
       "      <td>13900.000000</td>\n",
       "      <td>0</td>\n",
       "      <td>-0.014388</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2022-03-28</th>\n",
       "      <td>13900.0</td>\n",
       "      <td>13600.0</td>\n",
       "      <td>13900.0</td>\n",
       "      <td>13750.0</td>\n",
       "      <td>160036.0</td>\n",
       "      <td>13750.000000</td>\n",
       "      <td>0</td>\n",
       "      <td>0.010909</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2022-03-29</th>\n",
       "      <td>14000.0</td>\n",
       "      <td>13650.0</td>\n",
       "      <td>13850.0</td>\n",
       "      <td>13750.0</td>\n",
       "      <td>160334.0</td>\n",
       "      <td>13750.000000</td>\n",
       "      <td>0</td>\n",
       "      <td>0.007273</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2022-03-30</th>\n",
       "      <td>14200.0</td>\n",
       "      <td>13750.0</td>\n",
       "      <td>13800.0</td>\n",
       "      <td>13900.0</td>\n",
       "      <td>365447.0</td>\n",
       "      <td>13900.000000</td>\n",
       "      <td>0</td>\n",
       "      <td>-0.007194</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2022-03-31</th>\n",
       "      <td>13950.0</td>\n",
       "      <td>13600.0</td>\n",
       "      <td>13950.0</td>\n",
       "      <td>13650.0</td>\n",
       "      <td>214548.0</td>\n",
       "      <td>13650.000000</td>\n",
       "      <td>0</td>\n",
       "      <td>0.021978</td>\n",
       "    </tr>\n",
       "  </tbody>\n",
       "</table>\n",
       "<p>554 rows × 8 columns</p>\n",
       "</div>"
      ],
      "text/plain": [
       "               High      Low     Open    Close    Volume     Adj Close  Price  \\\n",
       "Date                                                                            \n",
       "2020-01-02   8400.0   8290.0   8340.0   8400.0  111305.0   8215.657227      0   \n",
       "2020-01-03   8450.0   8290.0   8400.0   8360.0   96437.0   8176.536133      0   \n",
       "2020-01-06   8330.0   8120.0   8290.0   8180.0   73230.0   8000.485840      0   \n",
       "2020-01-07   8280.0   8090.0   8200.0   8160.0  117904.0   7980.925293      0   \n",
       "2020-01-08   8170.0   7830.0   8170.0   7930.0  263246.0   7755.972656      0   \n",
       "...             ...      ...      ...      ...       ...           ...    ...   \n",
       "2022-03-25  13950.0  13500.0  13700.0  13900.0  248995.0  13900.000000      0   \n",
       "2022-03-28  13900.0  13600.0  13900.0  13750.0  160036.0  13750.000000      0   \n",
       "2022-03-29  14000.0  13650.0  13850.0  13750.0  160334.0  13750.000000      0   \n",
       "2022-03-30  14200.0  13750.0  13800.0  13900.0  365447.0  13900.000000      0   \n",
       "2022-03-31  13950.0  13600.0  13950.0  13650.0  214548.0  13650.000000      0   \n",
       "\n",
       "                 등락률  \n",
       "Date                  \n",
       "2020-01-02  0.015135  \n",
       "2020-01-03  0.027330  \n",
       "2020-01-06  0.036187  \n",
       "2020-01-07  0.027450  \n",
       "2020-01-08  0.053382  \n",
       "...              ...  \n",
       "2022-03-25 -0.014388  \n",
       "2022-03-28  0.010909  \n",
       "2022-03-29  0.007273  \n",
       "2022-03-30 -0.007194  \n",
       "2022-03-31  0.021978  \n",
       "\n",
       "[554 rows x 8 columns]"
      ]
     },
     "execution_count": 24,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "df"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 25,
   "id": "894835da",
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/plain": [
       "DatetimeIndex(['2020-01-02', '2020-01-03', '2020-01-06', '2020-01-07',\n",
       "               '2020-01-08', '2020-01-13', '2020-01-14', '2020-01-15',\n",
       "               '2020-01-20', '2020-01-28',\n",
       "               ...\n",
       "               '2022-03-18', '2022-03-21', '2022-03-22', '2022-03-23',\n",
       "               '2022-03-24', '2022-03-25', '2022-03-28', '2022-03-29',\n",
       "               '2022-03-30', '2022-03-31'],\n",
       "              dtype='datetime64[ns]', name='Date', length=492, freq=None)"
      ]
     },
     "execution_count": 25,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "df[df[\"Price\"]==0].index"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 26,
   "id": "b4a00897",
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/plain": [
       "['20200102',\n",
       " '20200103',\n",
       " '20200106',\n",
       " '20200107',\n",
       " '20200108',\n",
       " '20200113',\n",
       " '20200114',\n",
       " '20200115',\n",
       " '20200120',\n",
       " '20200128',\n",
       " '20200129',\n",
       " '20200130',\n",
       " '20200131',\n",
       " '20200206',\n",
       " '20200207',\n",
       " '20200211',\n",
       " '20200212',\n",
       " '20200214',\n",
       " '20200217',\n",
       " '20200219',\n",
       " '20200220',\n",
       " '20200221',\n",
       " '20200226',\n",
       " '20200227',\n",
       " '20200228',\n",
       " '20200306',\n",
       " '20200309',\n",
       " '20200310',\n",
       " '20200311',\n",
       " '20200312',\n",
       " '20200313',\n",
       " '20200316',\n",
       " '20200317',\n",
       " '20200318',\n",
       " '20200320',\n",
       " '20200408',\n",
       " '20200410',\n",
       " '20200423',\n",
       " '20200428',\n",
       " '20200429',\n",
       " '20200504',\n",
       " '20200506',\n",
       " '20200508',\n",
       " '20200512',\n",
       " '20200514',\n",
       " '20200518',\n",
       " '20200519',\n",
       " '20200520',\n",
       " '20200525',\n",
       " '20200527',\n",
       " '20200602',\n",
       " '20200603',\n",
       " '20200609',\n",
       " '20200610',\n",
       " '20200612',\n",
       " '20200616',\n",
       " '20200618',\n",
       " '20200625',\n",
       " '20200626',\n",
       " '20200629',\n",
       " '20200630',\n",
       " '20200701',\n",
       " '20200702',\n",
       " '20200703',\n",
       " '20200706',\n",
       " '20200707',\n",
       " '20200708',\n",
       " '20200709',\n",
       " '20200710',\n",
       " '20200713',\n",
       " '20200714',\n",
       " '20200715',\n",
       " '20200716',\n",
       " '20200717',\n",
       " '20200720',\n",
       " '20200721',\n",
       " '20200722',\n",
       " '20200723',\n",
       " '20200724',\n",
       " '20200727',\n",
       " '20200728',\n",
       " '20200729',\n",
       " '20200730',\n",
       " '20200731',\n",
       " '20200803',\n",
       " '20200804',\n",
       " '20200805',\n",
       " '20200806',\n",
       " '20200807',\n",
       " '20200810',\n",
       " '20200811',\n",
       " '20200812',\n",
       " '20200813',\n",
       " '20200814',\n",
       " '20200818',\n",
       " '20200819',\n",
       " '20200820',\n",
       " '20200821',\n",
       " '20200824',\n",
       " '20200825',\n",
       " '20200826',\n",
       " '20200827',\n",
       " '20200828',\n",
       " '20200831',\n",
       " '20200901',\n",
       " '20200902',\n",
       " '20200903',\n",
       " '20200904',\n",
       " '20200907',\n",
       " '20200908',\n",
       " '20200909',\n",
       " '20200910',\n",
       " '20200911',\n",
       " '20200914',\n",
       " '20200915',\n",
       " '20200916',\n",
       " '20200917',\n",
       " '20200918',\n",
       " '20200921',\n",
       " '20200922',\n",
       " '20200923',\n",
       " '20200924',\n",
       " '20200925',\n",
       " '20200928',\n",
       " '20200929',\n",
       " '20201005',\n",
       " '20201006',\n",
       " '20201007',\n",
       " '20201008',\n",
       " '20201012',\n",
       " '20201013',\n",
       " '20201014',\n",
       " '20201015',\n",
       " '20201016',\n",
       " '20201019',\n",
       " '20201020',\n",
       " '20201021',\n",
       " '20201022',\n",
       " '20201023',\n",
       " '20201026',\n",
       " '20201027',\n",
       " '20201028',\n",
       " '20201029',\n",
       " '20201030',\n",
       " '20201102',\n",
       " '20201103',\n",
       " '20201104',\n",
       " '20201105',\n",
       " '20201106',\n",
       " '20201109',\n",
       " '20201110',\n",
       " '20201111',\n",
       " '20201112',\n",
       " '20201113',\n",
       " '20201116',\n",
       " '20201117',\n",
       " '20201118',\n",
       " '20201119',\n",
       " '20201120',\n",
       " '20201123',\n",
       " '20201124',\n",
       " '20201125',\n",
       " '20201126',\n",
       " '20201127',\n",
       " '20201130',\n",
       " '20201201',\n",
       " '20201202',\n",
       " '20201203',\n",
       " '20201204',\n",
       " '20201207',\n",
       " '20201208',\n",
       " '20201209',\n",
       " '20201210',\n",
       " '20201211',\n",
       " '20201214',\n",
       " '20201215',\n",
       " '20201216',\n",
       " '20201217',\n",
       " '20201218',\n",
       " '20201221',\n",
       " '20201222',\n",
       " '20201223',\n",
       " '20201224',\n",
       " '20201228',\n",
       " '20201229',\n",
       " '20201230',\n",
       " '20210104',\n",
       " '20210105',\n",
       " '20210106',\n",
       " '20210107',\n",
       " '20210108',\n",
       " '20210111',\n",
       " '20210112',\n",
       " '20210113',\n",
       " '20210114',\n",
       " '20210115',\n",
       " '20210118',\n",
       " '20210119',\n",
       " '20210120',\n",
       " '20210121',\n",
       " '20210122',\n",
       " '20210125',\n",
       " '20210126',\n",
       " '20210127',\n",
       " '20210128',\n",
       " '20210129',\n",
       " '20210201',\n",
       " '20210202',\n",
       " '20210203',\n",
       " '20210204',\n",
       " '20210205',\n",
       " '20210208',\n",
       " '20210209',\n",
       " '20210210',\n",
       " '20210215',\n",
       " '20210216',\n",
       " '20210217',\n",
       " '20210218',\n",
       " '20210219',\n",
       " '20210222',\n",
       " '20210223',\n",
       " '20210224',\n",
       " '20210225',\n",
       " '20210226',\n",
       " '20210302',\n",
       " '20210303',\n",
       " '20210304',\n",
       " '20210305',\n",
       " '20210308',\n",
       " '20210309',\n",
       " '20210310',\n",
       " '20210311',\n",
       " '20210312',\n",
       " '20210315',\n",
       " '20210316',\n",
       " '20210317',\n",
       " '20210318',\n",
       " '20210319',\n",
       " '20210322',\n",
       " '20210323',\n",
       " '20210324',\n",
       " '20210325',\n",
       " '20210326',\n",
       " '20210329',\n",
       " '20210330',\n",
       " '20210331',\n",
       " '20210401',\n",
       " '20210402',\n",
       " '20210405',\n",
       " '20210406',\n",
       " '20210407',\n",
       " '20210408',\n",
       " '20210409',\n",
       " '20210412',\n",
       " '20210413',\n",
       " '20210414',\n",
       " '20210415',\n",
       " '20210416',\n",
       " '20210419',\n",
       " '20210420',\n",
       " '20210421',\n",
       " '20210422',\n",
       " '20210423',\n",
       " '20210426',\n",
       " '20210427',\n",
       " '20210428',\n",
       " '20210429',\n",
       " '20210430',\n",
       " '20210503',\n",
       " '20210504',\n",
       " '20210506',\n",
       " '20210507',\n",
       " '20210510',\n",
       " '20210511',\n",
       " '20210512',\n",
       " '20210513',\n",
       " '20210514',\n",
       " '20210517',\n",
       " '20210518',\n",
       " '20210520',\n",
       " '20210521',\n",
       " '20210524',\n",
       " '20210525',\n",
       " '20210526',\n",
       " '20210527',\n",
       " '20210528',\n",
       " '20210531',\n",
       " '20210601',\n",
       " '20210602',\n",
       " '20210603',\n",
       " '20210604',\n",
       " '20210607',\n",
       " '20210608',\n",
       " '20210609',\n",
       " '20210610',\n",
       " '20210611',\n",
       " '20210614',\n",
       " '20210615',\n",
       " '20210616',\n",
       " '20210617',\n",
       " '20210618',\n",
       " '20210621',\n",
       " '20210622',\n",
       " '20210623',\n",
       " '20210624',\n",
       " '20210625',\n",
       " '20210628',\n",
       " '20210629',\n",
       " '20210630',\n",
       " '20210701',\n",
       " '20210702',\n",
       " '20210705',\n",
       " '20210706',\n",
       " '20210707',\n",
       " '20210708',\n",
       " '20210709',\n",
       " '20210712',\n",
       " '20210713',\n",
       " '20210714',\n",
       " '20210715',\n",
       " '20210716',\n",
       " '20210719',\n",
       " '20210720',\n",
       " '20210721',\n",
       " '20210722',\n",
       " '20210723',\n",
       " '20210726',\n",
       " '20210727',\n",
       " '20210728',\n",
       " '20210729',\n",
       " '20210730',\n",
       " '20210802',\n",
       " '20210803',\n",
       " '20210804',\n",
       " '20210805',\n",
       " '20210806',\n",
       " '20210809',\n",
       " '20210810',\n",
       " '20210811',\n",
       " '20210812',\n",
       " '20210813',\n",
       " '20210817',\n",
       " '20210818',\n",
       " '20210819',\n",
       " '20210820',\n",
       " '20210823',\n",
       " '20210824',\n",
       " '20210825',\n",
       " '20210826',\n",
       " '20210827',\n",
       " '20210830',\n",
       " '20210831',\n",
       " '20210901',\n",
       " '20210902',\n",
       " '20210903',\n",
       " '20210906',\n",
       " '20210907',\n",
       " '20210908',\n",
       " '20210909',\n",
       " '20210910',\n",
       " '20210913',\n",
       " '20210914',\n",
       " '20210915',\n",
       " '20210916',\n",
       " '20210917',\n",
       " '20210923',\n",
       " '20210924',\n",
       " '20210927',\n",
       " '20210928',\n",
       " '20210929',\n",
       " '20210930',\n",
       " '20211001',\n",
       " '20211005',\n",
       " '20211006',\n",
       " '20211007',\n",
       " '20211008',\n",
       " '20211012',\n",
       " '20211013',\n",
       " '20211014',\n",
       " '20211015',\n",
       " '20211018',\n",
       " '20211019',\n",
       " '20211020',\n",
       " '20211021',\n",
       " '20211022',\n",
       " '20211025',\n",
       " '20211026',\n",
       " '20211027',\n",
       " '20211028',\n",
       " '20211029',\n",
       " '20211101',\n",
       " '20211102',\n",
       " '20211103',\n",
       " '20211104',\n",
       " '20211105',\n",
       " '20211108',\n",
       " '20211109',\n",
       " '20211110',\n",
       " '20211111',\n",
       " '20211112',\n",
       " '20211115',\n",
       " '20211116',\n",
       " '20211117',\n",
       " '20211118',\n",
       " '20211119',\n",
       " '20211122',\n",
       " '20211123',\n",
       " '20211124',\n",
       " '20211125',\n",
       " '20211126',\n",
       " '20211129',\n",
       " '20211130',\n",
       " '20211201',\n",
       " '20211202',\n",
       " '20211203',\n",
       " '20211206',\n",
       " '20211207',\n",
       " '20211208',\n",
       " '20211209',\n",
       " '20211210',\n",
       " '20211213',\n",
       " '20211214',\n",
       " '20211215',\n",
       " '20211216',\n",
       " '20211217',\n",
       " '20211220',\n",
       " '20211221',\n",
       " '20211222',\n",
       " '20211223',\n",
       " '20211224',\n",
       " '20211227',\n",
       " '20211228',\n",
       " '20211229',\n",
       " '20211230',\n",
       " '20220104',\n",
       " '20220105',\n",
       " '20220106',\n",
       " '20220107',\n",
       " '20220110',\n",
       " '20220111',\n",
       " '20220112',\n",
       " '20220113',\n",
       " '20220114',\n",
       " '20220117',\n",
       " '20220118',\n",
       " '20220119',\n",
       " '20220120',\n",
       " '20220121',\n",
       " '20220124',\n",
       " '20220125',\n",
       " '20220126',\n",
       " '20220127',\n",
       " '20220128',\n",
       " '20220203',\n",
       " '20220204',\n",
       " '20220207',\n",
       " '20220208',\n",
       " '20220209',\n",
       " '20220210',\n",
       " '20220211',\n",
       " '20220214',\n",
       " '20220215',\n",
       " '20220216',\n",
       " '20220217',\n",
       " '20220218',\n",
       " '20220221',\n",
       " '20220222',\n",
       " '20220223',\n",
       " '20220224',\n",
       " '20220225',\n",
       " '20220228',\n",
       " '20220302',\n",
       " '20220303',\n",
       " '20220304',\n",
       " '20220307',\n",
       " '20220308',\n",
       " '20220310',\n",
       " '20220311',\n",
       " '20220314',\n",
       " '20220315',\n",
       " '20220316',\n",
       " '20220317',\n",
       " '20220318',\n",
       " '20220321',\n",
       " '20220322',\n",
       " '20220323',\n",
       " '20220324',\n",
       " '20220325',\n",
       " '20220328',\n",
       " '20220329',\n",
       " '20220330',\n",
       " '20220331']"
      ]
     },
     "execution_count": 26,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "df_0 = df[df['Price']==0].index\n",
    "date_0 = []\n",
    "for i in range(0,len(df_0)):\n",
    "    date_0.append(str(df_0.tolist()[i])[:10].replace('-',''))\n",
    "    \n",
    "date_0"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 27,
   "id": "e3d4b149",
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/plain": [
       "['20200109',\n",
       " '20200110',\n",
       " '20200116',\n",
       " '20200117',\n",
       " '20200121',\n",
       " '20200122',\n",
       " '20200123',\n",
       " '20200203',\n",
       " '20200204',\n",
       " '20200205',\n",
       " '20200210',\n",
       " '20200213',\n",
       " '20200218',\n",
       " '20200224',\n",
       " '20200225',\n",
       " '20200302',\n",
       " '20200303',\n",
       " '20200304',\n",
       " '20200305',\n",
       " '20200319',\n",
       " '20200323',\n",
       " '20200324',\n",
       " '20200325',\n",
       " '20200326',\n",
       " '20200327',\n",
       " '20200330',\n",
       " '20200331',\n",
       " '20200401',\n",
       " '20200402',\n",
       " '20200403',\n",
       " '20200406',\n",
       " '20200407',\n",
       " '20200409',\n",
       " '20200413',\n",
       " '20200414',\n",
       " '20200416',\n",
       " '20200417',\n",
       " '20200420',\n",
       " '20200421',\n",
       " '20200422',\n",
       " '20200424',\n",
       " '20200427',\n",
       " '20200507',\n",
       " '20200511',\n",
       " '20200513',\n",
       " '20200515',\n",
       " '20200521',\n",
       " '20200522',\n",
       " '20200526',\n",
       " '20200528',\n",
       " '20200529',\n",
       " '20200601',\n",
       " '20200604',\n",
       " '20200605',\n",
       " '20200608',\n",
       " '20200611',\n",
       " '20200615',\n",
       " '20200617',\n",
       " '20200619',\n",
       " '20200622',\n",
       " '20200623',\n",
       " '20200624']"
      ]
     },
     "execution_count": 27,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "df_1 = df[df['Price']==1].index\n",
    "\n",
    "date_1 = []\n",
    "for i in range(0,len(df_1)):\n",
    "    date_1.append(str(df_1.tolist()[i])[:10].replace('-',''))\n",
    "date_1"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 2,
   "id": "0e5cd5a0",
   "metadata": {},
   "outputs": [],
   "source": [
    "import requests\n",
    "from bs4 import BeautifulSoup\n",
    "import pandas as pd\n",
    "from urllib import parse\n",
    "from urllib.parse import quote\n",
    "import openpyxl"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 29,
   "id": "43157a96",
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/plain": [
       "'from IPython.core.display import display, HTML\\ndisplay(HTML(\"<style>.container { width:95% !important; }</style>\"))\\ndisplay(HTML(\"<style>.input_area pre {font-family: Consolas; font-size: 20pt; line-height: 140%;}</style>\"))\\ndisplay(HTML(\"<style>.output_area pre {font-family: Consolas; font-size: 20pt; line-height: 140%;}</style>\"))'"
      ]
     },
     "execution_count": 29,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "'''from IPython.core.display import display, HTML\n",
    "display(HTML(\"<style>.container { width:95% !important; }</style>\"))\n",
    "display(HTML(\"<style>.input_area pre {font-family: Consolas; font-size: 20pt; line-height: 140%;}</style>\"))\n",
    "display(HTML(\"<style>.output_area pre {font-family: Consolas; font-size: 20pt; line-height: 140%;}</style>\"))'''"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 30,
   "id": "cd3567b7",
   "metadata": {},
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "검색: 동화약품\n",
      "http://www.paxnet.co.kr/search/news?kwd=%EB%8F%99%ED%99%94%EC%95%BD%ED%92%88&wlog_nsise=search&order=1\n",
      "\n"
     ]
    }
   ],
   "source": [
    "def news_crawling(keyword):\n",
    "    global url\n",
    "    print(f'검색: {keyword}')\n",
    "    encoded_keyword=quote(keyword)\n",
    "    url=f\"http://www.paxnet.co.kr/search/news?kwd={encoded_keyword}&wlog_nsise=search&order=1\"\n",
    "    print(url)\n",
    "    res=requests.get(url)\n",
    "    soup= BeautifulSoup(res.text, 'lxml')\n",
    "    \n",
    "    result_list = []\n",
    "    error_cnt = 0\n",
    "    \n",
    "    pass\n",
    "\n",
    "   \n",
    "news_crawling('동화약품')\n",
    "print()"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 31,
   "id": "ab352a26",
   "metadata": {},
   "outputs": [],
   "source": [
    "result_list = []\n",
    "error_cnt = 0\n",
    "\n",
    "def paxnet_news_title(dates):\n",
    "    global url\n",
    "    \n",
    "    base_url = url +'&currentPageNo={}&genDate={}'\n",
    "        \n",
    "    headers = {\n",
    "        'User-Agent':'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.89 Safari/537.36'\n",
    "    }\n",
    "    \n",
    "    for date in dates:\n",
    "        for page in range(1, 3):\n",
    "            url = base_url.format(page, date)\n",
    "            res = requests.get(url, headers=headers)\n",
    "            if res.status_code == 200:\n",
    "                soup = BeautifulSoup(res.text)\n",
    "                title_list = soup.select('ul.thumb-list li')\n",
    "                for title in title_list:\n",
    "                    try:\n",
    "                        news_title = title.select_one('dl.text > dt').text.strip()\n",
    "                        result_list.append([news_title])\n",
    "                    except:\n",
    "                        error_cnt += 1"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 32,
   "id": "a9958093",
   "metadata": {
    "scrolled": false
   },
   "outputs": [
    {
     "data": {
      "text/html": [
       "<div>\n",
       "<style scoped>\n",
       "    .dataframe tbody tr th:only-of-type {\n",
       "        vertical-align: middle;\n",
       "    }\n",
       "\n",
       "    .dataframe tbody tr th {\n",
       "        vertical-align: top;\n",
       "    }\n",
       "\n",
       "    .dataframe thead th {\n",
       "        text-align: right;\n",
       "    }\n",
       "</style>\n",
       "<table border=\"1\" class=\"dataframe\">\n",
       "  <thead>\n",
       "    <tr style=\"text-align: right;\">\n",
       "      <th></th>\n",
       "      <th>뉴스제목</th>\n",
       "      <th>주가변동</th>\n",
       "    </tr>\n",
       "  </thead>\n",
       "  <tbody>\n",
       "    <tr>\n",
       "      <th>0</th>\n",
       "      <td>기술적분석-코스피</td>\n",
       "      <td>0</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>1</th>\n",
       "      <td>증시요약(7) - 기술적 분석 특징주 A(코스피)</td>\n",
       "      <td>0</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2</th>\n",
       "      <td>코스피 하락률 상위 20종목(직전 30분 기준)</td>\n",
       "      <td>0</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>3</th>\n",
       "      <td>코스피 상승률 상위 20종목(직전 30분 기준)</td>\n",
       "      <td>0</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>4</th>\n",
       "      <td>오후장 기술적 분석 특징주 A(코스피)</td>\n",
       "      <td>0</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>...</th>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>4795</th>\n",
       "      <td>CJ대한통운 건설부문, 서울 순화동 동화약품 사옥 신축공사 수주</td>\n",
       "      <td>1</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>4796</th>\n",
       "      <td>코스피 상승률 상위 20종목(직전 30분 기준)</td>\n",
       "      <td>1</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>4797</th>\n",
       "      <td>장마감 후 주요 종목 공시</td>\n",
       "      <td>1</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>4798</th>\n",
       "      <td>[e공시 눈에띄네] 코스피-20일</td>\n",
       "      <td>1</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>4799</th>\n",
       "      <td>[재송]20일 장 마감 후 주요 종목 뉴스</td>\n",
       "      <td>1</td>\n",
       "    </tr>\n",
       "  </tbody>\n",
       "</table>\n",
       "<p>48050 rows × 2 columns</p>\n",
       "</div>"
      ],
      "text/plain": [
       "                                     뉴스제목  주가변동\n",
       "0                               기술적분석-코스피     0\n",
       "1             증시요약(7) - 기술적 분석 특징주 A(코스피)     0\n",
       "2              코스피 하락률 상위 20종목(직전 30분 기준)     0\n",
       "3              코스피 상승률 상위 20종목(직전 30분 기준)     0\n",
       "4                   오후장 기술적 분석 특징주 A(코스피)     0\n",
       "...                                   ...   ...\n",
       "4795  CJ대한통운 건설부문, 서울 순화동 동화약품 사옥 신축공사 수주     1\n",
       "4796           코스피 상승률 상위 20종목(직전 30분 기준)     1\n",
       "4797                       장마감 후 주요 종목 공시     1\n",
       "4798                   [e공시 눈에띄네] 코스피-20일     1\n",
       "4799              [재송]20일 장 마감 후 주요 종목 뉴스     1\n",
       "\n",
       "[48050 rows x 2 columns]"
      ]
     },
     "execution_count": 32,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "paxnet_news_title(date_0)\n",
    "title_df_0 = pd.DataFrame(result_list, columns=['뉴스제목'])\n",
    "title_df_0['주가변동'] = 0\n",
    "result_list = []\n",
    "error_cnt = 0\n",
    "\n",
    "paxnet_news_title(date_1)\n",
    "title_df_1 = pd.DataFrame(result_list, columns=['뉴스제목'])\n",
    "title_df_1['주가변동'] = 1\n",
    "title_df = pd.concat([title_df_0, title_df_1])\n",
    "title_df.to_csv('팍스넷_뉴스타이틀.csv', index=False, encoding='utf-8')\n",
    "title_df"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 51,
   "id": "4e976c2f",
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/html": [
       "<div>\n",
       "<style scoped>\n",
       "    .dataframe tbody tr th:only-of-type {\n",
       "        vertical-align: middle;\n",
       "    }\n",
       "\n",
       "    .dataframe tbody tr th {\n",
       "        vertical-align: top;\n",
       "    }\n",
       "\n",
       "    .dataframe thead th {\n",
       "        text-align: right;\n",
       "    }\n",
       "</style>\n",
       "<table border=\"1\" class=\"dataframe\">\n",
       "  <thead>\n",
       "    <tr style=\"text-align: right;\">\n",
       "      <th></th>\n",
       "      <th>뉴스제목</th>\n",
       "      <th>주가변동</th>\n",
       "    </tr>\n",
       "  </thead>\n",
       "  <tbody>\n",
       "    <tr>\n",
       "      <th>0</th>\n",
       "      <td>동화약품, 여드름 치료제 '세비타비겔' 출시</td>\n",
       "      <td>0</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>1</th>\n",
       "      <td>코스피 상승률 상위 20종목(직전 30분 기준)</td>\n",
       "      <td>0</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2</th>\n",
       "      <td>한국제약바이오협회, '디지털헬스위원회' 본격 가동</td>\n",
       "      <td>0</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>3</th>\n",
       "      <td>동화약품(000020)  소폭 상승세 +3.75%</td>\n",
       "      <td>0</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>4</th>\n",
       "      <td>한국제약바이오협회, 디지털헬스위원회 본격 가동…\"디지털헬스케어 선도 역할\"</td>\n",
       "      <td>0</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>...</th>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>55395</th>\n",
       "      <td>CJ대한통운 건설부문, 서울 순화동 동화약품 사옥 신축공사 수주</td>\n",
       "      <td>1</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>55396</th>\n",
       "      <td>코스피 상승률 상위 20종목(직전 30분 기준)</td>\n",
       "      <td>1</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>55397</th>\n",
       "      <td>장마감 후 주요 종목 공시</td>\n",
       "      <td>1</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>55398</th>\n",
       "      <td>[e공시 눈에띄네] 코스피-20일</td>\n",
       "      <td>1</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>55399</th>\n",
       "      <td>[재송]20일 장 마감 후 주요 종목 뉴스</td>\n",
       "      <td>1</td>\n",
       "    </tr>\n",
       "  </tbody>\n",
       "</table>\n",
       "<p>55400 rows × 2 columns</p>\n",
       "</div>"
      ],
      "text/plain": [
       "                                            뉴스제목  주가변동\n",
       "0                       동화약품, 여드름 치료제 '세비타비겔' 출시     0\n",
       "1                     코스피 상승률 상위 20종목(직전 30분 기준)     0\n",
       "2                    한국제약바이오협회, '디지털헬스위원회' 본격 가동     0\n",
       "3                    동화약품(000020)  소폭 상승세 +3.75%     0\n",
       "4      한국제약바이오협회, 디지털헬스위원회 본격 가동…\"디지털헬스케어 선도 역할\"     0\n",
       "...                                          ...   ...\n",
       "55395        CJ대한통운 건설부문, 서울 순화동 동화약품 사옥 신축공사 수주     1\n",
       "55396                 코스피 상승률 상위 20종목(직전 30분 기준)     1\n",
       "55397                             장마감 후 주요 종목 공시     1\n",
       "55398                         [e공시 눈에띄네] 코스피-20일     1\n",
       "55399                    [재송]20일 장 마감 후 주요 종목 뉴스     1\n",
       "\n",
       "[55400 rows x 2 columns]"
      ]
     },
     "execution_count": 51,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "title_df = pd.read_csv('팍스넷_뉴스타이틀.csv', encoding='utf-8')\n",
    "title_df"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 52,
   "id": "5be7304d",
   "metadata": {},
   "outputs": [],
   "source": [
    "import scipy as sp\n",
    "import pandas as pd\n",
    "import numpy as np\n",
    "\n",
    "from konlpy.tag import Kkma        ; kkma = Kkma()\n",
    "from konlpy.tag import Hannanum    ; hannanum = Hannanum()\n",
    "from konlpy.tag import Okt         ; t = Okt()     # 구 트위터\n",
    "from konlpy.tag import *\n",
    "import nltk\n",
    "import pickle\n",
    "\n",
    "from wordcloud import WordCloud, STOPWORDS\n",
    "from PIL import Image\n",
    "\n",
    "from sklearn.feature_extraction.text import CountVectorizer\n",
    "from sklearn.feature_extraction.text import TfidfVectorizer \n",
    "from sklearn.linear_model import LogisticRegression\n",
    "from sklearn.ensemble import RandomForestClassifier # 추가한 부분\n",
    "from sklearn.pipeline import Pipeline \n",
    "from sklearn.metrics import accuracy_score\n",
    "from sklearn.model_selection import train_test_split\n",
    "\n",
    "%matplotlib inline\n",
    "import os\n",
    "import matplotlib.pyplot as plt\n",
    "import seaborn as sns\n",
    "import graphviz\n",
    "from sklearn.tree import export_graphviz\n",
    "\n",
    "import matplotlib.font_manager as fm\n",
    "plt.rc('font', family='NanumGothic')\n",
    "\n",
    "import matplotlib as mpl\n",
    "mpl.rcParams['axes.unicode_minus'] = False\n",
    "\n",
    "import warnings\n",
    "warnings.filterwarnings('ignore')"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 53,
   "id": "1180ca6a",
   "metadata": {},
   "outputs": [],
   "source": [
    "from wordcloud import WordCloud, STOPWORDS\n",
    "from PIL import Image\n",
    "\n",
    "import re\n",
    "import pandas as pd\n",
    "from tqdm import tqdm\n",
    "from konlpy.tag import Okt\n",
    "from collections import Counter"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 54,
   "id": "ac83a8d7",
   "metadata": {},
   "outputs": [],
   "source": [
    "def extract_word(text):\n",
    "    hangul = re.compile('[^가-힣]') \n",
    "    result = hangul.sub(' ', text) \n",
    "    return result"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "3781b081",
   "metadata": {},
   "source": [
    "#### 추가"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 55,
   "id": "e1206acc",
   "metadata": {},
   "outputs": [],
   "source": [
    "#title_df['뉴스제목'] = title_df['뉴스제목'].apply(lambda x:extract_word(x))\n",
    "title_df['nouns'] = title_df['뉴스제목'].apply(lambda x:extract_word(x))"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 56,
   "id": "0ba90ab9",
   "metadata": {},
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "107 {'동화약품': 0, '여드름': 0, '치료제': 0, '세비타비겔': 0, '출시': 0, '코스피': 0, '상승률': 0, '상위': 0, '종목': 0, '직전': 0, '기준': 0, '한국제약바이오협회': 0, '디지털헬스위원회': 0, '본격': 0, '가동': 0, '소폭': 0, '상승세': 0, '디지털헬스케어': 0, '선도': 0, '역할': 0, '기술적분석': 0, '증시요약': 0, '기술적': 0, '분석': 0, '특징주': 0, '코스닥': 0, '후시드': 0, '크림': 0, '개월': 0, '만에': 0, '누적': 0, '판매액': 0, '억원': 0, '돌파': 0, '판매고': 0, '달성': 0, '외국계': 0, '매수': 0, '유입': 0, '하락률': 0, '순식간에': 0, '등장한': 0, '모더나': 0, '백신': 0, '끈질긴': 0, '투자': 0, '결과물': 0, '서울국제신약포럼': 0, '오후장': 0, '오전장': 0, '비타민': 0, '소화제': 0, '파스': 0, '약값도': 0, '줄줄이': 0, '오른다': 0, '개장전': 0, '주요이슈': 0, '점검': 0, '메디케어': 0, '의료용': 0, '밴드': 0, '창상피복재': 0, '공동개발': 0, '업무협력': 0, '부음': 0, '임재준': 0, '한국거래소': 0, '유가증권시장본부': 0, '부이사장': 0, '모친상': 0, '부고': 0, '임재준씨': 0, '타이레놀': 0, '매출': 0, '강세': 0, '지속': 0, '일반의약품': 0, '증대': 0, '동화': 0, '바르지오': 0, '원스': 0, '여름철': 0, '손발톱': 0, '무좀': 0, '고민': 0, '대한통운': 0, '건설부문': 0, '사옥': 0, '신축공사': 0, '수주': 0, '순화동': 0, '철거': 0, '규모': 0, '재건축': 0, '역사': 0, '지상': 0, '신사옥': 0, '착공': 0, '서울': 0, '장마감': 0, '주요': 0, '공시': 0, '눈에띄네': 0, '재송': 0, '마감': 0, '뉴스': 0}\n"
     ]
    }
   ],
   "source": [
    "vocab = {}\n",
    "cnt = 0\n",
    "for i in title_df['nouns']:\n",
    "    i = i.split(' ')\n",
    "    for j in range(len(i)):\n",
    "        if i[j] in vocab or len(i[j])<=1:\n",
    "            cnt =cnt+1\n",
    "            pass\n",
    "        else:\n",
    "            vocab[i[j]] = 0\n",
    "\n",
    "vocab\n",
    "print(len(vocab), vocab) # 한글자짜리 빼고 저장"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 57,
   "id": "3b162d8f",
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/plain": [
       "{'동화약품': 2.6260704721892125e-10,\n",
       " '여드름': -1.4732659536775827e-12,\n",
       " '치료제': -1.4732659536775827e-12,\n",
       " '세비타비겔': -1.4732659536775827e-12,\n",
       " '출시': 2.6620927684462004e-12,\n",
       " '코스피': 8.083038682826782e-10,\n",
       " '상승률': 1.7165757704162843e-10,\n",
       " '상위': 3.990312524848605e-10,\n",
       " '종목': 4.899807226621533e-10,\n",
       " '직전': 1.2618284195298202e-10,\n",
       " '기준': 1.2618284195298202e-10,\n",
       " '한국제약바이오협회': 9.938050382629626e-12,\n",
       " '디지털헬스위원회': 9.938050382629626e-12,\n",
       " '본격': 9.938050382629626e-12,\n",
       " '가동': 9.938050382629626e-12,\n",
       " '소폭': 2.6620927684462004e-12,\n",
       " '상승세': 2.6620927684462004e-12,\n",
       " '디지털헬스케어': -1.4732659536775827e-12,\n",
       " '선도': -1.4732659536775827e-12,\n",
       " '역할': -1.4732659536775827e-12,\n",
       " '기술적분석': 3.523337177568919e-11,\n",
       " '증시요약': 2.6620927684462004e-12,\n",
       " '기술적': 3.523337177568919e-11,\n",
       " '분석': 3.523337177568919e-11,\n",
       " '특징주': 3.523337177568919e-11,\n",
       " '코스닥': -1.4845680240682668e-11,\n",
       " '후시드': 9.938050382629626e-12,\n",
       " '크림': 9.938050382629626e-12,\n",
       " '개월': 9.938050382629626e-12,\n",
       " '만에': -1.4732659536775827e-12,\n",
       " '누적': -1.4732659536775827e-12,\n",
       " '판매액': -1.4732659536775827e-12,\n",
       " '억원': -1.4732659536775827e-12,\n",
       " '돌파': -1.4732659536775827e-12,\n",
       " '판매고': -1.4732659536775827e-12,\n",
       " '달성': -1.4732659536775827e-12,\n",
       " '외국계': -1.4732659536775827e-12,\n",
       " '매수': -1.4732659536775827e-12,\n",
       " '유입': -1.4732659536775827e-12,\n",
       " '하락률': -1.0241363312957219e-11,\n",
       " '순식간에': -1.4732659536775827e-12,\n",
       " '등장한': -1.4732659536775827e-12,\n",
       " '모더나': -1.4732659536775827e-12,\n",
       " '백신': -1.4732659536775827e-12,\n",
       " '끈질긴': -1.4732659536775827e-12,\n",
       " '투자': -1.4732659536775827e-12,\n",
       " '결과물': -1.4732659536775827e-12,\n",
       " '서울국제신약포럼': -1.4732659536775827e-12,\n",
       " '오후장': -1.4732659536775827e-12,\n",
       " '오전장': 9.938050382629626e-12,\n",
       " '비타민': -1.4732659536775827e-12,\n",
       " '소화제': -1.4732659536775827e-12,\n",
       " '파스': -1.4732659536775827e-12,\n",
       " '약값도': -1.4732659536775827e-12,\n",
       " '줄줄이': -1.4732659536775827e-12,\n",
       " '오른다': -1.4732659536775827e-12,\n",
       " '개장전': -1.4732659536775827e-12,\n",
       " '주요이슈': -1.4732659536775827e-12,\n",
       " '점검': -1.4732659536775827e-12,\n",
       " '메디케어': -1.4732659536775827e-12,\n",
       " '의료용': -1.4732659536775827e-12,\n",
       " '밴드': -1.4732659536775827e-12,\n",
       " '창상피복재': -1.4732659536775827e-12,\n",
       " '공동개발': -1.4732659536775827e-12,\n",
       " '업무협력': -1.4732659536775827e-12,\n",
       " '부음': -1.4732659536775827e-12,\n",
       " '임재준': 9.938050382629626e-12,\n",
       " '한국거래소': 2.6620927684462004e-12,\n",
       " '유가증권시장본부': 2.6620927684462004e-12,\n",
       " '부이사장': 2.6620927684462004e-12,\n",
       " '모친상': 2.6620927684462004e-12,\n",
       " '부고': -1.4732659536775827e-12,\n",
       " '임재준씨': -1.4732659536775827e-12,\n",
       " '타이레놀': -1.4732659536775827e-12,\n",
       " '매출': 9.938050382629626e-12,\n",
       " '강세': -1.4732659536775827e-12,\n",
       " '지속': -1.4732659536775827e-12,\n",
       " '일반의약품': -1.4732659536775827e-12,\n",
       " '증대': -1.4732659536775827e-12,\n",
       " '동화': -1.4732659536775827e-12,\n",
       " '바르지오': -1.4732659536775827e-12,\n",
       " '원스': -1.4732659536775827e-12,\n",
       " '여름철': -1.4732659536775827e-12,\n",
       " '손발톱': -1.4732659536775827e-12,\n",
       " '무좀': -1.4732659536775827e-12,\n",
       " '고민': -1.4732659536775827e-12,\n",
       " '대한통운': 9.938050382629626e-12,\n",
       " '건설부문': 9.938050382629626e-12,\n",
       " '사옥': 2.6620927684462004e-12,\n",
       " '신축공사': 9.938050382629626e-12,\n",
       " '수주': 9.938050382629626e-12,\n",
       " '순화동': 2.6620927684462004e-12,\n",
       " '철거': -1.4732659536775827e-12,\n",
       " '규모': -1.4732659536775827e-12,\n",
       " '재건축': -1.4732659536775827e-12,\n",
       " '역사': -1.4732659536775827e-12,\n",
       " '지상': -1.4732659536775827e-12,\n",
       " '신사옥': -1.4732659536775827e-12,\n",
       " '착공': -1.4732659536775827e-12,\n",
       " '서울': -1.4732659536775827e-12,\n",
       " '장마감': -1.4732659536775827e-12,\n",
       " '주요': 9.938050382629626e-12,\n",
       " '공시': 9.938050382629626e-12,\n",
       " '눈에띄네': -1.4732659536775827e-12,\n",
       " '재송': -1.4732659536775827e-12,\n",
       " '마감': -1.4732659536775827e-12,\n",
       " '뉴스': -1.4732659536775827e-12}"
      ]
     },
     "execution_count": 57,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "up = 6200\n",
    "down = 49200\n",
    "up_ratio = up/(up+down)\n",
    "down_ratio = down/(up+down)\n",
    "\n",
    "import collections\n",
    "for i,w in enumerate(title_df['nouns']):\n",
    "    w = w.split(' ')\n",
    "    if (title_df.iloc[i]['주가변동']==1):\n",
    "        for j in range(len(w)):\n",
    "            noun = w[j]\n",
    "            if len(noun)<=1:\n",
    "                continue\n",
    "            vocab[noun] = vocab[noun] + down_ratio\n",
    "    else:\n",
    "        for j in range(len(w)):\n",
    "            noun = w[j]\n",
    "            if len(noun)<=1:\n",
    "                continue\n",
    "            vocab[noun] = vocab[noun] - up_ratio\n",
    "            \n",
    "vocab"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 58,
   "id": "fbabe50d",
   "metadata": {
    "scrolled": true
   },
   "outputs": [
    {
     "data": {
      "text/html": [
       "<div>\n",
       "<style scoped>\n",
       "    .dataframe tbody tr th:only-of-type {\n",
       "        vertical-align: middle;\n",
       "    }\n",
       "\n",
       "    .dataframe tbody tr th {\n",
       "        vertical-align: top;\n",
       "    }\n",
       "\n",
       "    .dataframe thead th {\n",
       "        text-align: right;\n",
       "    }\n",
       "</style>\n",
       "<table border=\"1\" class=\"dataframe\">\n",
       "  <thead>\n",
       "    <tr style=\"text-align: right;\">\n",
       "      <th></th>\n",
       "      <th>뉴스제목</th>\n",
       "      <th>주가변동</th>\n",
       "      <th>nouns</th>\n",
       "      <th>sent_score</th>\n",
       "    </tr>\n",
       "  </thead>\n",
       "  <tbody>\n",
       "    <tr>\n",
       "      <th>0</th>\n",
       "      <td>동화약품, 여드름 치료제 '세비타비겔' 출시</td>\n",
       "      <td>0</td>\n",
       "      <td>동화약품  여드름 치료제  세비타비겔  출시</td>\n",
       "      <td>3.260617e-11</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>1</th>\n",
       "      <td>코스피 상승률 상위 20종목(직전 30분 기준)</td>\n",
       "      <td>0</td>\n",
       "      <td>코스피 상승률 상위   종목 직전   분 기준</td>\n",
       "      <td>1.767783e-10</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2</th>\n",
       "      <td>한국제약바이오협회, '디지털헬스위원회' 본격 가동</td>\n",
       "      <td>0</td>\n",
       "      <td>한국제약바이오협회   디지털헬스위원회  본격 가동</td>\n",
       "      <td>5.678886e-12</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>3</th>\n",
       "      <td>동화약품(000020)  소폭 상승세 +3.75%</td>\n",
       "      <td>0</td>\n",
       "      <td>동화약품          소폭 상승세</td>\n",
       "      <td>1.410164e-11</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>4</th>\n",
       "      <td>한국제약바이오협회, 디지털헬스위원회 본격 가동…\"디지털헬스케어 선도 역할\"</td>\n",
       "      <td>0</td>\n",
       "      <td>한국제약바이오협회  디지털헬스위원회 본격 가동  디지털헬스케어 선도 역할</td>\n",
       "      <td>3.533240e-12</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>...</th>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>55395</th>\n",
       "      <td>CJ대한통운 건설부문, 서울 순화동 동화약품 사옥 신축공사 수주</td>\n",
       "      <td>1</td>\n",
       "      <td>대한통운 건설부문  서울 순화동 동화약품 사옥 신축공사 수주</td>\n",
       "      <td>2.783729e-11</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>55396</th>\n",
       "      <td>코스피 상승률 상위 20종목(직전 30분 기준)</td>\n",
       "      <td>1</td>\n",
       "      <td>코스피 상승률 상위   종목 직전   분 기준</td>\n",
       "      <td>1.767783e-10</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>55397</th>\n",
       "      <td>장마감 후 주요 종목 공시</td>\n",
       "      <td>1</td>\n",
       "      <td>장마감 후 주요 종목 공시</td>\n",
       "      <td>1.016767e-10</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>55398</th>\n",
       "      <td>[e공시 눈에띄네] 코스피-20일</td>\n",
       "      <td>1</td>\n",
       "      <td>공시 눈에띄네  코스피   일</td>\n",
       "      <td>9.075207e-11</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>55399</th>\n",
       "      <td>[재송]20일 장 마감 후 주요 종목 뉴스</td>\n",
       "      <td>1</td>\n",
       "      <td>재송   일 장 마감 후 주요 종목 뉴스</td>\n",
       "      <td>4.504536e-11</td>\n",
       "    </tr>\n",
       "  </tbody>\n",
       "</table>\n",
       "<p>55400 rows × 4 columns</p>\n",
       "</div>"
      ],
      "text/plain": [
       "                                            뉴스제목  주가변동  \\\n",
       "0                       동화약품, 여드름 치료제 '세비타비겔' 출시     0   \n",
       "1                     코스피 상승률 상위 20종목(직전 30분 기준)     0   \n",
       "2                    한국제약바이오협회, '디지털헬스위원회' 본격 가동     0   \n",
       "3                    동화약품(000020)  소폭 상승세 +3.75%     0   \n",
       "4      한국제약바이오협회, 디지털헬스위원회 본격 가동…\"디지털헬스케어 선도 역할\"     0   \n",
       "...                                          ...   ...   \n",
       "55395        CJ대한통운 건설부문, 서울 순화동 동화약품 사옥 신축공사 수주     1   \n",
       "55396                 코스피 상승률 상위 20종목(직전 30분 기준)     1   \n",
       "55397                             장마감 후 주요 종목 공시     1   \n",
       "55398                         [e공시 눈에띄네] 코스피-20일     1   \n",
       "55399                    [재송]20일 장 마감 후 주요 종목 뉴스     1   \n",
       "\n",
       "                                           nouns    sent_score  \n",
       "0                       동화약품  여드름 치료제  세비타비겔  출시  3.260617e-11  \n",
       "1                     코스피 상승률 상위   종목 직전   분 기준   1.767783e-10  \n",
       "2                    한국제약바이오협회   디지털헬스위원회  본격 가동  5.678886e-12  \n",
       "3                    동화약품          소폭 상승세         1.410164e-11  \n",
       "4      한국제약바이오협회  디지털헬스위원회 본격 가동  디지털헬스케어 선도 역할   3.533240e-12  \n",
       "...                                          ...           ...  \n",
       "55395          대한통운 건설부문  서울 순화동 동화약품 사옥 신축공사 수주  2.783729e-11  \n",
       "55396                 코스피 상승률 상위   종목 직전   분 기준   1.767783e-10  \n",
       "55397                             장마감 후 주요 종목 공시  1.016767e-10  \n",
       "55398                           공시 눈에띄네  코스피   일  9.075207e-11  \n",
       "55399                     재송   일 장 마감 후 주요 종목 뉴스  4.504536e-11  \n",
       "\n",
       "[55400 rows x 4 columns]"
      ]
     },
     "execution_count": 58,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "total = []\n",
    "for i,w  in enumerate(title_df['nouns']):\n",
    "    sent_score = 0\n",
    "    w= w.split(' ')\n",
    "    for j in w:\n",
    "        if(len(j)<=1):\n",
    "            continue\n",
    "        elif(j not in vocab):\n",
    "            continue\n",
    "        else:\n",
    "            sent_score = sent_score + vocab[j]\n",
    "    total.append(sent_score/len(w))\n",
    "title_df['sent_score'] = total\n",
    "title_df"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 59,
   "id": "05feabee",
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/plain": [
       "('유입', -1.4732659536775827e-12)"
      ]
     },
     "execution_count": 59,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "import operator \n",
    "sorted(vocab.items(), key=operator.itemgetter(1), reverse=True)[52] # 중간값"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 60,
   "id": "df449963",
   "metadata": {},
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "53.5\n",
      "2.4161123776652177e-11\n"
     ]
    }
   ],
   "source": [
    "print(len(vocab)/2) # 중간\n",
    "print(sent_mean) # 평균"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 99,
   "id": "354877b4",
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/html": [
       "<div>\n",
       "<style scoped>\n",
       "    .dataframe tbody tr th:only-of-type {\n",
       "        vertical-align: middle;\n",
       "    }\n",
       "\n",
       "    .dataframe tbody tr th {\n",
       "        vertical-align: top;\n",
       "    }\n",
       "\n",
       "    .dataframe thead th {\n",
       "        text-align: right;\n",
       "    }\n",
       "</style>\n",
       "<table border=\"1\" class=\"dataframe\">\n",
       "  <thead>\n",
       "    <tr style=\"text-align: right;\">\n",
       "      <th></th>\n",
       "      <th>뉴스제목</th>\n",
       "      <th>주가변동</th>\n",
       "      <th>nouns</th>\n",
       "      <th>sent_score</th>\n",
       "      <th>sent_label</th>\n",
       "    </tr>\n",
       "  </thead>\n",
       "  <tbody>\n",
       "    <tr>\n",
       "      <th>0</th>\n",
       "      <td>동화약품, 여드름 치료제 '세비타비겔' 출시</td>\n",
       "      <td>0</td>\n",
       "      <td>동화약품  여드름 치료제  세비타비겔  출시</td>\n",
       "      <td>3.260617e-11</td>\n",
       "      <td>1</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>1</th>\n",
       "      <td>코스피 상승률 상위 20종목(직전 30분 기준)</td>\n",
       "      <td>0</td>\n",
       "      <td>코스피 상승률 상위   종목 직전   분 기준</td>\n",
       "      <td>1.767783e-10</td>\n",
       "      <td>1</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2</th>\n",
       "      <td>한국제약바이오협회, '디지털헬스위원회' 본격 가동</td>\n",
       "      <td>0</td>\n",
       "      <td>한국제약바이오협회   디지털헬스위원회  본격 가동</td>\n",
       "      <td>5.678886e-12</td>\n",
       "      <td>0</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>3</th>\n",
       "      <td>동화약품(000020)  소폭 상승세 +3.75%</td>\n",
       "      <td>0</td>\n",
       "      <td>동화약품          소폭 상승세</td>\n",
       "      <td>1.410164e-11</td>\n",
       "      <td>0</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>4</th>\n",
       "      <td>한국제약바이오협회, 디지털헬스위원회 본격 가동…\"디지털헬스케어 선도 역할\"</td>\n",
       "      <td>0</td>\n",
       "      <td>한국제약바이오협회  디지털헬스위원회 본격 가동  디지털헬스케어 선도 역할</td>\n",
       "      <td>3.533240e-12</td>\n",
       "      <td>0</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>...</th>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>55395</th>\n",
       "      <td>CJ대한통운 건설부문, 서울 순화동 동화약품 사옥 신축공사 수주</td>\n",
       "      <td>1</td>\n",
       "      <td>대한통운 건설부문  서울 순화동 동화약품 사옥 신축공사 수주</td>\n",
       "      <td>2.783729e-11</td>\n",
       "      <td>1</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>55396</th>\n",
       "      <td>코스피 상승률 상위 20종목(직전 30분 기준)</td>\n",
       "      <td>1</td>\n",
       "      <td>코스피 상승률 상위   종목 직전   분 기준</td>\n",
       "      <td>1.767783e-10</td>\n",
       "      <td>1</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>55397</th>\n",
       "      <td>장마감 후 주요 종목 공시</td>\n",
       "      <td>1</td>\n",
       "      <td>장마감 후 주요 종목 공시</td>\n",
       "      <td>1.016767e-10</td>\n",
       "      <td>1</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>55398</th>\n",
       "      <td>[e공시 눈에띄네] 코스피-20일</td>\n",
       "      <td>1</td>\n",
       "      <td>공시 눈에띄네  코스피   일</td>\n",
       "      <td>9.075207e-11</td>\n",
       "      <td>1</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>55399</th>\n",
       "      <td>[재송]20일 장 마감 후 주요 종목 뉴스</td>\n",
       "      <td>1</td>\n",
       "      <td>재송   일 장 마감 후 주요 종목 뉴스</td>\n",
       "      <td>4.504536e-11</td>\n",
       "      <td>1</td>\n",
       "    </tr>\n",
       "  </tbody>\n",
       "</table>\n",
       "<p>55400 rows × 5 columns</p>\n",
       "</div>"
      ],
      "text/plain": [
       "                                            뉴스제목  주가변동  \\\n",
       "0                       동화약품, 여드름 치료제 '세비타비겔' 출시     0   \n",
       "1                     코스피 상승률 상위 20종목(직전 30분 기준)     0   \n",
       "2                    한국제약바이오협회, '디지털헬스위원회' 본격 가동     0   \n",
       "3                    동화약품(000020)  소폭 상승세 +3.75%     0   \n",
       "4      한국제약바이오협회, 디지털헬스위원회 본격 가동…\"디지털헬스케어 선도 역할\"     0   \n",
       "...                                          ...   ...   \n",
       "55395        CJ대한통운 건설부문, 서울 순화동 동화약품 사옥 신축공사 수주     1   \n",
       "55396                 코스피 상승률 상위 20종목(직전 30분 기준)     1   \n",
       "55397                             장마감 후 주요 종목 공시     1   \n",
       "55398                         [e공시 눈에띄네] 코스피-20일     1   \n",
       "55399                    [재송]20일 장 마감 후 주요 종목 뉴스     1   \n",
       "\n",
       "                                           nouns    sent_score  sent_label  \n",
       "0                       동화약품  여드름 치료제  세비타비겔  출시  3.260617e-11           1  \n",
       "1                     코스피 상승률 상위   종목 직전   분 기준   1.767783e-10           1  \n",
       "2                    한국제약바이오협회   디지털헬스위원회  본격 가동  5.678886e-12           0  \n",
       "3                    동화약품          소폭 상승세         1.410164e-11           0  \n",
       "4      한국제약바이오협회  디지털헬스위원회 본격 가동  디지털헬스케어 선도 역할   3.533240e-12           0  \n",
       "...                                          ...           ...         ...  \n",
       "55395          대한통운 건설부문  서울 순화동 동화약품 사옥 신축공사 수주  2.783729e-11           1  \n",
       "55396                 코스피 상승률 상위   종목 직전   분 기준   1.767783e-10           1  \n",
       "55397                             장마감 후 주요 종목 공시  1.016767e-10           1  \n",
       "55398                           공시 눈에띄네  코스피   일  9.075207e-11           1  \n",
       "55399                     재송   일 장 마감 후 주요 종목 뉴스  4.504536e-11           1  \n",
       "\n",
       "[55400 rows x 5 columns]"
      ]
     },
     "execution_count": 99,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "sum = 0\n",
    "for i in range(len(vocab)):\n",
    "    sum = sum + list(vocab.values())[i]\n",
    "sent_mean = sum/len(vocab)\n",
    "\n",
    "a_ = []\n",
    "for i in range(len(title_df)):\n",
    "    if(title_df.iloc[i]['sent_score']>sent_mean):\n",
    "        a_.append(1)\n",
    "    else:\n",
    "        a_.append(0)\n",
    "title_df['sent_label'] = a_\n",
    "title_df"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 101,
   "id": "4d3a3a96",
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/html": [
       "<div>\n",
       "<style scoped>\n",
       "    .dataframe tbody tr th:only-of-type {\n",
       "        vertical-align: middle;\n",
       "    }\n",
       "\n",
       "    .dataframe tbody tr th {\n",
       "        vertical-align: top;\n",
       "    }\n",
       "\n",
       "    .dataframe thead th {\n",
       "        text-align: right;\n",
       "    }\n",
       "</style>\n",
       "<table border=\"1\" class=\"dataframe\">\n",
       "  <thead>\n",
       "    <tr style=\"text-align: right;\">\n",
       "      <th></th>\n",
       "      <th>뉴스제목</th>\n",
       "      <th>주가변동</th>\n",
       "      <th>nouns</th>\n",
       "      <th>sent_score</th>\n",
       "      <th>sent_label</th>\n",
       "    </tr>\n",
       "  </thead>\n",
       "  <tbody>\n",
       "    <tr>\n",
       "      <th>0</th>\n",
       "      <td>동화약품, 여드름 치료제 '세비타비겔' 출시</td>\n",
       "      <td>0</td>\n",
       "      <td>동화약품  여드름 치료제  세비타비겔  출시</td>\n",
       "      <td>3.260617e-11</td>\n",
       "      <td>1</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>1</th>\n",
       "      <td>코스피 상승률 상위 20종목(직전 30분 기준)</td>\n",
       "      <td>0</td>\n",
       "      <td>코스피 상승률 상위   종목 직전   분 기준</td>\n",
       "      <td>1.767783e-10</td>\n",
       "      <td>1</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2</th>\n",
       "      <td>한국제약바이오협회, '디지털헬스위원회' 본격 가동</td>\n",
       "      <td>0</td>\n",
       "      <td>한국제약바이오협회   디지털헬스위원회  본격 가동</td>\n",
       "      <td>5.678886e-12</td>\n",
       "      <td>0</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>3</th>\n",
       "      <td>동화약품(000020)  소폭 상승세 +3.75%</td>\n",
       "      <td>0</td>\n",
       "      <td>동화약품          소폭 상승세</td>\n",
       "      <td>1.410164e-11</td>\n",
       "      <td>0</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>4</th>\n",
       "      <td>한국제약바이오협회, 디지털헬스위원회 본격 가동…\"디지털헬스케어 선도 역할\"</td>\n",
       "      <td>0</td>\n",
       "      <td>한국제약바이오협회  디지털헬스위원회 본격 가동  디지털헬스케어 선도 역할</td>\n",
       "      <td>3.533240e-12</td>\n",
       "      <td>0</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>...</th>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>55395</th>\n",
       "      <td>CJ대한통운 건설부문, 서울 순화동 동화약품 사옥 신축공사 수주</td>\n",
       "      <td>1</td>\n",
       "      <td>대한통운 건설부문  서울 순화동 동화약품 사옥 신축공사 수주</td>\n",
       "      <td>2.783729e-11</td>\n",
       "      <td>1</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>55396</th>\n",
       "      <td>코스피 상승률 상위 20종목(직전 30분 기준)</td>\n",
       "      <td>1</td>\n",
       "      <td>코스피 상승률 상위   종목 직전   분 기준</td>\n",
       "      <td>1.767783e-10</td>\n",
       "      <td>1</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>55397</th>\n",
       "      <td>장마감 후 주요 종목 공시</td>\n",
       "      <td>1</td>\n",
       "      <td>장마감 후 주요 종목 공시</td>\n",
       "      <td>1.016767e-10</td>\n",
       "      <td>1</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>55398</th>\n",
       "      <td>[e공시 눈에띄네] 코스피-20일</td>\n",
       "      <td>1</td>\n",
       "      <td>공시 눈에띄네  코스피   일</td>\n",
       "      <td>9.075207e-11</td>\n",
       "      <td>1</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>55399</th>\n",
       "      <td>[재송]20일 장 마감 후 주요 종목 뉴스</td>\n",
       "      <td>1</td>\n",
       "      <td>재송   일 장 마감 후 주요 종목 뉴스</td>\n",
       "      <td>4.504536e-11</td>\n",
       "      <td>1</td>\n",
       "    </tr>\n",
       "  </tbody>\n",
       "</table>\n",
       "<p>55400 rows × 5 columns</p>\n",
       "</div>"
      ],
      "text/plain": [
       "                                            뉴스제목  주가변동  \\\n",
       "0                       동화약품, 여드름 치료제 '세비타비겔' 출시     0   \n",
       "1                     코스피 상승률 상위 20종목(직전 30분 기준)     0   \n",
       "2                    한국제약바이오협회, '디지털헬스위원회' 본격 가동     0   \n",
       "3                    동화약품(000020)  소폭 상승세 +3.75%     0   \n",
       "4      한국제약바이오협회, 디지털헬스위원회 본격 가동…\"디지털헬스케어 선도 역할\"     0   \n",
       "...                                          ...   ...   \n",
       "55395        CJ대한통운 건설부문, 서울 순화동 동화약품 사옥 신축공사 수주     1   \n",
       "55396                 코스피 상승률 상위 20종목(직전 30분 기준)     1   \n",
       "55397                             장마감 후 주요 종목 공시     1   \n",
       "55398                         [e공시 눈에띄네] 코스피-20일     1   \n",
       "55399                    [재송]20일 장 마감 후 주요 종목 뉴스     1   \n",
       "\n",
       "                                           nouns    sent_score  sent_label  \n",
       "0                       동화약품  여드름 치료제  세비타비겔  출시  3.260617e-11           1  \n",
       "1                     코스피 상승률 상위   종목 직전   분 기준   1.767783e-10           1  \n",
       "2                    한국제약바이오협회   디지털헬스위원회  본격 가동  5.678886e-12           0  \n",
       "3                    동화약품          소폭 상승세         1.410164e-11           0  \n",
       "4      한국제약바이오협회  디지털헬스위원회 본격 가동  디지털헬스케어 선도 역할   3.533240e-12           0  \n",
       "...                                          ...           ...         ...  \n",
       "55395          대한통운 건설부문  서울 순화동 동화약품 사옥 신축공사 수주  2.783729e-11           1  \n",
       "55396                 코스피 상승률 상위   종목 직전   분 기준   1.767783e-10           1  \n",
       "55397                             장마감 후 주요 종목 공시  1.016767e-10           1  \n",
       "55398                           공시 눈에띄네  코스피   일  9.075207e-11           1  \n",
       "55399                     재송   일 장 마감 후 주요 종목 뉴스  4.504536e-11           1  \n",
       "\n",
       "[55400 rows x 5 columns]"
      ]
     },
     "execution_count": 101,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "title_df.dropna(how='any',inplace= True)\n",
    "title_df"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 102,
   "id": "ed26ad00",
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/plain": [
       "1    32132\n",
       "0    23268\n",
       "Name: sent_label, dtype: int64"
      ]
     },
     "execution_count": 102,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "title_df['sent_label'].value_counts()"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "8cccafd0",
   "metadata": {},
   "source": [
    "#### 여기까지"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 103,
   "id": "d7ee6d89",
   "metadata": {},
   "outputs": [],
   "source": [
    "okt = Okt()\n",
    "remove_one_word = \" \".join(title_df['뉴스제목'].tolist())\n",
    "remove_one_word = okt.morphs(remove_one_word,stem=True)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 104,
   "id": "3f914e35",
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/plain": [
       "570620"
      ]
     },
     "execution_count": 104,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "with open('C:\\data\\stopwords.txt', 'r') as f:\n",
    "    list_file = f.readlines()\n",
    "stopwords = list_file[0].split(\",\")\n",
    "remove_stopwords  = [x for x in remove_one_word if x not in stopwords]\n",
    "len(remove_stopwords )"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 105,
   "id": "c9ba590e",
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/plain": [
       "[('코스피', 25484),\n",
       " ('(', 25484),\n",
       " (')', 25484),\n",
       " ('종목', 17728),\n",
       " ('상위', 15512),\n",
       " ('동화약품', 12188),\n",
       " (',', 12188),\n",
       " ('-', 11080),\n",
       " ('상', 9972),\n",
       " ('승률', 9972),\n",
       " ('20', 8864),\n",
       " ('직전', 8864),\n",
       " ('30분', 8864),\n",
       " ('기준', 8864),\n",
       " (\"'\", 6648),\n",
       " ('기술적분석', 6648),\n",
       " ('기술', 6648),\n",
       " ('적', 6648),\n",
       " ('분석', 6648),\n",
       " ('특징', 6648),\n",
       " ('주', 6648),\n",
       " ('50', 6648),\n",
       " ('한국', 5540),\n",
       " ('후', 5540),\n",
       " ('하락', 5540),\n",
       " ('률', 5540),\n",
       " ('[', 5540),\n",
       " (']', 5540),\n",
       " ('B', 5540),\n",
       " ('소', 4432),\n",
       " ('코스닥', 4432),\n",
       " ('장', 4432),\n",
       " ('·', 4432),\n",
       " ('사옥', 4432),\n",
       " ('출시', 3324),\n",
       " ('디지털', 3324),\n",
       " ('000020', 3324),\n",
       " ('폭', 3324),\n",
       " ('상승세', 3324),\n",
       " ('+', 3324),\n",
       " ('\"', 3324),\n",
       " ('증시', 3324),\n",
       " ('요약', 3324),\n",
       " ('7', 3324),\n",
       " ('한', 3324),\n",
       " ('주요', 3324),\n",
       " ('임재', 3324),\n",
       " ('준', 3324),\n",
       " ('거래소', 3324),\n",
       " ('유가', 3324),\n",
       " ('증권', 3324),\n",
       " ('시장', 3324),\n",
       " ('본부', 3324),\n",
       " ('부', 3324),\n",
       " ('이사장', 3324),\n",
       " ('씨', 3324),\n",
       " ('모친상', 3324),\n",
       " ('순', 3324),\n",
       " ('화동', 3324),\n",
       " ('제약', 2216),\n",
       " ('바이오', 2216),\n",
       " ('협회', 2216),\n",
       " ('헬스', 2216),\n",
       " ('위원회', 2216),\n",
       " ('본격', 2216),\n",
       " ('가동', 2216),\n",
       " ('시드', 2216),\n",
       " ('크림', 2216),\n",
       " ('개월', 2216),\n",
       " ('판매', 2216),\n",
       " ('신', 2216),\n",
       " ('약', 2216),\n",
       " ('8', 2216),\n",
       " ('오전', 2216),\n",
       " ('…', 2216),\n",
       " ('매출', 2216),\n",
       " ('CJ', 2216),\n",
       " ('대', 2216),\n",
       " ('통운', 2216),\n",
       " ('건설', 2216),\n",
       " ('부문', 2216),\n",
       " ('신축', 2216),\n",
       " ('공사', 2216),\n",
       " ('수주', 2216),\n",
       " ('16', 2216),\n",
       " ('층', 2216),\n",
       " ('공시', 2216),\n",
       " ('20일', 2216),\n",
       " ('여드름', 1108),\n",
       " ('치료', 1108),\n",
       " ('세비', 1108),\n",
       " ('타비', 1108),\n",
       " ('겔', 1108),\n",
       " ('3.75%', 1108),\n",
       " ('…\"', 1108),\n",
       " ('헬', 1108),\n",
       " ('스케', 1108),\n",
       " ('선도', 1108),\n",
       " ('역할', 1108),\n",
       " ('A', 1108),\n",
       " ('3.24%', 1108),\n",
       " ('만에', 1108),\n",
       " ('누적', 1108),\n",
       " ('액', 1108),\n",
       " ('100억원', 1108),\n",
       " ('돌파', 1108),\n",
       " ('100억', 1108),\n",
       " ('고', 1108),\n",
       " ('달성', 1108),\n",
       " ('3.22%', 1108),\n",
       " ('외국', 1108),\n",
       " ('계', 1108),\n",
       " ('매수', 1108),\n",
       " ('유입', 1108),\n",
       " ('순식간', 1108),\n",
       " ('등장', 1108),\n",
       " ('더', 1108),\n",
       " ('백신', 1108),\n",
       " ('50년', 1108),\n",
       " ('끈질기다', 1108),\n",
       " ('투자', 1108),\n",
       " ('결과물', 1108),\n",
       " ('14회', 1108),\n",
       " ('서', 1108),\n",
       " ('울', 1108),\n",
       " ('국제', 1108),\n",
       " ('포럼', 1108),\n",
       " ('오후', 1108),\n",
       " ('비타민', 1108),\n",
       " ('화제', 1108),\n",
       " ('파스', 1108),\n",
       " ('값', 1108),\n",
       " ('도', 1108),\n",
       " ('줄줄이', 1108),\n",
       " ('개장', 1108),\n",
       " ('전', 1108),\n",
       " ('★', 1108),\n",
       " ('이슈', 1108),\n",
       " ('점검', 1108),\n",
       " ('BK', 1108),\n",
       " ('메디케어', 1108),\n",
       " ('의료', 1108),\n",
       " ('용', 1108),\n",
       " ('밴드', 1108),\n",
       " ('창', 1108),\n",
       " ('상피', 1108),\n",
       " ('복재', 1108),\n",
       " ('공동', 1108),\n",
       " ('개발', 1108),\n",
       " ('업무', 1108),\n",
       " ('협력', 1108),\n",
       " ('부다', 1108),\n",
       " ('外', 1108),\n",
       " ('부고', 1108),\n",
       " ('타이레놀', 1108),\n",
       " ('강세', 1108),\n",
       " ('지속', 1108),\n",
       " ('일반의약품', 1108),\n",
       " ('20%', 1108),\n",
       " ('증대', 1108),\n",
       " ('동화', 1108),\n",
       " ('‘', 1108),\n",
       " ('바르다', 1108),\n",
       " ('원스', 1108),\n",
       " ('’', 1108),\n",
       " ('여름철', 1108),\n",
       " ('손발톱', 1108),\n",
       " ('무좀', 1108),\n",
       " ('고민', 1108),\n",
       " ('뚝', 1108),\n",
       " ('철거', 1108),\n",
       " ('규모', 1108),\n",
       " ('재건축', 1108),\n",
       " ('125년', 1108),\n",
       " ('역사', 1108),\n",
       " ('지상', 1108),\n",
       " ('착공', 1108),\n",
       " ('서울', 1108),\n",
       " ('장마', 1108),\n",
       " ('감', 1108),\n",
       " ('e', 1108),\n",
       " ('눈', 1108),\n",
       " ('띄다', 1108),\n",
       " ('재송', 1108),\n",
       " ('마감', 1108),\n",
       " ('뉴스', 1108)]"
      ]
     },
     "execution_count": 105,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "Counter(remove_stopwords).most_common()"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 11,
   "id": "056b238d",
   "metadata": {},
   "outputs": [],
   "source": [
    "def make_wordlist(news,stopwords): #reviews = \" \".join(data['Review'].tolist())\n",
    "    print(\"리뷰들을 모아 분석하는 중입니다.....\")\n",
    "    #정규표현식 적용\n",
    "    print(\"데이터 정제 중....\")\n",
    "    words = extract_word(news)\n",
    "    #형태소 추출\n",
    "    print(\"형태소 추출 중....\")\n",
    "    words = okt.morphs(words,stem=True)\n",
    "    #불용어 제거\n",
    "    print(\"불용어 제거 중....\")\n",
    "    words = [x for x in remove_one_word  if x not in stopwords]\n",
    "    return set(words) #조건을 만족하는 단어 리스트"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 12,
   "id": "874603ec",
   "metadata": {},
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "리뷰들을 모아 분석하는 중입니다.....\n",
      "데이터 정제 중....\n",
      "형태소 추출 중....\n",
      "불용어 제거 중....\n"
     ]
    }
   ],
   "source": [
    "word_list = make_wordlist(\" \".join(title_df[\"뉴스제목\"].tolist()), stopwords)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 19,
   "id": "60acf507",
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/plain": [
       "['메디케어',\n",
       " '가동',\n",
       " '철거',\n",
       " '증대',\n",
       " '부고',\n",
       " '결과물',\n",
       " '코스닥',\n",
       " '상피',\n",
       " '규모',\n",
       " '유가',\n",
       " '비타민',\n",
       " '상승세',\n",
       " '부다',\n",
       " '지상',\n",
       " '파스',\n",
       " '이사장',\n",
       " '분석',\n",
       " '크림',\n",
       " '개발',\n",
       " '오전',\n",
       " '돌파',\n",
       " '개월',\n",
       " '백신',\n",
       " '바르다',\n",
       " '공사',\n",
       " '원스',\n",
       " '건설',\n",
       " '누적',\n",
       " '복재',\n",
       " '본부',\n",
       " '코스피',\n",
       " '요약',\n",
       " '외국',\n",
       " '이슈',\n",
       " '무좀',\n",
       " '착공',\n",
       " '시드',\n",
       " '개장',\n",
       " '부문',\n",
       " '바이오',\n",
       " '손발톱',\n",
       " '종목',\n",
       " '임재',\n",
       " '여드름',\n",
       " '하락',\n",
       " '치료',\n",
       " '여름철',\n",
       " '헬스',\n",
       " '디지털',\n",
       " '스케',\n",
       " '달성',\n",
       " '선도',\n",
       " '화동',\n",
       " '증권',\n",
       " '기준',\n",
       " '줄줄이',\n",
       " '상위',\n",
       " '뉴스',\n",
       " '특징',\n",
       " '공시',\n",
       " '출시',\n",
       " '동화',\n",
       " '오후',\n",
       " '고민',\n",
       " '판매',\n",
       " '재건축',\n",
       " '타이레놀',\n",
       " '기술적분석',\n",
       " '협회',\n",
       " '등장',\n",
       " '재송',\n",
       " '승률',\n",
       " '세비',\n",
       " '본격',\n",
       " '주요',\n",
       " '협력',\n",
       " '매출',\n",
       " '화제',\n",
       " '마감',\n",
       " '직전',\n",
       " '강세',\n",
       " '유입',\n",
       " '거래소',\n",
       " '동화약품',\n",
       " '만에',\n",
       " '매수',\n",
       " '위원회',\n",
       " '국제',\n",
       " '끈질기다',\n",
       " '지속',\n",
       " '증시',\n",
       " '밴드',\n",
       " '한국',\n",
       " '역할',\n",
       " '모친상',\n",
       " '억원',\n",
       " '일반의약품',\n",
       " '신축',\n",
       " '역사',\n",
       " '사옥',\n",
       " '띄다',\n",
       " '투자',\n",
       " '제약',\n",
       " '통운',\n",
       " '순식간',\n",
       " '시장',\n",
       " '장마',\n",
       " '수주',\n",
       " '점검',\n",
       " '공동',\n",
       " '업무',\n",
       " '기술',\n",
       " '의료',\n",
       " '타비',\n",
       " '서울',\n",
       " '포럼']"
      ]
     },
     "execution_count": 19,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "word_list= [x for x in word_list if len(x) > 1]\n",
    "word_list"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 13,
   "id": "95b5c646",
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/html": [
       "<div>\n",
       "<style scoped>\n",
       "    .dataframe tbody tr th:only-of-type {\n",
       "        vertical-align: middle;\n",
       "    }\n",
       "\n",
       "    .dataframe tbody tr th {\n",
       "        vertical-align: top;\n",
       "    }\n",
       "\n",
       "    .dataframe thead th {\n",
       "        text-align: right;\n",
       "    }\n",
       "</style>\n",
       "<table border=\"1\" class=\"dataframe\">\n",
       "  <thead>\n",
       "    <tr style=\"text-align: right;\">\n",
       "      <th></th>\n",
       "      <th>뉴스제목</th>\n",
       "      <th>주가변동</th>\n",
       "    </tr>\n",
       "  </thead>\n",
       "  <tbody>\n",
       "    <tr>\n",
       "      <th>0</th>\n",
       "      <td>동화약품  여드름 치료제  세비타비겔  출시</td>\n",
       "      <td>0</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>1</th>\n",
       "      <td>코스피 상승률 상위   종목 직전   분 기준</td>\n",
       "      <td>0</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2</th>\n",
       "      <td>한국제약바이오협회   디지털헬스위원회  본격 가동</td>\n",
       "      <td>0</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>3</th>\n",
       "      <td>동화약품          소폭 상승세</td>\n",
       "      <td>0</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>4</th>\n",
       "      <td>한국제약바이오협회  디지털헬스위원회 본격 가동  디지털헬스케어 선도 역할</td>\n",
       "      <td>0</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>...</th>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>55395</th>\n",
       "      <td>대한통운 건설부문  서울 순화동 동화약품 사옥 신축공사 수주</td>\n",
       "      <td>1</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>55396</th>\n",
       "      <td>코스피 상승률 상위   종목 직전   분 기준</td>\n",
       "      <td>1</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>55397</th>\n",
       "      <td>장마감 후 주요 종목 공시</td>\n",
       "      <td>1</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>55398</th>\n",
       "      <td>공시 눈에띄네  코스피   일</td>\n",
       "      <td>1</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>55399</th>\n",
       "      <td>재송   일 장 마감 후 주요 종목 뉴스</td>\n",
       "      <td>1</td>\n",
       "    </tr>\n",
       "  </tbody>\n",
       "</table>\n",
       "<p>55400 rows × 2 columns</p>\n",
       "</div>"
      ],
      "text/plain": [
       "                                            뉴스제목  주가변동\n",
       "0                       동화약품  여드름 치료제  세비타비겔  출시     0\n",
       "1                     코스피 상승률 상위   종목 직전   분 기준      0\n",
       "2                    한국제약바이오협회   디지털헬스위원회  본격 가동     0\n",
       "3                    동화약품          소폭 상승세            0\n",
       "4      한국제약바이오협회  디지털헬스위원회 본격 가동  디지털헬스케어 선도 역할      0\n",
       "...                                          ...   ...\n",
       "55395          대한통운 건설부문  서울 순화동 동화약품 사옥 신축공사 수주     1\n",
       "55396                 코스피 상승률 상위   종목 직전   분 기준      1\n",
       "55397                             장마감 후 주요 종목 공시     1\n",
       "55398                           공시 눈에띄네  코스피   일     1\n",
       "55399                     재송   일 장 마감 후 주요 종목 뉴스     1\n",
       "\n",
       "[55400 rows x 2 columns]"
      ]
     },
     "execution_count": 13,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "title_df"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "f545125f",
   "metadata": {},
   "source": [
    "## 감정분석"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 106,
   "id": "bef4f69f",
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/html": [
       "<div>\n",
       "<style scoped>\n",
       "    .dataframe tbody tr th:only-of-type {\n",
       "        vertical-align: middle;\n",
       "    }\n",
       "\n",
       "    .dataframe tbody tr th {\n",
       "        vertical-align: top;\n",
       "    }\n",
       "\n",
       "    .dataframe thead th {\n",
       "        text-align: right;\n",
       "    }\n",
       "</style>\n",
       "<table border=\"1\" class=\"dataframe\">\n",
       "  <thead>\n",
       "    <tr style=\"text-align: right;\">\n",
       "      <th></th>\n",
       "      <th>뉴스제목</th>\n",
       "      <th>주가변동</th>\n",
       "      <th>nouns</th>\n",
       "      <th>sent_score</th>\n",
       "      <th>sent_label</th>\n",
       "    </tr>\n",
       "  </thead>\n",
       "  <tbody>\n",
       "    <tr>\n",
       "      <th>0</th>\n",
       "      <td>동화약품, 여드름 치료제 '세비타비겔' 출시</td>\n",
       "      <td>0</td>\n",
       "      <td>동화약품  여드름 치료제  세비타비겔  출시</td>\n",
       "      <td>3.260617e-11</td>\n",
       "      <td>1</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>1</th>\n",
       "      <td>코스피 상승률 상위 20종목(직전 30분 기준)</td>\n",
       "      <td>0</td>\n",
       "      <td>코스피 상승률 상위   종목 직전   분 기준</td>\n",
       "      <td>1.767783e-10</td>\n",
       "      <td>1</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2</th>\n",
       "      <td>한국제약바이오협회, '디지털헬스위원회' 본격 가동</td>\n",
       "      <td>0</td>\n",
       "      <td>한국제약바이오협회   디지털헬스위원회  본격 가동</td>\n",
       "      <td>5.678886e-12</td>\n",
       "      <td>0</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>3</th>\n",
       "      <td>동화약품(000020)  소폭 상승세 +3.75%</td>\n",
       "      <td>0</td>\n",
       "      <td>동화약품          소폭 상승세</td>\n",
       "      <td>1.410164e-11</td>\n",
       "      <td>0</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>4</th>\n",
       "      <td>한국제약바이오협회, 디지털헬스위원회 본격 가동…\"디지털헬스케어 선도 역할\"</td>\n",
       "      <td>0</td>\n",
       "      <td>한국제약바이오협회  디지털헬스위원회 본격 가동  디지털헬스케어 선도 역할</td>\n",
       "      <td>3.533240e-12</td>\n",
       "      <td>0</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>...</th>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>55395</th>\n",
       "      <td>CJ대한통운 건설부문, 서울 순화동 동화약품 사옥 신축공사 수주</td>\n",
       "      <td>1</td>\n",
       "      <td>대한통운 건설부문  서울 순화동 동화약품 사옥 신축공사 수주</td>\n",
       "      <td>2.783729e-11</td>\n",
       "      <td>1</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>55396</th>\n",
       "      <td>코스피 상승률 상위 20종목(직전 30분 기준)</td>\n",
       "      <td>1</td>\n",
       "      <td>코스피 상승률 상위   종목 직전   분 기준</td>\n",
       "      <td>1.767783e-10</td>\n",
       "      <td>1</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>55397</th>\n",
       "      <td>장마감 후 주요 종목 공시</td>\n",
       "      <td>1</td>\n",
       "      <td>장마감 후 주요 종목 공시</td>\n",
       "      <td>1.016767e-10</td>\n",
       "      <td>1</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>55398</th>\n",
       "      <td>[e공시 눈에띄네] 코스피-20일</td>\n",
       "      <td>1</td>\n",
       "      <td>공시 눈에띄네  코스피   일</td>\n",
       "      <td>9.075207e-11</td>\n",
       "      <td>1</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>55399</th>\n",
       "      <td>[재송]20일 장 마감 후 주요 종목 뉴스</td>\n",
       "      <td>1</td>\n",
       "      <td>재송   일 장 마감 후 주요 종목 뉴스</td>\n",
       "      <td>4.504536e-11</td>\n",
       "      <td>1</td>\n",
       "    </tr>\n",
       "  </tbody>\n",
       "</table>\n",
       "<p>55400 rows × 5 columns</p>\n",
       "</div>"
      ],
      "text/plain": [
       "                                            뉴스제목  주가변동  \\\n",
       "0                       동화약품, 여드름 치료제 '세비타비겔' 출시     0   \n",
       "1                     코스피 상승률 상위 20종목(직전 30분 기준)     0   \n",
       "2                    한국제약바이오협회, '디지털헬스위원회' 본격 가동     0   \n",
       "3                    동화약품(000020)  소폭 상승세 +3.75%     0   \n",
       "4      한국제약바이오협회, 디지털헬스위원회 본격 가동…\"디지털헬스케어 선도 역할\"     0   \n",
       "...                                          ...   ...   \n",
       "55395        CJ대한통운 건설부문, 서울 순화동 동화약품 사옥 신축공사 수주     1   \n",
       "55396                 코스피 상승률 상위 20종목(직전 30분 기준)     1   \n",
       "55397                             장마감 후 주요 종목 공시     1   \n",
       "55398                         [e공시 눈에띄네] 코스피-20일     1   \n",
       "55399                    [재송]20일 장 마감 후 주요 종목 뉴스     1   \n",
       "\n",
       "                                           nouns    sent_score  sent_label  \n",
       "0                       동화약품  여드름 치료제  세비타비겔  출시  3.260617e-11           1  \n",
       "1                     코스피 상승률 상위   종목 직전   분 기준   1.767783e-10           1  \n",
       "2                    한국제약바이오협회   디지털헬스위원회  본격 가동  5.678886e-12           0  \n",
       "3                    동화약품          소폭 상승세         1.410164e-11           0  \n",
       "4      한국제약바이오협회  디지털헬스위원회 본격 가동  디지털헬스케어 선도 역할   3.533240e-12           0  \n",
       "...                                          ...           ...         ...  \n",
       "55395          대한통운 건설부문  서울 순화동 동화약품 사옥 신축공사 수주  2.783729e-11           1  \n",
       "55396                 코스피 상승률 상위   종목 직전   분 기준   1.767783e-10           1  \n",
       "55397                             장마감 후 주요 종목 공시  1.016767e-10           1  \n",
       "55398                           공시 눈에띄네  코스피   일  9.075207e-11           1  \n",
       "55399                     재송   일 장 마감 후 주요 종목 뉴스  4.504536e-11           1  \n",
       "\n",
       "[55400 rows x 5 columns]"
      ]
     },
     "execution_count": 106,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "# 감정분석 모델 만들기\n",
    "title_df"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 107,
   "id": "ab0f2dbb",
   "metadata": {},
   "outputs": [],
   "source": [
    "# 형태소 분석을 위한 함수\n",
    "\n",
    "def tokenizer(text):\n",
    "    okt = Okt()\n",
    "    return okt.morphs(text)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 108,
   "id": "a73f7d65",
   "metadata": {},
   "outputs": [],
   "source": [
    "def data_preprocessing():\n",
    "    # 수집한 데이터 읽어오기\n",
    "    #title_df = pd.read_csv('팍스넷_뉴스타이틀.csv', encoding='utf-8')\n",
    "    \n",
    "    # 학습셋, 테스트셋 분리\n",
    "    \n",
    "    #title_list = title_df['뉴스제목'].tolist()\n",
    "    #price_list = title_df['주가변동'].tolist()\n",
    "    title_list = title_df['nouns'].tolist()\n",
    "    price_list = title_df['sent_label'].tolist()\n",
    "    \n",
    "    from sklearn.model_selection import train_test_split\n",
    "    \n",
    "    # 데이터의 80%는 학습셋, 20%는 테스트셋\n",
    "    title_train, title_test, price_train, price_test = train_test_split(title_list, price_list, test_size=0.2, random_state=0)\n",
    "    \n",
    "    return title_train, title_test, price_train, price_test"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 109,
   "id": "3abb62f9",
   "metadata": {},
   "outputs": [],
   "source": [
    "def learning(x_train, y_train, x_test, y_test):\n",
    "    # 전처리가 끝난 데이터를 단어 사전으로 만들고\n",
    "    # 리뷰별로 나오는 단어를 파악해서 수치화 (벡터화)해서 학습\n",
    "    # tfidf, 로지스틱 회귀 이용\n",
    "    \n",
    "    tfidf = TfidfVectorizer(lowercase=False, tokenizer=tokenizer)\n",
    "    # 로지스틱\n",
    "    logistic = LogisticRegression(C=2, penalty='l2', random_state=0)     # C의 숫자가 너무 크면 과적합 (기본 1), penalty로 과적합 방지\n",
    "    \n",
    "    pipe = Pipeline([('vect',tfidf),('clf',logistic)])\n",
    "    \n",
    "    # 학습\n",
    "    pipe.fit(x_train, y_train)\n",
    "    \n",
    "    # 학습 정확도 측정\n",
    "    y_pred = pipe.predict(x_test)\n",
    "    print(accuracy_score(y_test, y_pred))\n",
    "\n",
    "    # 학습한 모델을 저장\n",
    "    with open('pipe.dat', 'wb') as fp:     # 쓰기, 바탕화면에 저장됨\n",
    "        pickle.dump(pipe, fp)\n",
    "        \n",
    "    print('저장완료')     # 학습된 모델 저장 완료"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "579940ca",
   "metadata": {},
   "source": [
    "#### 추가"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 112,
   "id": "a6710f24",
   "metadata": {},
   "outputs": [],
   "source": [
    "from sklearn.feature_extraction.text import TfidfTransformer\n",
    "\n",
    "with open('C:\\data\\stopwords.txt', 'r') as f:\n",
    "    list_file = f.readlines()\n",
    "stopwords = list_file[0].split(\",\")\n",
    "\n",
    "def text_cleaning(text):\n",
    "    hangul = re.compile('[^ 가-힣]')  # 정규 표현식 처리\n",
    "    result = hangul.sub('', text)\n",
    "    okt = Okt()  # 형태소 추출\n",
    "    nouns = okt.nouns(result)\n",
    "    nouns = [x for x in nouns if len(x) > 1]  # 한글자 키워드 제거\n",
    "    nouns = [x for x in nouns if x not in stopwords]  # 불용어 제거\n",
    "    return nouns\n",
    "\n",
    "vect = CountVectorizer(tokenizer = lambda x: text_cleaning(x))\n",
    "bow_vect = vect.fit_transform(title_df['nouns'].tolist())\n",
    "word_list = vect.get_feature_names()\n",
    "count_list = bow_vect.toarray().sum(axis=0)\n",
    "tfidf_vectorizer = TfidfTransformer()\n",
    "tf_idf_vect = tfidf_vectorizer.fit_transform(bow_vect)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 113,
   "id": "00a5efaa",
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/plain": [
       "1    32132\n",
       "0    23268\n",
       "Name: sent_label, dtype: int64"
      ]
     },
     "execution_count": 113,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "title_df['sent_label'].value_counts()"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 80,
   "id": "7fddf99b",
   "metadata": {},
   "outputs": [
    {
     "ename": "ValueError",
     "evalue": "Cannot take a larger sample than population when 'replace=False'",
     "output_type": "error",
     "traceback": [
      "\u001b[1;31m---------------------------------------------------------------------------\u001b[0m",
      "\u001b[1;31mValueError\u001b[0m                                Traceback (most recent call last)",
      "\u001b[1;32m<ipython-input-80-73af52eb295a>\u001b[0m in \u001b[0;36m<module>\u001b[1;34m\u001b[0m\n\u001b[0;32m      1\u001b[0m \u001b[0mpositive_random_idx\u001b[0m \u001b[1;33m=\u001b[0m \u001b[0mtitle_df\u001b[0m\u001b[1;33m[\u001b[0m\u001b[0mtitle_df\u001b[0m\u001b[1;33m[\u001b[0m\u001b[1;34m'sent_label'\u001b[0m\u001b[1;33m]\u001b[0m\u001b[1;33m==\u001b[0m\u001b[1;36m1\u001b[0m\u001b[1;33m]\u001b[0m\u001b[1;33m.\u001b[0m\u001b[0msample\u001b[0m\u001b[1;33m(\u001b[0m\u001b[1;36m6200\u001b[0m\u001b[1;33m,\u001b[0m \u001b[0mrandom_state\u001b[0m\u001b[1;33m=\u001b[0m\u001b[1;36m12\u001b[0m\u001b[1;33m)\u001b[0m\u001b[1;33m.\u001b[0m\u001b[0mindex\u001b[0m\u001b[1;33m.\u001b[0m\u001b[0mtolist\u001b[0m\u001b[1;33m(\u001b[0m\u001b[1;33m)\u001b[0m\u001b[1;33m\u001b[0m\u001b[1;33m\u001b[0m\u001b[0m\n\u001b[1;32m----> 2\u001b[1;33m \u001b[0mnegative_random_idx\u001b[0m \u001b[1;33m=\u001b[0m \u001b[0mtitle_df\u001b[0m\u001b[1;33m[\u001b[0m\u001b[0mtitle_df\u001b[0m\u001b[1;33m[\u001b[0m\u001b[1;34m'sent_label'\u001b[0m\u001b[1;33m]\u001b[0m\u001b[1;33m==\u001b[0m\u001b[1;36m0\u001b[0m\u001b[1;33m]\u001b[0m\u001b[1;33m.\u001b[0m\u001b[0msample\u001b[0m\u001b[1;33m(\u001b[0m\u001b[1;36m6200\u001b[0m\u001b[1;33m,\u001b[0m \u001b[0mrandom_state\u001b[0m\u001b[1;33m=\u001b[0m\u001b[1;36m12\u001b[0m\u001b[1;33m)\u001b[0m\u001b[1;33m.\u001b[0m\u001b[0mindex\u001b[0m\u001b[1;33m.\u001b[0m\u001b[0mtolist\u001b[0m\u001b[1;33m(\u001b[0m\u001b[1;33m)\u001b[0m\u001b[1;33m\u001b[0m\u001b[1;33m\u001b[0m\u001b[0m\n\u001b[0m\u001b[0;32m      3\u001b[0m \u001b[1;33m\u001b[0m\u001b[0m\n\u001b[0;32m      4\u001b[0m \u001b[0mrandom_idx\u001b[0m \u001b[1;33m=\u001b[0m \u001b[0mpositive_random_idx\u001b[0m \u001b[1;33m+\u001b[0m \u001b[0mnegative_random_idx\u001b[0m\u001b[1;33m\u001b[0m\u001b[1;33m\u001b[0m\u001b[0m\n\u001b[0;32m      5\u001b[0m \u001b[1;33m\u001b[0m\u001b[0m\n",
      "\u001b[1;32m~\\anaconda3\\lib\\site-packages\\pandas\\core\\generic.py\u001b[0m in \u001b[0;36msample\u001b[1;34m(self, n, frac, replace, weights, random_state, axis)\u001b[0m\n\u001b[0;32m   5348\u001b[0m             )\n\u001b[0;32m   5349\u001b[0m \u001b[1;33m\u001b[0m\u001b[0m\n\u001b[1;32m-> 5350\u001b[1;33m         \u001b[0mlocs\u001b[0m \u001b[1;33m=\u001b[0m \u001b[0mrs\u001b[0m\u001b[1;33m.\u001b[0m\u001b[0mchoice\u001b[0m\u001b[1;33m(\u001b[0m\u001b[0maxis_length\u001b[0m\u001b[1;33m,\u001b[0m \u001b[0msize\u001b[0m\u001b[1;33m=\u001b[0m\u001b[0mn\u001b[0m\u001b[1;33m,\u001b[0m \u001b[0mreplace\u001b[0m\u001b[1;33m=\u001b[0m\u001b[0mreplace\u001b[0m\u001b[1;33m,\u001b[0m \u001b[0mp\u001b[0m\u001b[1;33m=\u001b[0m\u001b[0mweights\u001b[0m\u001b[1;33m)\u001b[0m\u001b[1;33m\u001b[0m\u001b[1;33m\u001b[0m\u001b[0m\n\u001b[0m\u001b[0;32m   5351\u001b[0m         \u001b[1;32mreturn\u001b[0m \u001b[0mself\u001b[0m\u001b[1;33m.\u001b[0m\u001b[0mtake\u001b[0m\u001b[1;33m(\u001b[0m\u001b[0mlocs\u001b[0m\u001b[1;33m,\u001b[0m \u001b[0maxis\u001b[0m\u001b[1;33m=\u001b[0m\u001b[0maxis\u001b[0m\u001b[1;33m)\u001b[0m\u001b[1;33m\u001b[0m\u001b[1;33m\u001b[0m\u001b[0m\n\u001b[0;32m   5352\u001b[0m \u001b[1;33m\u001b[0m\u001b[0m\n",
      "\u001b[1;32mmtrand.pyx\u001b[0m in \u001b[0;36mnumpy.random.mtrand.RandomState.choice\u001b[1;34m()\u001b[0m\n",
      "\u001b[1;31mValueError\u001b[0m: Cannot take a larger sample than population when 'replace=False'"
     ]
    }
   ],
   "source": [
    "positive_random_idx = title_df[title_df['sent_label']==1].sample(6200, random_state=12).index.tolist()\n",
    "negative_random_idx = title_df[title_df['sent_label']==0].sample(6200, random_state=12).index.tolist()\n",
    "\n",
    "random_idx = positive_random_idx + negative_random_idx\n",
    "\n",
    "x = tf_idf_vect[random_idx]\n",
    "y = title_df['sent_label'][random_idx]\n",
    "x_train, x_test, y_train, y_test = train_test_split(x, y, test_size=0.2, random_state=1)\n",
    "\n",
    "lr = LogisticRegression(random_state = 0)\n",
    "lr.fit(x_train, y_train)\n",
    "y_pred = lr.predict(x_test)\n",
    "\n",
    "print('accuracy: %.2f' % accuracy_score(y_test, y_pred))"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 61,
   "id": "76c59ecd",
   "metadata": {},
   "outputs": [],
   "source": [
    "coef_pos_index = sorted(((value, index) for index, value in enumerate(lr.coef_[0])), reverse = True)\n",
    "coef_neg_index = sorted(((value, index) for index, value in enumerate(lr.coef_[0])), reverse = False)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 65,
   "id": "d7e7335b",
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/plain": [
       "{22: '동화약품',\n",
       " 58: '여드름',\n",
       " 92: '치료',\n",
       " 47: '세비',\n",
       " 96: '타비',\n",
       " 91: '출시',\n",
       " 94: '코스피',\n",
       " 52: '승률',\n",
       " 43: '상위',\n",
       " 80: '종목',\n",
       " 88: '직전',\n",
       " 16: '기준',\n",
       " 105: '한국',\n",
       " 79: '제약',\n",
       " 31: '바이오',\n",
       " 108: '협회',\n",
       " 24: '디지털',\n",
       " 106: '헬스',\n",
       " 67: '위원회',\n",
       " 35: '본격',\n",
       " 0: '가동',\n",
       " 42: '상승세',\n",
       " 51: '스케',\n",
       " 46: '선도',\n",
       " 61: '역할',\n",
       " 15: '기술적분석',\n",
       " 85: '증시',\n",
       " 65: '요약',\n",
       " 14: '기술',\n",
       " 39: '분석',\n",
       " 100: '특징',\n",
       " 93: '코스닥',\n",
       " 53: '시드',\n",
       " 95: '크림',\n",
       " 3: '개월',\n",
       " 17: '누적',\n",
       " 102: '판매',\n",
       " 56: '억원',\n",
       " 20: '돌파',\n",
       " 19: '달성',\n",
       " 64: '외국',\n",
       " 26: '매수',\n",
       " 69: '유입',\n",
       " 104: '하락',\n",
       " 50: '순식간',\n",
       " 23: '등장',\n",
       " 32: '백신',\n",
       " 99: '투자',\n",
       " 7: '결과물',\n",
       " 12: '국제',\n",
       " 103: '포럼',\n",
       " 63: '오후',\n",
       " 62: '오전',\n",
       " 40: '비타민',\n",
       " 110: '화제',\n",
       " 101: '파스',\n",
       " 82: '줄줄이',\n",
       " 4: '개장',\n",
       " 72: '이슈',\n",
       " 78: '점검',\n",
       " 28: '메디케어',\n",
       " 70: '의료',\n",
       " 33: '밴드',\n",
       " 44: '상피',\n",
       " 34: '복재',\n",
       " 9: '공동',\n",
       " 2: '개발',\n",
       " 57: '업무',\n",
       " 107: '협력',\n",
       " 74: '임재',\n",
       " 5: '거래소',\n",
       " 68: '유가',\n",
       " 83: '증권',\n",
       " 54: '시장',\n",
       " 36: '본부',\n",
       " 71: '이사장',\n",
       " 29: '모친상',\n",
       " 37: '부고',\n",
       " 97: '타이레놀',\n",
       " 27: '매출',\n",
       " 1: '강세',\n",
       " 87: '지속',\n",
       " 73: '일반의약품',\n",
       " 84: '증대',\n",
       " 21: '동화',\n",
       " 66: '원스',\n",
       " 59: '여름철',\n",
       " 48: '손발톱',\n",
       " 30: '무좀',\n",
       " 8: '고민',\n",
       " 98: '통운',\n",
       " 6: '건설',\n",
       " 38: '부문',\n",
       " 41: '사옥',\n",
       " 55: '신축',\n",
       " 10: '공사',\n",
       " 49: '수주',\n",
       " 109: '화동',\n",
       " 90: '철거',\n",
       " 13: '규모',\n",
       " 76: '재건축',\n",
       " 60: '역사',\n",
       " 86: '지상',\n",
       " 89: '착공',\n",
       " 45: '서울',\n",
       " 75: '장마',\n",
       " 81: '주요',\n",
       " 11: '공시',\n",
       " 77: '재송',\n",
       " 25: '마감',\n",
       " 18: '뉴스'}"
      ]
     },
     "execution_count": 65,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "invert_index_vectorizer = {v: k for k, v in vect.vocabulary_.items()}\n",
    "invert_index_vectorizer #111개"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 66,
   "id": "985c429f",
   "metadata": {},
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "서울 0.21791910480157786\n",
      "화동 0.17240458105403667\n",
      "역할 0.12204477404710934\n",
      "스케 0.12204477404710934\n",
      "선도 0.12204477404710934\n",
      "부고 0.11000166542850937\n",
      "디지털 0.07002110977077468\n",
      "점검 0.04979250796009671\n",
      "이슈 0.04979250796009671\n",
      "개장 0.04979250796009671\n",
      "유입 0.032053181376497174\n",
      "외국 0.032053181376497174\n",
      "매수 0.032053181376497174\n",
      "오전 0.03198780038628977\n",
      "원스 0.03106964685494967\n",
      "여름철 0.03106964685494967\n",
      "손발톱 0.03106964685494967\n",
      "무좀 0.03106964685494967\n",
      "동화 0.03106964685494967\n",
      "고민 0.03106964685494967\n"
     ]
    }
   ],
   "source": [
    "for coef in coef_pos_index[:20]: # 긍정 TOP 20\n",
    "    print(invert_index_vectorizer[coef[1]], coef[0]) "
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 67,
   "id": "0c233655",
   "metadata": {},
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "달성 -0.07843348799635717\n",
      "개월 -0.04215232990811164\n",
      "시드 -0.04215232990811164\n",
      "크림 -0.04215232990811164\n",
      "판매 -0.04215232990811164\n",
      "한국 -0.03828685734011139\n",
      "출시 -0.03600484957796534\n",
      "가동 -0.034809744035960176\n",
      "바이오 -0.034809744035960176\n",
      "본격 -0.034809744035960176\n",
      "위원회 -0.034809744035960176\n",
      "제약 -0.034809744035960176\n",
      "헬스 -0.034809744035960176\n",
      "협회 -0.034809744035960176\n",
      "공시 -0.027070843686560958\n",
      "코스닥 -0.0269934597861933\n",
      "동화약품 -0.02466338394349689\n",
      "뉴스 -0.023531520199523554\n",
      "마감 -0.023531520199523554\n",
      "재송 -0.023531520199523554\n"
     ]
    }
   ],
   "source": [
    "for coef in coef_neg_index[:20]: # 부정 TOP 20\n",
    "    print(invert_index_vectorizer[coef[1]], coef[0])"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "42f8802e",
   "metadata": {},
   "source": [
    "#### 여기까지"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 93,
   "id": "5475539a",
   "metadata": {},
   "outputs": [],
   "source": [
    "def using():\n",
    "    # 객체를 복원, 저장된 모델 불러오기\n",
    "    with open('pipe.dat','rb') as fp:     # 읽기\n",
    "        pipe = pickle.load(fp)\n",
    "        \n",
    "    while True :\n",
    "        text = input('뉴스 타이틀을 입력해주세요 : ')     # 인풋\n",
    "        \n",
    "        str = [text]\n",
    "        \n",
    "        # 예측 정확도\n",
    "        r1 = np.max(pipe.predict_proba(str)*100)     # 확률값을 구해서 *100..?\n",
    "        \n",
    "        # 예측 결과\n",
    "        r2 = pipe.predict(str)[0]     # 긍정('1'), 부정('0')\n",
    "        \n",
    "        if r2 == '1':\n",
    "            print('코스피지수는 상승할 것으로 예상됩니다.')\n",
    "        else: \n",
    "            print('코스피지수는 하락할 것으로 예상됩니다.')\n",
    "            \n",
    "        print('정확도 : %.3f' % r1)\n",
    "        print('------------------------------------------------')\n",
    "        \n",
    "        if text=='그만':\n",
    "            break"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 94,
   "id": "36ad3dc1",
   "metadata": {},
   "outputs": [],
   "source": [
    "# 학습 함수\n",
    "\n",
    "def model_learning():   # 감성분석 모델 생성\n",
    "    title_train, title_test, price_train, price_test = data_preprocessing()\n",
    "    learning(title_train, price_train, title_test, price_test)\n",
    "    \n",
    "# 사용 함수\n",
    "\n",
    "def model_using():   # 감성분석 모델 사용\n",
    "    using()"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 95,
   "id": "428b823a",
   "metadata": {},
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "1.0\n",
      "저장완료\n"
     ]
    }
   ],
   "source": [
    "model_learning() "
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 96,
   "id": "4fd9f22d",
   "metadata": {},
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "뉴스 타이틀을 입력해주세요 : 코로나\n",
      "코스피지수는 하락할 것으로 예상됩니다.\n",
      "정확도 : 99.863\n",
      "------------------------------------------------\n",
      "뉴스 타이틀을 입력해주세요 : 동화약품\n",
      "코스피지수는 하락할 것으로 예상됩니다.\n",
      "정확도 : 99.975\n",
      "------------------------------------------------\n",
      "뉴스 타이틀을 입력해주세요 : 왜\n",
      "코스피지수는 하락할 것으로 예상됩니다.\n",
      "정확도 : 99.863\n",
      "------------------------------------------------\n",
      "뉴스 타이틀을 입력해주세요 : 상승\n",
      "코스피지수는 하락할 것으로 예상됩니다.\n",
      "정확도 : 99.863\n",
      "------------------------------------------------\n",
      "뉴스 타이틀을 입력해주세요 : 안 해주니\n",
      "코스피지수는 하락할 것으로 예상됩니다.\n",
      "정확도 : 99.863\n",
      "------------------------------------------------\n",
      "뉴스 타이틀을 입력해주세요 : 매수\n",
      "코스피지수는 하락할 것으로 예상됩니다.\n",
      "정확도 : 99.901\n",
      "------------------------------------------------\n",
      "뉴스 타이틀을 입력해주세요 : 안녕\n",
      "코스피지수는 하락할 것으로 예상됩니다.\n",
      "정확도 : 99.863\n",
      "------------------------------------------------\n",
      "뉴스 타이틀을 입력해주세요 : 그래\n",
      "코스피지수는 하락할 것으로 예상됩니다.\n",
      "정확도 : 99.863\n",
      "------------------------------------------------\n",
      "뉴스 타이틀을 입력해주세요 : 내가 \n",
      "코스피지수는 하락할 것으로 예상됩니다.\n",
      "정확도 : 99.863\n",
      "------------------------------------------------\n",
      "뉴스 타이틀을 입력해주세요 : 포기ㅏㅎㄹ게\n",
      "코스피지수는 하락할 것으로 예상됩니다.\n",
      "정확도 : 99.863\n",
      "------------------------------------------------\n",
      "뉴스 타이틀을 입력해주세요 : 그만\n",
      "코스피지수는 하락할 것으로 예상됩니다.\n",
      "정확도 : 99.863\n",
      "------------------------------------------------\n"
     ]
    }
   ],
   "source": [
    "model_using()"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "id": "c998df71",
   "metadata": {},
   "outputs": [],
   "source": []
  }
 ],
 "metadata": {
  "kernelspec": {
   "display_name": "Python 3",
   "language": "python",
   "name": "python3"
  },
  "language_info": {
   "codemirror_mode": {
    "name": "ipython",
    "version": 3
   },
   "file_extension": ".py",
   "mimetype": "text/x-python",
   "name": "python",
   "nbconvert_exporter": "python",
   "pygments_lexer": "ipython3",
   "version": "3.8.8"
  },
  "toc": {
   "base_numbering": 1,
   "nav_menu": {},
   "number_sections": true,
   "sideBar": true,
   "skip_h1_title": false,
   "title_cell": "Table of Contents",
   "title_sidebar": "Contents",
   "toc_cell": false,
   "toc_position": {},
   "toc_section_display": true,
   "toc_window_display": false
  },
  "varInspector": {
   "cols": {
    "lenName": 16,
    "lenType": 16,
    "lenVar": 40
   },
   "kernels_config": {
    "python": {
     "delete_cmd_postfix": "",
     "delete_cmd_prefix": "del ",
     "library": "var_list.py",
     "varRefreshCmd": "print(var_dic_list())"
    },
    "r": {
     "delete_cmd_postfix": ") ",
     "delete_cmd_prefix": "rm(",
     "library": "var_list.r",
     "varRefreshCmd": "cat(var_dic_list()) "
    }
   },
   "types_to_exclude": [
    "module",
    "function",
    "builtin_function_or_method",
    "instance",
    "_Feature"
   ],
   "window_display": false
  }
 },
 "nbformat": 4,
 "nbformat_minor": 5
}
