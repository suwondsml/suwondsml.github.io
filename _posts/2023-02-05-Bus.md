---
layout: post
title: Bus
authors: [Minji Kim]
categories: [1기 AI/SW developers(개인 프로젝트)]
---

# 퇴근시간 버스승차인원 예측

# 라이브러리 호출


```python
import pandas as pd
import numpy as np
import missingno as msno
import datetime

import matplotlib.pyplot as plt
import matplotlib
import matplotlib.font_manager as fm
from pandas.plotting import scatter_matrix
import seaborn as sns

from sklearn.preprocessing import LabelEncoder
from sklearn.preprocessing import OneHotEncoder
from sklearn.linear_model import LinearRegression
from sklearn.ensemble import RandomForestRegressor
from sklearn.model_selection import KFold 
from sklearn.model_selection import GridSearchCV 

import random
import lightgbm as lgbm 

#경고 미출력
import warnings
warnings.filterwarnings('ignore')

# 지도 관련 시각화
import folium 
from folium.plugins import MarkerCluster 
import geopy.distance 

#processing bar
from tqdm import tqdm_notebook
```


```python
from google.colab import drive
drive.mount('/content/drive')
```

    Drive already mounted at /content/drive; to attempt to forcibly remount, call drive.mount("/content/drive", force_remount=True).
    

# 데이터 불러오기


```python
train = pd.read_csv('/content/drive/MyDrive/train.csv' ,index_col=0)
test = pd.read_csv('/content/drive/MyDrive/test.csv', index_col=0)
submission = pd.read_csv('/content/drive/MyDrive/submission_sample.csv', index_col=0)
```

# 데이터 관찰하기


```python
train.head(3)
```





  <div id="df-57fe88d8-e3e7-44eb-bb02-a2e3bb6a8d0c">
    <div class="colab-df-container">
      <div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>date</th>
      <th>bus_route_id</th>
      <th>in_out</th>
      <th>station_code</th>
      <th>station_name</th>
      <th>latitude</th>
      <th>longitude</th>
      <th>6~7_ride</th>
      <th>7~8_ride</th>
      <th>8~9_ride</th>
      <th>9~10_ride</th>
      <th>10~11_ride</th>
      <th>11~12_ride</th>
      <th>6~7_takeoff</th>
      <th>7~8_takeoff</th>
      <th>8~9_takeoff</th>
      <th>9~10_takeoff</th>
      <th>10~11_takeoff</th>
      <th>11~12_takeoff</th>
      <th>18~20_ride</th>
    </tr>
    <tr>
      <th>id</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>2019-09-01</td>
      <td>4270000</td>
      <td>시외</td>
      <td>344</td>
      <td>제주썬호텔</td>
      <td>33.48990</td>
      <td>126.49373</td>
      <td>0.0</td>
      <td>1.0</td>
      <td>2.0</td>
      <td>5.0</td>
      <td>2.0</td>
      <td>6.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>2019-09-01</td>
      <td>4270000</td>
      <td>시외</td>
      <td>357</td>
      <td>한라병원</td>
      <td>33.48944</td>
      <td>126.48508</td>
      <td>1.0</td>
      <td>4.0</td>
      <td>4.0</td>
      <td>2.0</td>
      <td>5.0</td>
      <td>6.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>5.0</td>
    </tr>
    <tr>
      <th>2</th>
      <td>2019-09-01</td>
      <td>4270000</td>
      <td>시외</td>
      <td>432</td>
      <td>정존마을</td>
      <td>33.48181</td>
      <td>126.47352</td>
      <td>1.0</td>
      <td>1.0</td>
      <td>0.0</td>
      <td>2.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>2.0</td>
    </tr>
  </tbody>
</table>
</div>
      <button class="colab-df-convert" onclick="convertToInteractive('df-57fe88d8-e3e7-44eb-bb02-a2e3bb6a8d0c')"
              title="Convert this dataframe to an interactive table."
              style="display:none;">

  <svg xmlns="http://www.w3.org/2000/svg" height="24px"viewBox="0 0 24 24"
       width="24px">
    <path d="M0 0h24v24H0V0z" fill="none"/>
    <path d="M18.56 5.44l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94zm-11 1L8.5 8.5l.94-2.06 2.06-.94-2.06-.94L8.5 2.5l-.94 2.06-2.06.94zm10 10l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94z"/><path d="M17.41 7.96l-1.37-1.37c-.4-.4-.92-.59-1.43-.59-.52 0-1.04.2-1.43.59L10.3 9.45l-7.72 7.72c-.78.78-.78 2.05 0 2.83L4 21.41c.39.39.9.59 1.41.59.51 0 1.02-.2 1.41-.59l7.78-7.78 2.81-2.81c.8-.78.8-2.07 0-2.86zM5.41 20L4 18.59l7.72-7.72 1.47 1.35L5.41 20z"/>
  </svg>
      </button>

  <style>
    .colab-df-container {
      display:flex;
      flex-wrap:wrap;
      gap: 12px;
    }

    .colab-df-convert {
      background-color: #E8F0FE;
      border: none;
      border-radius: 50%;
      cursor: pointer;
      display: none;
      fill: #1967D2;
      height: 32px;
      padding: 0 0 0 0;
      width: 32px;
    }

    .colab-df-convert:hover {
      background-color: #E2EBFA;
      box-shadow: 0px 1px 2px rgba(60, 64, 67, 0.3), 0px 1px 3px 1px rgba(60, 64, 67, 0.15);
      fill: #174EA6;
    }

    [theme=dark] .colab-df-convert {
      background-color: #3B4455;
      fill: #D2E3FC;
    }

    [theme=dark] .colab-df-convert:hover {
      background-color: #434B5C;
      box-shadow: 0px 1px 3px 1px rgba(0, 0, 0, 0.15);
      filter: drop-shadow(0px 1px 2px rgba(0, 0, 0, 0.3));
      fill: #FFFFFF;
    }
  </style>

      <script>
        const buttonEl =
          document.querySelector('#df-57fe88d8-e3e7-44eb-bb02-a2e3bb6a8d0c button.colab-df-convert');
        buttonEl.style.display =
          google.colab.kernel.accessAllowed ? 'block' : 'none';

        async function convertToInteractive(key) {
          const element = document.querySelector('#df-57fe88d8-e3e7-44eb-bb02-a2e3bb6a8d0c');
          const dataTable =
            await google.colab.kernel.invokeFunction('convertToInteractive',
                                                     [key], {});
          if (!dataTable) return;

          const docLinkHtml = 'Like what you see? Visit the ' +
            '<a target="_blank" href=https://colab.research.google.com/notebooks/data_table.ipynb>data table notebook</a>'
            + ' to learn more about interactive tables.';
          element.innerHTML = '';
          dataTable['output_type'] = 'display_data';
          await google.colab.output.renderOutput(dataTable, element);
          const docLink = document.createElement('div');
          docLink.innerHTML = docLinkHtml;
          element.appendChild(docLink);
        }
      </script>
    </div>
  </div>





```python
test.head(3)
```





  <div id="df-667e8fd1-2d5a-4930-91cb-689b0abed499">
    <div class="colab-df-container">
      <div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>date</th>
      <th>bus_route_id</th>
      <th>in_out</th>
      <th>station_code</th>
      <th>station_name</th>
      <th>latitude</th>
      <th>longitude</th>
      <th>6~7_ride</th>
      <th>7~8_ride</th>
      <th>8~9_ride</th>
      <th>9~10_ride</th>
      <th>10~11_ride</th>
      <th>11~12_ride</th>
      <th>6~7_takeoff</th>
      <th>7~8_takeoff</th>
      <th>8~9_takeoff</th>
      <th>9~10_takeoff</th>
      <th>10~11_takeoff</th>
      <th>11~12_takeoff</th>
    </tr>
    <tr>
      <th>id</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>415423</th>
      <td>2019-10-01</td>
      <td>4270000</td>
      <td>시외</td>
      <td>344</td>
      <td>제주썬호텔</td>
      <td>33.48990</td>
      <td>126.49373</td>
      <td>4.0</td>
      <td>4.0</td>
      <td>7.0</td>
      <td>2.0</td>
      <td>9.0</td>
      <td>1.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>1.0</td>
    </tr>
    <tr>
      <th>415424</th>
      <td>2019-10-01</td>
      <td>4270000</td>
      <td>시외</td>
      <td>357</td>
      <td>한라병원</td>
      <td>33.48944</td>
      <td>126.48508</td>
      <td>1.0</td>
      <td>6.0</td>
      <td>6.0</td>
      <td>1.0</td>
      <td>8.0</td>
      <td>11.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>415425</th>
      <td>2019-10-01</td>
      <td>4270000</td>
      <td>시외</td>
      <td>432</td>
      <td>정존마을</td>
      <td>33.48181</td>
      <td>126.47352</td>
      <td>2.0</td>
      <td>4.0</td>
      <td>2.0</td>
      <td>2.0</td>
      <td>2.0</td>
      <td>1.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
    </tr>
  </tbody>
</table>
</div>
      <button class="colab-df-convert" onclick="convertToInteractive('df-667e8fd1-2d5a-4930-91cb-689b0abed499')"
              title="Convert this dataframe to an interactive table."
              style="display:none;">

  <svg xmlns="http://www.w3.org/2000/svg" height="24px"viewBox="0 0 24 24"
       width="24px">
    <path d="M0 0h24v24H0V0z" fill="none"/>
    <path d="M18.56 5.44l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94zm-11 1L8.5 8.5l.94-2.06 2.06-.94-2.06-.94L8.5 2.5l-.94 2.06-2.06.94zm10 10l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94z"/><path d="M17.41 7.96l-1.37-1.37c-.4-.4-.92-.59-1.43-.59-.52 0-1.04.2-1.43.59L10.3 9.45l-7.72 7.72c-.78.78-.78 2.05 0 2.83L4 21.41c.39.39.9.59 1.41.59.51 0 1.02-.2 1.41-.59l7.78-7.78 2.81-2.81c.8-.78.8-2.07 0-2.86zM5.41 20L4 18.59l7.72-7.72 1.47 1.35L5.41 20z"/>
  </svg>
      </button>

  <style>
    .colab-df-container {
      display:flex;
      flex-wrap:wrap;
      gap: 12px;
    }

    .colab-df-convert {
      background-color: #E8F0FE;
      border: none;
      border-radius: 50%;
      cursor: pointer;
      display: none;
      fill: #1967D2;
      height: 32px;
      padding: 0 0 0 0;
      width: 32px;
    }

    .colab-df-convert:hover {
      background-color: #E2EBFA;
      box-shadow: 0px 1px 2px rgba(60, 64, 67, 0.3), 0px 1px 3px 1px rgba(60, 64, 67, 0.15);
      fill: #174EA6;
    }

    [theme=dark] .colab-df-convert {
      background-color: #3B4455;
      fill: #D2E3FC;
    }

    [theme=dark] .colab-df-convert:hover {
      background-color: #434B5C;
      box-shadow: 0px 1px 3px 1px rgba(0, 0, 0, 0.15);
      filter: drop-shadow(0px 1px 2px rgba(0, 0, 0, 0.3));
      fill: #FFFFFF;
    }
  </style>

      <script>
        const buttonEl =
          document.querySelector('#df-667e8fd1-2d5a-4930-91cb-689b0abed499 button.colab-df-convert');
        buttonEl.style.display =
          google.colab.kernel.accessAllowed ? 'block' : 'none';

        async function convertToInteractive(key) {
          const element = document.querySelector('#df-667e8fd1-2d5a-4930-91cb-689b0abed499');
          const dataTable =
            await google.colab.kernel.invokeFunction('convertToInteractive',
                                                     [key], {});
          if (!dataTable) return;

          const docLinkHtml = 'Like what you see? Visit the ' +
            '<a target="_blank" href=https://colab.research.google.com/notebooks/data_table.ipynb>data table notebook</a>'
            + ' to learn more about interactive tables.';
          element.innerHTML = '';
          dataTable['output_type'] = 'display_data';
          await google.colab.output.renderOutput(dataTable, element);
          const docLink = document.createElement('div');
          docLink.innerHTML = docLinkHtml;
          element.appendChild(docLink);
        }
      </script>
    </div>
  </div>





```python
train.info()
```

    <class 'pandas.core.frame.DataFrame'>
    Int64Index: 415423 entries, 0 to 415422
    Data columns (total 20 columns):
     #   Column         Non-Null Count   Dtype  
    ---  ------         --------------   -----  
     0   date           415423 non-null  object 
     1   bus_route_id   415423 non-null  int64  
     2   in_out         415423 non-null  object 
     3   station_code   415423 non-null  int64  
     4   station_name   415423 non-null  object 
     5   latitude       415423 non-null  float64
     6   longitude      415423 non-null  float64
     7   6~7_ride       415423 non-null  float64
     8   7~8_ride       415423 non-null  float64
     9   8~9_ride       415423 non-null  float64
     10  9~10_ride      415423 non-null  float64
     11  10~11_ride     415423 non-null  float64
     12  11~12_ride     415423 non-null  float64
     13  6~7_takeoff    415423 non-null  float64
     14  7~8_takeoff    415423 non-null  float64
     15  8~9_takeoff    415423 non-null  float64
     16  9~10_takeoff   415423 non-null  float64
     17  10~11_takeoff  415423 non-null  float64
     18  11~12_takeoff  415423 non-null  float64
     19  18~20_ride     415423 non-null  float64
    dtypes: float64(15), int64(2), object(3)
    memory usage: 66.6+ MB
    


```python
test.info()
```

    <class 'pandas.core.frame.DataFrame'>
    Int64Index: 228170 entries, 415423 to 643592
    Data columns (total 19 columns):
     #   Column         Non-Null Count   Dtype  
    ---  ------         --------------   -----  
     0   date           228170 non-null  object 
     1   bus_route_id   228170 non-null  int64  
     2   in_out         228170 non-null  object 
     3   station_code   228170 non-null  int64  
     4   station_name   228170 non-null  object 
     5   latitude       228170 non-null  float64
     6   longitude      228170 non-null  float64
     7   6~7_ride       228170 non-null  float64
     8   7~8_ride       228170 non-null  float64
     9   8~9_ride       228170 non-null  float64
     10  9~10_ride      228170 non-null  float64
     11  10~11_ride     228170 non-null  float64
     12  11~12_ride     228170 non-null  float64
     13  6~7_takeoff    228170 non-null  float64
     14  7~8_takeoff    228170 non-null  float64
     15  8~9_takeoff    228170 non-null  float64
     16  9~10_takeoff   228170 non-null  float64
     17  10~11_takeoff  228170 non-null  float64
     18  11~12_takeoff  228170 non-null  float64
    dtypes: float64(14), int64(2), object(3)
    memory usage: 34.8+ MB
    

두 데이터의 <font color="FF99CC">'date',  'in_out',  'station_name' </font>컬럼이 object 타입이다.

****

**💛 데이터 상세 설명**
1. date : 버스 운행 날짜
2. bus_route_id: 버스 노선 ID
3. in_out: 시내버스, 시외버스 구분
4. station_code: 해당 승하차 정류소의 ID
5. station_name: 정류소 이름
6. latitude: 해당 버스 정류장의 위도( 같은 정류장 이름이어도 버스의 진행 방향에 따라 다를 수 있음)
7. longitude: 해당 버스 정류장의 경도( 같은 정류장 이름이어도 버스의 진행 방향에 따라 다를 수 있음)
8. 6~7_ride: 6시부터 6시 59분 59초까지 승차한 인원 수
9. 7~8_ride: 7시부터 7시 59분 59초까지 승차한 인원 수
10. 8~9_ride: 8시부터 8시 59분 59초까지 승차한 인원 수
11. 9~10_ride: 9시부터 9시 59분 59초까지 승차한 인원 수
12. 10~11_ride: 10시부터 10시 59분 59초까지 승차한 인원 수
13. 11~12_ride: 11시부터 11시 59분 59초까지 승차한 인원 수
14. 6~7_takeoff: 6시부터 6시 59분 59초까지 하차한 인원 수
15. 7~8_takeoff: 7시부터 7시 59분 59초까지 하차한 인원 수
16. 8~9_takeoff: 8시부터 8시 59분 59초까지 하차한 인원 수
17. 9~10_takeoff: 9시부터 9시 59분 59초까지 하차한 인원 수
18. 10~11_takeoff: 10시부터 10시 59분 59초까지 하차한 인원 수
19. 11~12_takeoff: 11시부터 11시 59분 59초까지 하차한 인원 수

20. 18~20_ride: 18시부터 19시 59분 59초까지 승차한 인원 수 <font color="3399FF"><- target</font>

# 데이터 전처리

## in_out 컬럼


```python
train['in_out'].value_counts()
```




    시내    408500
    시외      6923
    Name: in_out, dtype: int64




```python
train = train.replace('시내', 1)
train = train.replace('시외', 0)
train.info()
```

    <class 'pandas.core.frame.DataFrame'>
    Int64Index: 415423 entries, 0 to 415422
    Data columns (total 20 columns):
     #   Column         Non-Null Count   Dtype  
    ---  ------         --------------   -----  
     0   date           415423 non-null  object 
     1   bus_route_id   415423 non-null  int64  
     2   in_out         415423 non-null  int64  
     3   station_code   415423 non-null  int64  
     4   station_name   415423 non-null  object 
     5   latitude       415423 non-null  float64
     6   longitude      415423 non-null  float64
     7   6~7_ride       415423 non-null  float64
     8   7~8_ride       415423 non-null  float64
     9   8~9_ride       415423 non-null  float64
     10  9~10_ride      415423 non-null  float64
     11  10~11_ride     415423 non-null  float64
     12  11~12_ride     415423 non-null  float64
     13  6~7_takeoff    415423 non-null  float64
     14  7~8_takeoff    415423 non-null  float64
     15  8~9_takeoff    415423 non-null  float64
     16  9~10_takeoff   415423 non-null  float64
     17  10~11_takeoff  415423 non-null  float64
     18  11~12_takeoff  415423 non-null  float64
     19  18~20_ride     415423 non-null  float64
    dtypes: float64(15), int64(3), object(2)
    memory usage: 66.6+ MB
    


```python
test = test.replace('시내', 1)
test = test.replace('시외', 0)
test.info()
```

    <class 'pandas.core.frame.DataFrame'>
    Int64Index: 228170 entries, 415423 to 643592
    Data columns (total 19 columns):
     #   Column         Non-Null Count   Dtype  
    ---  ------         --------------   -----  
     0   date           228170 non-null  object 
     1   bus_route_id   228170 non-null  int64  
     2   in_out         228170 non-null  int64  
     3   station_code   228170 non-null  int64  
     4   station_name   228170 non-null  object 
     5   latitude       228170 non-null  float64
     6   longitude      228170 non-null  float64
     7   6~7_ride       228170 non-null  float64
     8   7~8_ride       228170 non-null  float64
     9   8~9_ride       228170 non-null  float64
     10  9~10_ride      228170 non-null  float64
     11  10~11_ride     228170 non-null  float64
     12  11~12_ride     228170 non-null  float64
     13  6~7_takeoff    228170 non-null  float64
     14  7~8_takeoff    228170 non-null  float64
     15  8~9_takeoff    228170 non-null  float64
     16  9~10_takeoff   228170 non-null  float64
     17  10~11_takeoff  228170 non-null  float64
     18  11~12_takeoff  228170 non-null  float64
    dtypes: float64(14), int64(3), object(2)
    memory usage: 34.8+ MB
    

# 탐색적 데이터 분석

## 결측치 확인


```python
train.isnull().sum()
```




    date             0
    bus_route_id     0
    in_out           0
    station_code     0
    station_name     0
    latitude         0
    longitude        0
    6~7_ride         0
    7~8_ride         0
    8~9_ride         0
    9~10_ride        0
    10~11_ride       0
    11~12_ride       0
    6~7_takeoff      0
    7~8_takeoff      0
    8~9_takeoff      0
    9~10_takeoff     0
    10~11_takeoff    0
    11~12_takeoff    0
    18~20_ride       0
    dtype: int64




```python
test.isnull().sum()
```




    date             0
    bus_route_id     0
    in_out           0
    station_code     0
    station_name     0
    latitude         0
    longitude        0
    6~7_ride         0
    7~8_ride         0
    8~9_ride         0
    9~10_ride        0
    10~11_ride       0
    11~12_ride       0
    6~7_takeoff      0
    7~8_takeoff      0
    8~9_takeoff      0
    9~10_takeoff     0
    10~11_takeoff    0
    11~12_takeoff    0
    dtype: int64



**시각화로 확인하기**


```python
msno.matrix(train)
```




    <matplotlib.axes._subplots.AxesSubplot at 0x7f90857b2190>




    
![png](/data/2023-02-05-Bus/output_22_1.png)
    



```python
msno.matrix(test)
```




    <matplotlib.axes._subplots.AxesSubplot at 0x7f9082a37c40>




    
![png](/data/2023-02-05-Bus/output_23_1.png)
    


train 과 test 데이터 모두 결측치가 없다 !

## 상관관계분석

> heatmap
<br/> 변수간 상관관계 표를 그래프로 보여준다.


```python
train_cor = round(train.corr(), 3)
train_cor
```





  <div id="df-2ee88165-b665-4e24-9a0e-b82d9c1c6cad">
    <div class="colab-df-container">
      <div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>bus_route_id</th>
      <th>in_out</th>
      <th>station_code</th>
      <th>latitude</th>
      <th>longitude</th>
      <th>6~7_ride</th>
      <th>7~8_ride</th>
      <th>8~9_ride</th>
      <th>9~10_ride</th>
      <th>10~11_ride</th>
      <th>11~12_ride</th>
      <th>6~7_takeoff</th>
      <th>7~8_takeoff</th>
      <th>8~9_takeoff</th>
      <th>9~10_takeoff</th>
      <th>10~11_takeoff</th>
      <th>11~12_takeoff</th>
      <th>18~20_ride</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>bus_route_id</th>
      <td>1.000</td>
      <td>0.102</td>
      <td>-0.016</td>
      <td>-0.197</td>
      <td>0.010</td>
      <td>-0.070</td>
      <td>-0.119</td>
      <td>-0.128</td>
      <td>-0.138</td>
      <td>-0.129</td>
      <td>-0.129</td>
      <td>-0.020</td>
      <td>-0.082</td>
      <td>-0.102</td>
      <td>-0.114</td>
      <td>-0.116</td>
      <td>-0.112</td>
      <td>-0.144</td>
    </tr>
    <tr>
      <th>in_out</th>
      <td>0.102</td>
      <td>1.000</td>
      <td>-0.094</td>
      <td>-0.009</td>
      <td>0.066</td>
      <td>-0.027</td>
      <td>-0.010</td>
      <td>-0.023</td>
      <td>-0.025</td>
      <td>-0.026</td>
      <td>-0.025</td>
      <td>-0.027</td>
      <td>-0.019</td>
      <td>-0.019</td>
      <td>-0.018</td>
      <td>-0.010</td>
      <td>-0.006</td>
      <td>-0.022</td>
    </tr>
    <tr>
      <th>station_code</th>
      <td>-0.016</td>
      <td>-0.094</td>
      <td>1.000</td>
      <td>-0.049</td>
      <td>-0.011</td>
      <td>0.036</td>
      <td>0.055</td>
      <td>0.057</td>
      <td>0.055</td>
      <td>0.051</td>
      <td>0.050</td>
      <td>-0.003</td>
      <td>0.021</td>
      <td>0.021</td>
      <td>0.023</td>
      <td>0.024</td>
      <td>0.025</td>
      <td>0.034</td>
    </tr>
    <tr>
      <th>latitude</th>
      <td>-0.197</td>
      <td>-0.009</td>
      <td>-0.049</td>
      <td>1.000</td>
      <td>0.134</td>
      <td>0.046</td>
      <td>0.067</td>
      <td>0.066</td>
      <td>0.066</td>
      <td>0.059</td>
      <td>0.060</td>
      <td>0.051</td>
      <td>0.048</td>
      <td>0.056</td>
      <td>0.067</td>
      <td>0.059</td>
      <td>0.058</td>
      <td>0.079</td>
    </tr>
    <tr>
      <th>longitude</th>
      <td>0.010</td>
      <td>0.066</td>
      <td>-0.011</td>
      <td>0.134</td>
      <td>1.000</td>
      <td>-0.010</td>
      <td>-0.016</td>
      <td>-0.019</td>
      <td>-0.009</td>
      <td>-0.008</td>
      <td>-0.009</td>
      <td>-0.011</td>
      <td>-0.021</td>
      <td>-0.030</td>
      <td>-0.014</td>
      <td>-0.008</td>
      <td>-0.005</td>
      <td>-0.021</td>
    </tr>
    <tr>
      <th>6~7_ride</th>
      <td>-0.070</td>
      <td>-0.027</td>
      <td>0.036</td>
      <td>0.046</td>
      <td>-0.010</td>
      <td>1.000</td>
      <td>0.376</td>
      <td>0.297</td>
      <td>0.314</td>
      <td>0.279</td>
      <td>0.265</td>
      <td>0.132</td>
      <td>0.032</td>
      <td>0.019</td>
      <td>0.029</td>
      <td>0.030</td>
      <td>0.030</td>
      <td>0.262</td>
    </tr>
    <tr>
      <th>7~8_ride</th>
      <td>-0.119</td>
      <td>-0.010</td>
      <td>0.055</td>
      <td>0.067</td>
      <td>-0.016</td>
      <td>0.376</td>
      <td>1.000</td>
      <td>0.480</td>
      <td>0.427</td>
      <td>0.395</td>
      <td>0.390</td>
      <td>0.069</td>
      <td>0.184</td>
      <td>0.130</td>
      <td>0.106</td>
      <td>0.117</td>
      <td>0.136</td>
      <td>0.372</td>
    </tr>
    <tr>
      <th>8~9_ride</th>
      <td>-0.128</td>
      <td>-0.023</td>
      <td>0.057</td>
      <td>0.066</td>
      <td>-0.019</td>
      <td>0.297</td>
      <td>0.480</td>
      <td>1.000</td>
      <td>0.506</td>
      <td>0.458</td>
      <td>0.453</td>
      <td>0.085</td>
      <td>0.122</td>
      <td>0.304</td>
      <td>0.192</td>
      <td>0.175</td>
      <td>0.206</td>
      <td>0.445</td>
    </tr>
    <tr>
      <th>9~10_ride</th>
      <td>-0.138</td>
      <td>-0.025</td>
      <td>0.055</td>
      <td>0.066</td>
      <td>-0.009</td>
      <td>0.314</td>
      <td>0.427</td>
      <td>0.506</td>
      <td>1.000</td>
      <td>0.537</td>
      <td>0.518</td>
      <td>0.126</td>
      <td>0.145</td>
      <td>0.195</td>
      <td>0.339</td>
      <td>0.246</td>
      <td>0.242</td>
      <td>0.494</td>
    </tr>
    <tr>
      <th>10~11_ride</th>
      <td>-0.129</td>
      <td>-0.026</td>
      <td>0.051</td>
      <td>0.059</td>
      <td>-0.008</td>
      <td>0.279</td>
      <td>0.395</td>
      <td>0.458</td>
      <td>0.537</td>
      <td>1.000</td>
      <td>0.542</td>
      <td>0.118</td>
      <td>0.144</td>
      <td>0.196</td>
      <td>0.242</td>
      <td>0.360</td>
      <td>0.268</td>
      <td>0.513</td>
    </tr>
    <tr>
      <th>11~12_ride</th>
      <td>-0.129</td>
      <td>-0.025</td>
      <td>0.050</td>
      <td>0.060</td>
      <td>-0.009</td>
      <td>0.265</td>
      <td>0.390</td>
      <td>0.453</td>
      <td>0.518</td>
      <td>0.542</td>
      <td>1.000</td>
      <td>0.122</td>
      <td>0.165</td>
      <td>0.233</td>
      <td>0.266</td>
      <td>0.259</td>
      <td>0.394</td>
      <td>0.570</td>
    </tr>
    <tr>
      <th>6~7_takeoff</th>
      <td>-0.020</td>
      <td>-0.027</td>
      <td>-0.003</td>
      <td>0.051</td>
      <td>-0.011</td>
      <td>0.132</td>
      <td>0.069</td>
      <td>0.085</td>
      <td>0.126</td>
      <td>0.118</td>
      <td>0.122</td>
      <td>1.000</td>
      <td>0.233</td>
      <td>0.190</td>
      <td>0.212</td>
      <td>0.185</td>
      <td>0.194</td>
      <td>0.178</td>
    </tr>
    <tr>
      <th>7~8_takeoff</th>
      <td>-0.082</td>
      <td>-0.019</td>
      <td>0.021</td>
      <td>0.048</td>
      <td>-0.021</td>
      <td>0.032</td>
      <td>0.184</td>
      <td>0.122</td>
      <td>0.145</td>
      <td>0.144</td>
      <td>0.165</td>
      <td>0.233</td>
      <td>1.000</td>
      <td>0.430</td>
      <td>0.338</td>
      <td>0.326</td>
      <td>0.335</td>
      <td>0.219</td>
    </tr>
    <tr>
      <th>8~9_takeoff</th>
      <td>-0.102</td>
      <td>-0.019</td>
      <td>0.021</td>
      <td>0.056</td>
      <td>-0.030</td>
      <td>0.019</td>
      <td>0.130</td>
      <td>0.304</td>
      <td>0.195</td>
      <td>0.196</td>
      <td>0.233</td>
      <td>0.190</td>
      <td>0.430</td>
      <td>1.000</td>
      <td>0.443</td>
      <td>0.429</td>
      <td>0.425</td>
      <td>0.274</td>
    </tr>
    <tr>
      <th>9~10_takeoff</th>
      <td>-0.114</td>
      <td>-0.018</td>
      <td>0.023</td>
      <td>0.067</td>
      <td>-0.014</td>
      <td>0.029</td>
      <td>0.106</td>
      <td>0.192</td>
      <td>0.339</td>
      <td>0.242</td>
      <td>0.266</td>
      <td>0.212</td>
      <td>0.338</td>
      <td>0.443</td>
      <td>1.000</td>
      <td>0.539</td>
      <td>0.531</td>
      <td>0.296</td>
    </tr>
    <tr>
      <th>10~11_takeoff</th>
      <td>-0.116</td>
      <td>-0.010</td>
      <td>0.024</td>
      <td>0.059</td>
      <td>-0.008</td>
      <td>0.030</td>
      <td>0.117</td>
      <td>0.175</td>
      <td>0.246</td>
      <td>0.360</td>
      <td>0.259</td>
      <td>0.185</td>
      <td>0.326</td>
      <td>0.429</td>
      <td>0.539</td>
      <td>1.000</td>
      <td>0.541</td>
      <td>0.291</td>
    </tr>
    <tr>
      <th>11~12_takeoff</th>
      <td>-0.112</td>
      <td>-0.006</td>
      <td>0.025</td>
      <td>0.058</td>
      <td>-0.005</td>
      <td>0.030</td>
      <td>0.136</td>
      <td>0.206</td>
      <td>0.242</td>
      <td>0.268</td>
      <td>0.394</td>
      <td>0.194</td>
      <td>0.335</td>
      <td>0.425</td>
      <td>0.531</td>
      <td>0.541</td>
      <td>1.000</td>
      <td>0.314</td>
    </tr>
    <tr>
      <th>18~20_ride</th>
      <td>-0.144</td>
      <td>-0.022</td>
      <td>0.034</td>
      <td>0.079</td>
      <td>-0.021</td>
      <td>0.262</td>
      <td>0.372</td>
      <td>0.445</td>
      <td>0.494</td>
      <td>0.513</td>
      <td>0.570</td>
      <td>0.178</td>
      <td>0.219</td>
      <td>0.274</td>
      <td>0.296</td>
      <td>0.291</td>
      <td>0.314</td>
      <td>1.000</td>
    </tr>
  </tbody>
</table>
</div>
      <button class="colab-df-convert" onclick="convertToInteractive('df-2ee88165-b665-4e24-9a0e-b82d9c1c6cad')"
              title="Convert this dataframe to an interactive table."
              style="display:none;">

  <svg xmlns="http://www.w3.org/2000/svg" height="24px"viewBox="0 0 24 24"
       width="24px">
    <path d="M0 0h24v24H0V0z" fill="none"/>
    <path d="M18.56 5.44l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94zm-11 1L8.5 8.5l.94-2.06 2.06-.94-2.06-.94L8.5 2.5l-.94 2.06-2.06.94zm10 10l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94z"/><path d="M17.41 7.96l-1.37-1.37c-.4-.4-.92-.59-1.43-.59-.52 0-1.04.2-1.43.59L10.3 9.45l-7.72 7.72c-.78.78-.78 2.05 0 2.83L4 21.41c.39.39.9.59 1.41.59.51 0 1.02-.2 1.41-.59l7.78-7.78 2.81-2.81c.8-.78.8-2.07 0-2.86zM5.41 20L4 18.59l7.72-7.72 1.47 1.35L5.41 20z"/>
  </svg>
      </button>

  <style>
    .colab-df-container {
      display:flex;
      flex-wrap:wrap;
      gap: 12px;
    }

    .colab-df-convert {
      background-color: #E8F0FE;
      border: none;
      border-radius: 50%;
      cursor: pointer;
      display: none;
      fill: #1967D2;
      height: 32px;
      padding: 0 0 0 0;
      width: 32px;
    }

    .colab-df-convert:hover {
      background-color: #E2EBFA;
      box-shadow: 0px 1px 2px rgba(60, 64, 67, 0.3), 0px 1px 3px 1px rgba(60, 64, 67, 0.15);
      fill: #174EA6;
    }

    [theme=dark] .colab-df-convert {
      background-color: #3B4455;
      fill: #D2E3FC;
    }

    [theme=dark] .colab-df-convert:hover {
      background-color: #434B5C;
      box-shadow: 0px 1px 3px 1px rgba(0, 0, 0, 0.15);
      filter: drop-shadow(0px 1px 2px rgba(0, 0, 0, 0.3));
      fill: #FFFFFF;
    }
  </style>

      <script>
        const buttonEl =
          document.querySelector('#df-2ee88165-b665-4e24-9a0e-b82d9c1c6cad button.colab-df-convert');
        buttonEl.style.display =
          google.colab.kernel.accessAllowed ? 'block' : 'none';

        async function convertToInteractive(key) {
          const element = document.querySelector('#df-2ee88165-b665-4e24-9a0e-b82d9c1c6cad');
          const dataTable =
            await google.colab.kernel.invokeFunction('convertToInteractive',
                                                     [key], {});
          if (!dataTable) return;

          const docLinkHtml = 'Like what you see? Visit the ' +
            '<a target="_blank" href=https://colab.research.google.com/notebooks/data_table.ipynb>data table notebook</a>'
            + ' to learn more about interactive tables.';
          element.innerHTML = '';
          dataTable['output_type'] = 'display_data';
          await google.colab.output.renderOutput(dataTable, element);
          const docLink = document.createElement('div');
          docLink.innerHTML = docLinkHtml;
          element.appendChild(docLink);
        }
      </script>
    </div>
  </div>





```python
# 그림 사이즈를 지정한다.
fig, ax = plt.subplots( figsize=(14,10) )
plt.title('train.corr()', size=20)
plt.xticks(rotation=45)

# heatmap은 대각선 중심으로 양쪽이 대칭으로 동일한 값을 가지므로 한쪽 삼각형만 보여준다.
mask = np.zeros_like(train_cor, dtype=np.bool)
mask[np.triu_indices_from(mask)] = True

# 히트맵을 그린다.
sns.heatmap(train_cor,
            annot=True, 
            mask = mask,
            cmap='RdYlBu_r',
            linewidth=.5,
            cbar_kws={"shrink": .5},
            vmin = -1, vmax = 1)
plt.show()
```


    
![png](/data/2023-02-05-Bus/output_28_0.png)
    


<font color="3399F">"18~20_ride" </font>컬럼과 상관관계를 보이는 컬럼들은 <font color="red">?!</font>
- 8~9_ride
- 9~10_ride
- 10~11_ride
- 11~12_ride

<br/>🚌 오전 8시부터 11시 59분 59초 사이에 승차한 인원과 상관관계를 보인다.

## 요일별 버스 승하차 인원 파악

현제 데이터 상태 확인


```python
train.head()
```





  <div id="df-0379cf63-4e74-4f0b-a3c8-225948c0de9a">
    <div class="colab-df-container">
      <div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>date</th>
      <th>bus_route_id</th>
      <th>in_out</th>
      <th>station_code</th>
      <th>station_name</th>
      <th>latitude</th>
      <th>longitude</th>
      <th>6~7_ride</th>
      <th>7~8_ride</th>
      <th>8~9_ride</th>
      <th>9~10_ride</th>
      <th>10~11_ride</th>
      <th>11~12_ride</th>
      <th>6~7_takeoff</th>
      <th>7~8_takeoff</th>
      <th>8~9_takeoff</th>
      <th>9~10_takeoff</th>
      <th>10~11_takeoff</th>
      <th>11~12_takeoff</th>
      <th>18~20_ride</th>
    </tr>
    <tr>
      <th>id</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>2019-09-01</td>
      <td>4270000</td>
      <td>0</td>
      <td>344</td>
      <td>제주썬호텔</td>
      <td>33.48990</td>
      <td>126.49373</td>
      <td>0.0</td>
      <td>1.0</td>
      <td>2.0</td>
      <td>5.0</td>
      <td>2.0</td>
      <td>6.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>2019-09-01</td>
      <td>4270000</td>
      <td>0</td>
      <td>357</td>
      <td>한라병원</td>
      <td>33.48944</td>
      <td>126.48508</td>
      <td>1.0</td>
      <td>4.0</td>
      <td>4.0</td>
      <td>2.0</td>
      <td>5.0</td>
      <td>6.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>5.0</td>
    </tr>
    <tr>
      <th>2</th>
      <td>2019-09-01</td>
      <td>4270000</td>
      <td>0</td>
      <td>432</td>
      <td>정존마을</td>
      <td>33.48181</td>
      <td>126.47352</td>
      <td>1.0</td>
      <td>1.0</td>
      <td>0.0</td>
      <td>2.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>2.0</td>
    </tr>
    <tr>
      <th>3</th>
      <td>2019-09-01</td>
      <td>4270000</td>
      <td>1</td>
      <td>1579</td>
      <td>제주국제공항(600번)</td>
      <td>33.50577</td>
      <td>126.49252</td>
      <td>0.0</td>
      <td>17.0</td>
      <td>6.0</td>
      <td>26.0</td>
      <td>14.0</td>
      <td>16.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>53.0</td>
    </tr>
    <tr>
      <th>4</th>
      <td>2019-09-01</td>
      <td>4270000</td>
      <td>1</td>
      <td>1646</td>
      <td>중문관광단지입구</td>
      <td>33.25579</td>
      <td>126.41260</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>1.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
    </tr>
  </tbody>
</table>
</div>
      <button class="colab-df-convert" onclick="convertToInteractive('df-0379cf63-4e74-4f0b-a3c8-225948c0de9a')"
              title="Convert this dataframe to an interactive table."
              style="display:none;">

  <svg xmlns="http://www.w3.org/2000/svg" height="24px"viewBox="0 0 24 24"
       width="24px">
    <path d="M0 0h24v24H0V0z" fill="none"/>
    <path d="M18.56 5.44l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94zm-11 1L8.5 8.5l.94-2.06 2.06-.94-2.06-.94L8.5 2.5l-.94 2.06-2.06.94zm10 10l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94z"/><path d="M17.41 7.96l-1.37-1.37c-.4-.4-.92-.59-1.43-.59-.52 0-1.04.2-1.43.59L10.3 9.45l-7.72 7.72c-.78.78-.78 2.05 0 2.83L4 21.41c.39.39.9.59 1.41.59.51 0 1.02-.2 1.41-.59l7.78-7.78 2.81-2.81c.8-.78.8-2.07 0-2.86zM5.41 20L4 18.59l7.72-7.72 1.47 1.35L5.41 20z"/>
  </svg>
      </button>

  <style>
    .colab-df-container {
      display:flex;
      flex-wrap:wrap;
      gap: 12px;
    }

    .colab-df-convert {
      background-color: #E8F0FE;
      border: none;
      border-radius: 50%;
      cursor: pointer;
      display: none;
      fill: #1967D2;
      height: 32px;
      padding: 0 0 0 0;
      width: 32px;
    }

    .colab-df-convert:hover {
      background-color: #E2EBFA;
      box-shadow: 0px 1px 2px rgba(60, 64, 67, 0.3), 0px 1px 3px 1px rgba(60, 64, 67, 0.15);
      fill: #174EA6;
    }

    [theme=dark] .colab-df-convert {
      background-color: #3B4455;
      fill: #D2E3FC;
    }

    [theme=dark] .colab-df-convert:hover {
      background-color: #434B5C;
      box-shadow: 0px 1px 3px 1px rgba(0, 0, 0, 0.15);
      filter: drop-shadow(0px 1px 2px rgba(0, 0, 0, 0.3));
      fill: #FFFFFF;
    }
  </style>

      <script>
        const buttonEl =
          document.querySelector('#df-0379cf63-4e74-4f0b-a3c8-225948c0de9a button.colab-df-convert');
        buttonEl.style.display =
          google.colab.kernel.accessAllowed ? 'block' : 'none';

        async function convertToInteractive(key) {
          const element = document.querySelector('#df-0379cf63-4e74-4f0b-a3c8-225948c0de9a');
          const dataTable =
            await google.colab.kernel.invokeFunction('convertToInteractive',
                                                     [key], {});
          if (!dataTable) return;

          const docLinkHtml = 'Like what you see? Visit the ' +
            '<a target="_blank" href=https://colab.research.google.com/notebooks/data_table.ipynb>data table notebook</a>'
            + ' to learn more about interactive tables.';
          element.innerHTML = '';
          dataTable['output_type'] = 'display_data';
          await google.colab.output.renderOutput(dataTable, element);
          const docLink = document.createElement('div');
          docLink.innerHTML = docLinkHtml;
          element.appendChild(docLink);
        }
      </script>
    </div>
  </div>




시간대별 버스 승하차 인원 컬럼 생성


```python
ride_col_list = ['6~7_ride', '7~8_ride', '8~9_ride', '9~10_ride',
                 '10~11_ride', '11~12_ride', '18~20_ride']
takeoff_col_list = ['6~7_takeoff', '7~8_takeoff', '8~9_takeoff', 
                    '9~10_takeoff', '10~11_takeoff', '11~12_takeoff', '18~20_ride']
```

날짜별 시간대별 승하차 인원 합


```python
df_date_ride = train.groupby(['date']).sum()[ride_col_list].stack().reset_index()
df_date_ride.columns = ['date', 'ride_time', 'count']
df_date_ride['date_disp'] = df_date_ride['date'].apply(lambda x: x[5:]) # 년도 제외하고 추출
```


```python
df_date_ride
```





  <div id="df-7f2949d6-2309-4625-9609-30e39e937f51">
    <div class="colab-df-container">
      <div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>date</th>
      <th>ride_time</th>
      <th>count</th>
      <th>date_disp</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>2019-09-01</td>
      <td>6~7_ride</td>
      <td>2942.0</td>
      <td>09-01</td>
    </tr>
    <tr>
      <th>1</th>
      <td>2019-09-01</td>
      <td>7~8_ride</td>
      <td>4518.0</td>
      <td>09-01</td>
    </tr>
    <tr>
      <th>2</th>
      <td>2019-09-01</td>
      <td>8~9_ride</td>
      <td>5682.0</td>
      <td>09-01</td>
    </tr>
    <tr>
      <th>3</th>
      <td>2019-09-01</td>
      <td>9~10_ride</td>
      <td>6275.0</td>
      <td>09-01</td>
    </tr>
    <tr>
      <th>4</th>
      <td>2019-09-01</td>
      <td>10~11_ride</td>
      <td>6774.0</td>
      <td>09-01</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>205</th>
      <td>2019-09-30</td>
      <td>8~9_ride</td>
      <td>15699.0</td>
      <td>09-30</td>
    </tr>
    <tr>
      <th>206</th>
      <td>2019-09-30</td>
      <td>9~10_ride</td>
      <td>11803.0</td>
      <td>09-30</td>
    </tr>
    <tr>
      <th>207</th>
      <td>2019-09-30</td>
      <td>10~11_ride</td>
      <td>10565.0</td>
      <td>09-30</td>
    </tr>
    <tr>
      <th>208</th>
      <td>2019-09-30</td>
      <td>11~12_ride</td>
      <td>9505.0</td>
      <td>09-30</td>
    </tr>
    <tr>
      <th>209</th>
      <td>2019-09-30</td>
      <td>18~20_ride</td>
      <td>19712.0</td>
      <td>09-30</td>
    </tr>
  </tbody>
</table>
<p>210 rows × 4 columns</p>
</div>
      <button class="colab-df-convert" onclick="convertToInteractive('df-7f2949d6-2309-4625-9609-30e39e937f51')"
              title="Convert this dataframe to an interactive table."
              style="display:none;">

  <svg xmlns="http://www.w3.org/2000/svg" height="24px"viewBox="0 0 24 24"
       width="24px">
    <path d="M0 0h24v24H0V0z" fill="none"/>
    <path d="M18.56 5.44l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94zm-11 1L8.5 8.5l.94-2.06 2.06-.94-2.06-.94L8.5 2.5l-.94 2.06-2.06.94zm10 10l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94z"/><path d="M17.41 7.96l-1.37-1.37c-.4-.4-.92-.59-1.43-.59-.52 0-1.04.2-1.43.59L10.3 9.45l-7.72 7.72c-.78.78-.78 2.05 0 2.83L4 21.41c.39.39.9.59 1.41.59.51 0 1.02-.2 1.41-.59l7.78-7.78 2.81-2.81c.8-.78.8-2.07 0-2.86zM5.41 20L4 18.59l7.72-7.72 1.47 1.35L5.41 20z"/>
  </svg>
      </button>

  <style>
    .colab-df-container {
      display:flex;
      flex-wrap:wrap;
      gap: 12px;
    }

    .colab-df-convert {
      background-color: #E8F0FE;
      border: none;
      border-radius: 50%;
      cursor: pointer;
      display: none;
      fill: #1967D2;
      height: 32px;
      padding: 0 0 0 0;
      width: 32px;
    }

    .colab-df-convert:hover {
      background-color: #E2EBFA;
      box-shadow: 0px 1px 2px rgba(60, 64, 67, 0.3), 0px 1px 3px 1px rgba(60, 64, 67, 0.15);
      fill: #174EA6;
    }

    [theme=dark] .colab-df-convert {
      background-color: #3B4455;
      fill: #D2E3FC;
    }

    [theme=dark] .colab-df-convert:hover {
      background-color: #434B5C;
      box-shadow: 0px 1px 3px 1px rgba(0, 0, 0, 0.15);
      filter: drop-shadow(0px 1px 2px rgba(0, 0, 0, 0.3));
      fill: #FFFFFF;
    }
  </style>

      <script>
        const buttonEl =
          document.querySelector('#df-7f2949d6-2309-4625-9609-30e39e937f51 button.colab-df-convert');
        buttonEl.style.display =
          google.colab.kernel.accessAllowed ? 'block' : 'none';

        async function convertToInteractive(key) {
          const element = document.querySelector('#df-7f2949d6-2309-4625-9609-30e39e937f51');
          const dataTable =
            await google.colab.kernel.invokeFunction('convertToInteractive',
                                                     [key], {});
          if (!dataTable) return;

          const docLinkHtml = 'Like what you see? Visit the ' +
            '<a target="_blank" href=https://colab.research.google.com/notebooks/data_table.ipynb>data table notebook</a>'
            + ' to learn more about interactive tables.';
          element.innerHTML = '';
          dataTable['output_type'] = 'display_data';
          await google.colab.output.renderOutput(dataTable, element);
          const docLink = document.createElement('div');
          docLink.innerHTML = docLinkHtml;
          element.appendChild(docLink);
        }
      </script>
    </div>
  </div>





```python
df_date_takeoff = train.groupby(['date']).sum()[takeoff_col_list].stack().reset_index()
df_date_takeoff.columns = ['date', 'takeoff_time', 'count']
df_date_takeoff['date_disp'] = df_date_takeoff['date'].apply(lambda x: x[5:])
df_date_takeoff.head(5)
```





  <div id="df-59e45d75-95d4-4d86-ae04-444dc040a339">
    <div class="colab-df-container">
      <div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>date</th>
      <th>takeoff_time</th>
      <th>count</th>
      <th>date_disp</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>2019-09-01</td>
      <td>6~7_takeoff</td>
      <td>1343.0</td>
      <td>09-01</td>
    </tr>
    <tr>
      <th>1</th>
      <td>2019-09-01</td>
      <td>7~8_takeoff</td>
      <td>2713.0</td>
      <td>09-01</td>
    </tr>
    <tr>
      <th>2</th>
      <td>2019-09-01</td>
      <td>8~9_takeoff</td>
      <td>3671.0</td>
      <td>09-01</td>
    </tr>
    <tr>
      <th>3</th>
      <td>2019-09-01</td>
      <td>9~10_takeoff</td>
      <td>4077.0</td>
      <td>09-01</td>
    </tr>
    <tr>
      <th>4</th>
      <td>2019-09-01</td>
      <td>10~11_takeoff</td>
      <td>4510.0</td>
      <td>09-01</td>
    </tr>
  </tbody>
</table>
</div>
      <button class="colab-df-convert" onclick="convertToInteractive('df-59e45d75-95d4-4d86-ae04-444dc040a339')"
              title="Convert this dataframe to an interactive table."
              style="display:none;">

  <svg xmlns="http://www.w3.org/2000/svg" height="24px"viewBox="0 0 24 24"
       width="24px">
    <path d="M0 0h24v24H0V0z" fill="none"/>
    <path d="M18.56 5.44l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94zm-11 1L8.5 8.5l.94-2.06 2.06-.94-2.06-.94L8.5 2.5l-.94 2.06-2.06.94zm10 10l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94z"/><path d="M17.41 7.96l-1.37-1.37c-.4-.4-.92-.59-1.43-.59-.52 0-1.04.2-1.43.59L10.3 9.45l-7.72 7.72c-.78.78-.78 2.05 0 2.83L4 21.41c.39.39.9.59 1.41.59.51 0 1.02-.2 1.41-.59l7.78-7.78 2.81-2.81c.8-.78.8-2.07 0-2.86zM5.41 20L4 18.59l7.72-7.72 1.47 1.35L5.41 20z"/>
  </svg>
      </button>

  <style>
    .colab-df-container {
      display:flex;
      flex-wrap:wrap;
      gap: 12px;
    }

    .colab-df-convert {
      background-color: #E8F0FE;
      border: none;
      border-radius: 50%;
      cursor: pointer;
      display: none;
      fill: #1967D2;
      height: 32px;
      padding: 0 0 0 0;
      width: 32px;
    }

    .colab-df-convert:hover {
      background-color: #E2EBFA;
      box-shadow: 0px 1px 2px rgba(60, 64, 67, 0.3), 0px 1px 3px 1px rgba(60, 64, 67, 0.15);
      fill: #174EA6;
    }

    [theme=dark] .colab-df-convert {
      background-color: #3B4455;
      fill: #D2E3FC;
    }

    [theme=dark] .colab-df-convert:hover {
      background-color: #434B5C;
      box-shadow: 0px 1px 3px 1px rgba(0, 0, 0, 0.15);
      filter: drop-shadow(0px 1px 2px rgba(0, 0, 0, 0.3));
      fill: #FFFFFF;
    }
  </style>

      <script>
        const buttonEl =
          document.querySelector('#df-59e45d75-95d4-4d86-ae04-444dc040a339 button.colab-df-convert');
        buttonEl.style.display =
          google.colab.kernel.accessAllowed ? 'block' : 'none';

        async function convertToInteractive(key) {
          const element = document.querySelector('#df-59e45d75-95d4-4d86-ae04-444dc040a339');
          const dataTable =
            await google.colab.kernel.invokeFunction('convertToInteractive',
                                                     [key], {});
          if (!dataTable) return;

          const docLinkHtml = 'Like what you see? Visit the ' +
            '<a target="_blank" href=https://colab.research.google.com/notebooks/data_table.ipynb>data table notebook</a>'
            + ' to learn more about interactive tables.';
          element.innerHTML = '';
          dataTable['output_type'] = 'display_data';
          await google.colab.output.renderOutput(dataTable, element);
          const docLink = document.createElement('div');
          docLink.innerHTML = docLinkHtml;
          element.appendChild(docLink);
        }
      </script>
    </div>
  </div>





```python
plt.figure(figsize=(25,15))
plt.rc('font', family = 'NanumBarunGothic')

plt.subplot(2,1,1)
sns.lineplot(x='date_disp', y='count', hue='ride_time', data=df_date_ride)
plt.title('날짜별 승차량 증감', size=25)
plt.xlabel('날짜', size=12)
plt.ylabel('인원수', size=12)

plt.subplot(2,1,2)
sns.lineplot(x='date_disp', y='count', hue='takeoff_time', data=df_date_takeoff)
plt.title('날짜별 하차량 증감', size=25)
plt.xlabel('날짜', size=12)
plt.ylabel('인원수', size=12)
```




    Text(0, 0.5, '인원수')




    
![png](/data/2023-02-05-Bus/output_39_1.png)
    


2019년 공휴일 리스트 생성


```python
holidays = ['01-01', '02-04', '02-05', '02-06', '03-01', '05-05', '05-06', '05-12', '06-06', '08-15',
            '09-12', '09-13', '09-14', '10-03', '10-09', '12-25']
holidays = ['2019-'+day for day in holidays]
```

평일, 주말, 공휴일 구분하기


||striptime|strftime|
|:----|:---------|:---------|
|용도|주어진 포맷에 따라 객체를 문자열로 변환|주어진 해당 포맷으로 문자열을 datetime 객체로 구문 분석|
|메서드형|인스턴스 메서드|클래스 메서드|

****
**strptime()** [연/월/일]
<br/>%Y : 연도(4자리) <font color="3399FF">ex. 2020  </font>
<br/>%y : 연도(끝 두자리) <font color="3399FF">ex. 20 </font>
<br/>%m : 월 <font color="3399FF">ex.01</font>
<br/>%d : 일 <font color="3399FF">ex.31</font>
<br/>%h : 영문 달 이름 <font color="3399FF">ex. Feb</font>

**strftime()**
<br/>%a : 요일 축약형 <font color="3399FF">ex. Mon  </font>
<br/>%A : 요일 <font color="3399FF">ex. Monday </font>
<br/>%w : 요일 10진수 <font color="3399FF">ex. 1(월요일)</font>
<br/>%b : 월 축약형 <font color="3399FF">ex. Feb</font>
<br/>%p : 오전, 오후 <font color="3399FF">ex. AM</font>
 ****
더 자세한 포맷 코드를 원한다면, 아래 링크로!
<br/>https://docs.python.org/ko/3/library/datetime.html#strftime-and-strptime-format-codes



```python
train['weekday'] = train['date'].apply(lambda x: datetime.datetime.strptime(x, "%Y-%m-%d").strftime("%A"))
train['holiday'] = train.apply(lambda row: 'Y' if row.date in holidays else 'N', axis=1)
train['holiweekend'] = train.apply(lambda row: 'H' if row.holiday == 'Y' else 'N', axis=1)
train['holiweekend'] = train.apply(lambda row: 'WE' if row.holiweekend =='N' and row.weekday in ['Saturday', 'Sunday'] else row.holiweekend, axis=1)
```


```python
train[['date', 'weekday', 'holiday', 'holiweekend']]
```





  <div id="df-8736cd2d-a7a6-41fd-bed6-708908867608">
    <div class="colab-df-container">
      <div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>date</th>
      <th>weekday</th>
      <th>holiday</th>
      <th>holiweekend</th>
    </tr>
    <tr>
      <th>id</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>2019-09-01</td>
      <td>Sunday</td>
      <td>N</td>
      <td>WE</td>
    </tr>
    <tr>
      <th>1</th>
      <td>2019-09-01</td>
      <td>Sunday</td>
      <td>N</td>
      <td>WE</td>
    </tr>
    <tr>
      <th>2</th>
      <td>2019-09-01</td>
      <td>Sunday</td>
      <td>N</td>
      <td>WE</td>
    </tr>
    <tr>
      <th>3</th>
      <td>2019-09-01</td>
      <td>Sunday</td>
      <td>N</td>
      <td>WE</td>
    </tr>
    <tr>
      <th>4</th>
      <td>2019-09-01</td>
      <td>Sunday</td>
      <td>N</td>
      <td>WE</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>415418</th>
      <td>2019-09-30</td>
      <td>Monday</td>
      <td>N</td>
      <td>N</td>
    </tr>
    <tr>
      <th>415419</th>
      <td>2019-09-30</td>
      <td>Monday</td>
      <td>N</td>
      <td>N</td>
    </tr>
    <tr>
      <th>415420</th>
      <td>2019-09-30</td>
      <td>Monday</td>
      <td>N</td>
      <td>N</td>
    </tr>
    <tr>
      <th>415421</th>
      <td>2019-09-30</td>
      <td>Monday</td>
      <td>N</td>
      <td>N</td>
    </tr>
    <tr>
      <th>415422</th>
      <td>2019-09-30</td>
      <td>Monday</td>
      <td>N</td>
      <td>N</td>
    </tr>
  </tbody>
</table>
<p>415423 rows × 4 columns</p>
</div>
      <button class="colab-df-convert" onclick="convertToInteractive('df-8736cd2d-a7a6-41fd-bed6-708908867608')"
              title="Convert this dataframe to an interactive table."
              style="display:none;">

  <svg xmlns="http://www.w3.org/2000/svg" height="24px"viewBox="0 0 24 24"
       width="24px">
    <path d="M0 0h24v24H0V0z" fill="none"/>
    <path d="M18.56 5.44l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94zm-11 1L8.5 8.5l.94-2.06 2.06-.94-2.06-.94L8.5 2.5l-.94 2.06-2.06.94zm10 10l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94z"/><path d="M17.41 7.96l-1.37-1.37c-.4-.4-.92-.59-1.43-.59-.52 0-1.04.2-1.43.59L10.3 9.45l-7.72 7.72c-.78.78-.78 2.05 0 2.83L4 21.41c.39.39.9.59 1.41.59.51 0 1.02-.2 1.41-.59l7.78-7.78 2.81-2.81c.8-.78.8-2.07 0-2.86zM5.41 20L4 18.59l7.72-7.72 1.47 1.35L5.41 20z"/>
  </svg>
      </button>

  <style>
    .colab-df-container {
      display:flex;
      flex-wrap:wrap;
      gap: 12px;
    }

    .colab-df-convert {
      background-color: #E8F0FE;
      border: none;
      border-radius: 50%;
      cursor: pointer;
      display: none;
      fill: #1967D2;
      height: 32px;
      padding: 0 0 0 0;
      width: 32px;
    }

    .colab-df-convert:hover {
      background-color: #E2EBFA;
      box-shadow: 0px 1px 2px rgba(60, 64, 67, 0.3), 0px 1px 3px 1px rgba(60, 64, 67, 0.15);
      fill: #174EA6;
    }

    [theme=dark] .colab-df-convert {
      background-color: #3B4455;
      fill: #D2E3FC;
    }

    [theme=dark] .colab-df-convert:hover {
      background-color: #434B5C;
      box-shadow: 0px 1px 3px 1px rgba(0, 0, 0, 0.15);
      filter: drop-shadow(0px 1px 2px rgba(0, 0, 0, 0.3));
      fill: #FFFFFF;
    }
  </style>

      <script>
        const buttonEl =
          document.querySelector('#df-8736cd2d-a7a6-41fd-bed6-708908867608 button.colab-df-convert');
        buttonEl.style.display =
          google.colab.kernel.accessAllowed ? 'block' : 'none';

        async function convertToInteractive(key) {
          const element = document.querySelector('#df-8736cd2d-a7a6-41fd-bed6-708908867608');
          const dataTable =
            await google.colab.kernel.invokeFunction('convertToInteractive',
                                                     [key], {});
          if (!dataTable) return;

          const docLinkHtml = 'Like what you see? Visit the ' +
            '<a target="_blank" href=https://colab.research.google.com/notebooks/data_table.ipynb>data table notebook</a>'
            + ' to learn more about interactive tables.';
          element.innerHTML = '';
          dataTable['output_type'] = 'display_data';
          await google.colab.output.renderOutput(dataTable, element);
          const docLink = document.createElement('div');
          docLink.innerHTML = docLinkHtml;
          element.appendChild(docLink);
        }
      </script>
    </div>
  </div>





```python
weekday_order = ['Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday', 'Sunday']
```


```python
# 요일별 시간대별 승차 인원(평균)
df_week_ride = train.groupby(['weekday']).mean()[ride_col_list[:-1]].stack().reset_index()
df_week_ride.columns = ['weekday', 'ride_time', 'count']
df_week_ride.head(10)
```





  <div id="df-d94194fd-fc93-491c-ae70-c9a04087a658">
    <div class="colab-df-container">
      <div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>weekday</th>
      <th>ride_time</th>
      <th>count</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>Friday</td>
      <td>6~7_ride</td>
      <td>0.321627</td>
    </tr>
    <tr>
      <th>1</th>
      <td>Friday</td>
      <td>7~8_ride</td>
      <td>0.894317</td>
    </tr>
    <tr>
      <th>2</th>
      <td>Friday</td>
      <td>8~9_ride</td>
      <td>0.855104</td>
    </tr>
    <tr>
      <th>3</th>
      <td>Friday</td>
      <td>9~10_ride</td>
      <td>0.619050</td>
    </tr>
    <tr>
      <th>4</th>
      <td>Friday</td>
      <td>10~11_ride</td>
      <td>0.576228</td>
    </tr>
    <tr>
      <th>5</th>
      <td>Friday</td>
      <td>11~12_ride</td>
      <td>0.561128</td>
    </tr>
    <tr>
      <th>6</th>
      <td>Monday</td>
      <td>6~7_ride</td>
      <td>0.328862</td>
    </tr>
    <tr>
      <th>7</th>
      <td>Monday</td>
      <td>7~8_ride</td>
      <td>0.988160</td>
    </tr>
    <tr>
      <th>8</th>
      <td>Monday</td>
      <td>8~9_ride</td>
      <td>0.913985</td>
    </tr>
    <tr>
      <th>9</th>
      <td>Monday</td>
      <td>9~10_ride</td>
      <td>0.692790</td>
    </tr>
  </tbody>
</table>
</div>
      <button class="colab-df-convert" onclick="convertToInteractive('df-d94194fd-fc93-491c-ae70-c9a04087a658')"
              title="Convert this dataframe to an interactive table."
              style="display:none;">

  <svg xmlns="http://www.w3.org/2000/svg" height="24px"viewBox="0 0 24 24"
       width="24px">
    <path d="M0 0h24v24H0V0z" fill="none"/>
    <path d="M18.56 5.44l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94zm-11 1L8.5 8.5l.94-2.06 2.06-.94-2.06-.94L8.5 2.5l-.94 2.06-2.06.94zm10 10l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94z"/><path d="M17.41 7.96l-1.37-1.37c-.4-.4-.92-.59-1.43-.59-.52 0-1.04.2-1.43.59L10.3 9.45l-7.72 7.72c-.78.78-.78 2.05 0 2.83L4 21.41c.39.39.9.59 1.41.59.51 0 1.02-.2 1.41-.59l7.78-7.78 2.81-2.81c.8-.78.8-2.07 0-2.86zM5.41 20L4 18.59l7.72-7.72 1.47 1.35L5.41 20z"/>
  </svg>
      </button>

  <style>
    .colab-df-container {
      display:flex;
      flex-wrap:wrap;
      gap: 12px;
    }

    .colab-df-convert {
      background-color: #E8F0FE;
      border: none;
      border-radius: 50%;
      cursor: pointer;
      display: none;
      fill: #1967D2;
      height: 32px;
      padding: 0 0 0 0;
      width: 32px;
    }

    .colab-df-convert:hover {
      background-color: #E2EBFA;
      box-shadow: 0px 1px 2px rgba(60, 64, 67, 0.3), 0px 1px 3px 1px rgba(60, 64, 67, 0.15);
      fill: #174EA6;
    }

    [theme=dark] .colab-df-convert {
      background-color: #3B4455;
      fill: #D2E3FC;
    }

    [theme=dark] .colab-df-convert:hover {
      background-color: #434B5C;
      box-shadow: 0px 1px 3px 1px rgba(0, 0, 0, 0.15);
      filter: drop-shadow(0px 1px 2px rgba(0, 0, 0, 0.3));
      fill: #FFFFFF;
    }
  </style>

      <script>
        const buttonEl =
          document.querySelector('#df-d94194fd-fc93-491c-ae70-c9a04087a658 button.colab-df-convert');
        buttonEl.style.display =
          google.colab.kernel.accessAllowed ? 'block' : 'none';

        async function convertToInteractive(key) {
          const element = document.querySelector('#df-d94194fd-fc93-491c-ae70-c9a04087a658');
          const dataTable =
            await google.colab.kernel.invokeFunction('convertToInteractive',
                                                     [key], {});
          if (!dataTable) return;

          const docLinkHtml = 'Like what you see? Visit the ' +
            '<a target="_blank" href=https://colab.research.google.com/notebooks/data_table.ipynb>data table notebook</a>'
            + ' to learn more about interactive tables.';
          element.innerHTML = '';
          dataTable['output_type'] = 'display_data';
          await google.colab.output.renderOutput(dataTable, element);
          const docLink = document.createElement('div');
          docLink.innerHTML = docLinkHtml;
          element.appendChild(docLink);
        }
      </script>
    </div>
  </div>





```python
# 요일별 시간대별 하차 인원(평균)
df_week_takeoff = train.groupby(['weekday']).mean()[takeoff_col_list[:-1]].stack().reset_index()
df_week_takeoff.columns = ['weekday', 'takeoff_time', 'count']
df_week_takeoff.tail(10)
```





  <div id="df-347e998d-c680-4ca6-a55d-4f07b8cb8e1b">
    <div class="colab-df-container">
      <div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>weekday</th>
      <th>takeoff_time</th>
      <th>count</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>32</th>
      <td>Tuesday</td>
      <td>8~9_takeoff</td>
      <td>0.620581</td>
    </tr>
    <tr>
      <th>33</th>
      <td>Tuesday</td>
      <td>9~10_takeoff</td>
      <td>0.476048</td>
    </tr>
    <tr>
      <th>34</th>
      <td>Tuesday</td>
      <td>10~11_takeoff</td>
      <td>0.421016</td>
    </tr>
    <tr>
      <th>35</th>
      <td>Tuesday</td>
      <td>11~12_takeoff</td>
      <td>0.407171</td>
    </tr>
    <tr>
      <th>36</th>
      <td>Wednesday</td>
      <td>6~7_takeoff</td>
      <td>0.124013</td>
    </tr>
    <tr>
      <th>37</th>
      <td>Wednesday</td>
      <td>7~8_takeoff</td>
      <td>0.399699</td>
    </tr>
    <tr>
      <th>38</th>
      <td>Wednesday</td>
      <td>8~9_takeoff</td>
      <td>0.582432</td>
    </tr>
    <tr>
      <th>39</th>
      <td>Wednesday</td>
      <td>9~10_takeoff</td>
      <td>0.447656</td>
    </tr>
    <tr>
      <th>40</th>
      <td>Wednesday</td>
      <td>10~11_takeoff</td>
      <td>0.411336</td>
    </tr>
    <tr>
      <th>41</th>
      <td>Wednesday</td>
      <td>11~12_takeoff</td>
      <td>0.399035</td>
    </tr>
  </tbody>
</table>
</div>
      <button class="colab-df-convert" onclick="convertToInteractive('df-347e998d-c680-4ca6-a55d-4f07b8cb8e1b')"
              title="Convert this dataframe to an interactive table."
              style="display:none;">

  <svg xmlns="http://www.w3.org/2000/svg" height="24px"viewBox="0 0 24 24"
       width="24px">
    <path d="M0 0h24v24H0V0z" fill="none"/>
    <path d="M18.56 5.44l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94zm-11 1L8.5 8.5l.94-2.06 2.06-.94-2.06-.94L8.5 2.5l-.94 2.06-2.06.94zm10 10l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94z"/><path d="M17.41 7.96l-1.37-1.37c-.4-.4-.92-.59-1.43-.59-.52 0-1.04.2-1.43.59L10.3 9.45l-7.72 7.72c-.78.78-.78 2.05 0 2.83L4 21.41c.39.39.9.59 1.41.59.51 0 1.02-.2 1.41-.59l7.78-7.78 2.81-2.81c.8-.78.8-2.07 0-2.86zM5.41 20L4 18.59l7.72-7.72 1.47 1.35L5.41 20z"/>
  </svg>
      </button>

  <style>
    .colab-df-container {
      display:flex;
      flex-wrap:wrap;
      gap: 12px;
    }

    .colab-df-convert {
      background-color: #E8F0FE;
      border: none;
      border-radius: 50%;
      cursor: pointer;
      display: none;
      fill: #1967D2;
      height: 32px;
      padding: 0 0 0 0;
      width: 32px;
    }

    .colab-df-convert:hover {
      background-color: #E2EBFA;
      box-shadow: 0px 1px 2px rgba(60, 64, 67, 0.3), 0px 1px 3px 1px rgba(60, 64, 67, 0.15);
      fill: #174EA6;
    }

    [theme=dark] .colab-df-convert {
      background-color: #3B4455;
      fill: #D2E3FC;
    }

    [theme=dark] .colab-df-convert:hover {
      background-color: #434B5C;
      box-shadow: 0px 1px 3px 1px rgba(0, 0, 0, 0.15);
      filter: drop-shadow(0px 1px 2px rgba(0, 0, 0, 0.3));
      fill: #FFFFFF;
    }
  </style>

      <script>
        const buttonEl =
          document.querySelector('#df-347e998d-c680-4ca6-a55d-4f07b8cb8e1b button.colab-df-convert');
        buttonEl.style.display =
          google.colab.kernel.accessAllowed ? 'block' : 'none';

        async function convertToInteractive(key) {
          const element = document.querySelector('#df-347e998d-c680-4ca6-a55d-4f07b8cb8e1b');
          const dataTable =
            await google.colab.kernel.invokeFunction('convertToInteractive',
                                                     [key], {});
          if (!dataTable) return;

          const docLinkHtml = 'Like what you see? Visit the ' +
            '<a target="_blank" href=https://colab.research.google.com/notebooks/data_table.ipynb>data table notebook</a>'
            + ' to learn more about interactive tables.';
          element.innerHTML = '';
          dataTable['output_type'] = 'display_data';
          await google.colab.output.renderOutput(dataTable, element);
          const docLink = document.createElement('div');
          docLink.innerHTML = docLinkHtml;
          element.appendChild(docLink);
        }
      </script>
    </div>
  </div>





```python
# 월요일(0) ~ 일요일(6)
df_week_ride['order'] = df_week_ride['weekday'].apply(lambda x: weekday_order.index(x))
df_week_ride=df_week_ride.sort_values(by=['order'])
df_week_ride.head(10)
```





  <div id="df-4aae6b6a-0b17-4e1a-9fbd-5a3dd8a69b80">
    <div class="colab-df-container">
      <div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>weekday</th>
      <th>ride_time</th>
      <th>count</th>
      <th>order</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>11</th>
      <td>Monday</td>
      <td>11~12_ride</td>
      <td>0.597506</td>
      <td>0</td>
    </tr>
    <tr>
      <th>6</th>
      <td>Monday</td>
      <td>6~7_ride</td>
      <td>0.328862</td>
      <td>0</td>
    </tr>
    <tr>
      <th>7</th>
      <td>Monday</td>
      <td>7~8_ride</td>
      <td>0.988160</td>
      <td>0</td>
    </tr>
    <tr>
      <th>8</th>
      <td>Monday</td>
      <td>8~9_ride</td>
      <td>0.913985</td>
      <td>0</td>
    </tr>
    <tr>
      <th>9</th>
      <td>Monday</td>
      <td>9~10_ride</td>
      <td>0.692790</td>
      <td>0</td>
    </tr>
    <tr>
      <th>10</th>
      <td>Monday</td>
      <td>10~11_ride</td>
      <td>0.638344</td>
      <td>0</td>
    </tr>
    <tr>
      <th>30</th>
      <td>Tuesday</td>
      <td>6~7_ride</td>
      <td>0.344035</td>
      <td>1</td>
    </tr>
    <tr>
      <th>31</th>
      <td>Tuesday</td>
      <td>7~8_ride</td>
      <td>1.027342</td>
      <td>1</td>
    </tr>
    <tr>
      <th>32</th>
      <td>Tuesday</td>
      <td>8~9_ride</td>
      <td>0.978366</td>
      <td>1</td>
    </tr>
    <tr>
      <th>35</th>
      <td>Tuesday</td>
      <td>11~12_ride</td>
      <td>0.567236</td>
      <td>1</td>
    </tr>
  </tbody>
</table>
</div>
      <button class="colab-df-convert" onclick="convertToInteractive('df-4aae6b6a-0b17-4e1a-9fbd-5a3dd8a69b80')"
              title="Convert this dataframe to an interactive table."
              style="display:none;">

  <svg xmlns="http://www.w3.org/2000/svg" height="24px"viewBox="0 0 24 24"
       width="24px">
    <path d="M0 0h24v24H0V0z" fill="none"/>
    <path d="M18.56 5.44l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94zm-11 1L8.5 8.5l.94-2.06 2.06-.94-2.06-.94L8.5 2.5l-.94 2.06-2.06.94zm10 10l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94z"/><path d="M17.41 7.96l-1.37-1.37c-.4-.4-.92-.59-1.43-.59-.52 0-1.04.2-1.43.59L10.3 9.45l-7.72 7.72c-.78.78-.78 2.05 0 2.83L4 21.41c.39.39.9.59 1.41.59.51 0 1.02-.2 1.41-.59l7.78-7.78 2.81-2.81c.8-.78.8-2.07 0-2.86zM5.41 20L4 18.59l7.72-7.72 1.47 1.35L5.41 20z"/>
  </svg>
      </button>

  <style>
    .colab-df-container {
      display:flex;
      flex-wrap:wrap;
      gap: 12px;
    }

    .colab-df-convert {
      background-color: #E8F0FE;
      border: none;
      border-radius: 50%;
      cursor: pointer;
      display: none;
      fill: #1967D2;
      height: 32px;
      padding: 0 0 0 0;
      width: 32px;
    }

    .colab-df-convert:hover {
      background-color: #E2EBFA;
      box-shadow: 0px 1px 2px rgba(60, 64, 67, 0.3), 0px 1px 3px 1px rgba(60, 64, 67, 0.15);
      fill: #174EA6;
    }

    [theme=dark] .colab-df-convert {
      background-color: #3B4455;
      fill: #D2E3FC;
    }

    [theme=dark] .colab-df-convert:hover {
      background-color: #434B5C;
      box-shadow: 0px 1px 3px 1px rgba(0, 0, 0, 0.15);
      filter: drop-shadow(0px 1px 2px rgba(0, 0, 0, 0.3));
      fill: #FFFFFF;
    }
  </style>

      <script>
        const buttonEl =
          document.querySelector('#df-4aae6b6a-0b17-4e1a-9fbd-5a3dd8a69b80 button.colab-df-convert');
        buttonEl.style.display =
          google.colab.kernel.accessAllowed ? 'block' : 'none';

        async function convertToInteractive(key) {
          const element = document.querySelector('#df-4aae6b6a-0b17-4e1a-9fbd-5a3dd8a69b80');
          const dataTable =
            await google.colab.kernel.invokeFunction('convertToInteractive',
                                                     [key], {});
          if (!dataTable) return;

          const docLinkHtml = 'Like what you see? Visit the ' +
            '<a target="_blank" href=https://colab.research.google.com/notebooks/data_table.ipynb>data table notebook</a>'
            + ' to learn more about interactive tables.';
          element.innerHTML = '';
          dataTable['output_type'] = 'display_data';
          await google.colab.output.renderOutput(dataTable, element);
          const docLink = document.createElement('div');
          docLink.innerHTML = docLinkHtml;
          element.appendChild(docLink);
        }
      </script>
    </div>
  </div>





```python
df_week_takeoff['order'] = df_week_takeoff['weekday'].apply(lambda x: weekday_order.index(x))
df_week_takeoff=df_week_takeoff.sort_values(by=['order'])
df_week_takeoff.tail(10)
```





  <div id="df-c7a40f57-8972-4591-ab4a-595e57522740">
    <div class="colab-df-container">
      <div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>weekday</th>
      <th>takeoff_time</th>
      <th>count</th>
      <th>order</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>16</th>
      <td>Saturday</td>
      <td>10~11_takeoff</td>
      <td>0.385856</td>
      <td>5</td>
    </tr>
    <tr>
      <th>15</th>
      <td>Saturday</td>
      <td>9~10_takeoff</td>
      <td>0.372804</td>
      <td>5</td>
    </tr>
    <tr>
      <th>14</th>
      <td>Saturday</td>
      <td>8~9_takeoff</td>
      <td>0.330094</td>
      <td>5</td>
    </tr>
    <tr>
      <th>12</th>
      <td>Saturday</td>
      <td>6~7_takeoff</td>
      <td>0.090464</td>
      <td>5</td>
    </tr>
    <tr>
      <th>22</th>
      <td>Sunday</td>
      <td>10~11_takeoff</td>
      <td>0.367729</td>
      <td>6</td>
    </tr>
    <tr>
      <th>18</th>
      <td>Sunday</td>
      <td>6~7_takeoff</td>
      <td>0.098198</td>
      <td>6</td>
    </tr>
    <tr>
      <th>19</th>
      <td>Sunday</td>
      <td>7~8_takeoff</td>
      <td>0.209709</td>
      <td>6</td>
    </tr>
    <tr>
      <th>21</th>
      <td>Sunday</td>
      <td>9~10_takeoff</td>
      <td>0.345446</td>
      <td>6</td>
    </tr>
    <tr>
      <th>23</th>
      <td>Sunday</td>
      <td>11~12_takeoff</td>
      <td>0.376700</td>
      <td>6</td>
    </tr>
    <tr>
      <th>20</th>
      <td>Sunday</td>
      <td>8~9_takeoff</td>
      <td>0.300899</td>
      <td>6</td>
    </tr>
  </tbody>
</table>
</div>
      <button class="colab-df-convert" onclick="convertToInteractive('df-c7a40f57-8972-4591-ab4a-595e57522740')"
              title="Convert this dataframe to an interactive table."
              style="display:none;">

  <svg xmlns="http://www.w3.org/2000/svg" height="24px"viewBox="0 0 24 24"
       width="24px">
    <path d="M0 0h24v24H0V0z" fill="none"/>
    <path d="M18.56 5.44l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94zm-11 1L8.5 8.5l.94-2.06 2.06-.94-2.06-.94L8.5 2.5l-.94 2.06-2.06.94zm10 10l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94z"/><path d="M17.41 7.96l-1.37-1.37c-.4-.4-.92-.59-1.43-.59-.52 0-1.04.2-1.43.59L10.3 9.45l-7.72 7.72c-.78.78-.78 2.05 0 2.83L4 21.41c.39.39.9.59 1.41.59.51 0 1.02-.2 1.41-.59l7.78-7.78 2.81-2.81c.8-.78.8-2.07 0-2.86zM5.41 20L4 18.59l7.72-7.72 1.47 1.35L5.41 20z"/>
  </svg>
      </button>

  <style>
    .colab-df-container {
      display:flex;
      flex-wrap:wrap;
      gap: 12px;
    }

    .colab-df-convert {
      background-color: #E8F0FE;
      border: none;
      border-radius: 50%;
      cursor: pointer;
      display: none;
      fill: #1967D2;
      height: 32px;
      padding: 0 0 0 0;
      width: 32px;
    }

    .colab-df-convert:hover {
      background-color: #E2EBFA;
      box-shadow: 0px 1px 2px rgba(60, 64, 67, 0.3), 0px 1px 3px 1px rgba(60, 64, 67, 0.15);
      fill: #174EA6;
    }

    [theme=dark] .colab-df-convert {
      background-color: #3B4455;
      fill: #D2E3FC;
    }

    [theme=dark] .colab-df-convert:hover {
      background-color: #434B5C;
      box-shadow: 0px 1px 3px 1px rgba(0, 0, 0, 0.15);
      filter: drop-shadow(0px 1px 2px rgba(0, 0, 0, 0.3));
      fill: #FFFFFF;
    }
  </style>

      <script>
        const buttonEl =
          document.querySelector('#df-c7a40f57-8972-4591-ab4a-595e57522740 button.colab-df-convert');
        buttonEl.style.display =
          google.colab.kernel.accessAllowed ? 'block' : 'none';

        async function convertToInteractive(key) {
          const element = document.querySelector('#df-c7a40f57-8972-4591-ab4a-595e57522740');
          const dataTable =
            await google.colab.kernel.invokeFunction('convertToInteractive',
                                                     [key], {});
          if (!dataTable) return;

          const docLinkHtml = 'Like what you see? Visit the ' +
            '<a target="_blank" href=https://colab.research.google.com/notebooks/data_table.ipynb>data table notebook</a>'
            + ' to learn more about interactive tables.';
          element.innerHTML = '';
          dataTable['output_type'] = 'display_data';
          await google.colab.output.renderOutput(dataTable, element);
          const docLink = document.createElement('div');
          docLink.innerHTML = docLinkHtml;
          element.appendChild(docLink);
        }
      </script>
    </div>
  </div>




요일별 승하차량 추이


```python
plt.figure(figsize=(25,15))
plt.rc('font', family = 'NanumBarunGothic')
palette = sns.color_palette("Pastel2", 7)

plt.subplot(2,1,1)
sns.boxplot(x='weekday', y='count', data=df_week_ride, palette = palette)
plt.title('요일별 승차량 추이', size=25)
plt.xlabel('요일', size=12)
plt.ylabel('count', size=12)

plt.subplot(2,1,2)
sns.boxplot(x='weekday', y='count', data=df_week_takeoff, palette = palette)
plt.title('요일별 하차량 추이', size=25)
plt.xlabel('요일', size=12)
plt.ylabel('count', size=12)
```




    Text(0, 0.5, 'count')




    
![png](/data/2023-02-05-Bus/output_52_1.png)
    


평일(N), 주말(WE), 공휴일(H) 승하차량 비교


```python
df_holi_ride = train.groupby(['holiweekend']).mean()[ride_col_list[:-1]].stack().reset_index()
df_holi_ride.columns = ['holiweekend', 'ride_time', 'count']
df_holi_ride.head(10)
```





  <div id="df-db713a23-f685-4b70-aaea-b44903663295">
    <div class="colab-df-container">
      <div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>holiweekend</th>
      <th>ride_time</th>
      <th>count</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>H</td>
      <td>6~7_ride</td>
      <td>0.247274</td>
    </tr>
    <tr>
      <th>1</th>
      <td>H</td>
      <td>7~8_ride</td>
      <td>0.386927</td>
    </tr>
    <tr>
      <th>2</th>
      <td>H</td>
      <td>8~9_ride</td>
      <td>0.483414</td>
    </tr>
    <tr>
      <th>3</th>
      <td>H</td>
      <td>9~10_ride</td>
      <td>0.504053</td>
    </tr>
    <tr>
      <th>4</th>
      <td>H</td>
      <td>10~11_ride</td>
      <td>0.537452</td>
    </tr>
    <tr>
      <th>5</th>
      <td>H</td>
      <td>11~12_ride</td>
      <td>0.579023</td>
    </tr>
    <tr>
      <th>6</th>
      <td>N</td>
      <td>6~7_ride</td>
      <td>0.338143</td>
    </tr>
    <tr>
      <th>7</th>
      <td>N</td>
      <td>7~8_ride</td>
      <td>1.005598</td>
    </tr>
    <tr>
      <th>8</th>
      <td>N</td>
      <td>8~9_ride</td>
      <td>0.937893</td>
    </tr>
    <tr>
      <th>9</th>
      <td>N</td>
      <td>9~10_ride</td>
      <td>0.681753</td>
    </tr>
  </tbody>
</table>
</div>
      <button class="colab-df-convert" onclick="convertToInteractive('df-db713a23-f685-4b70-aaea-b44903663295')"
              title="Convert this dataframe to an interactive table."
              style="display:none;">

  <svg xmlns="http://www.w3.org/2000/svg" height="24px"viewBox="0 0 24 24"
       width="24px">
    <path d="M0 0h24v24H0V0z" fill="none"/>
    <path d="M18.56 5.44l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94zm-11 1L8.5 8.5l.94-2.06 2.06-.94-2.06-.94L8.5 2.5l-.94 2.06-2.06.94zm10 10l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94z"/><path d="M17.41 7.96l-1.37-1.37c-.4-.4-.92-.59-1.43-.59-.52 0-1.04.2-1.43.59L10.3 9.45l-7.72 7.72c-.78.78-.78 2.05 0 2.83L4 21.41c.39.39.9.59 1.41.59.51 0 1.02-.2 1.41-.59l7.78-7.78 2.81-2.81c.8-.78.8-2.07 0-2.86zM5.41 20L4 18.59l7.72-7.72 1.47 1.35L5.41 20z"/>
  </svg>
      </button>

  <style>
    .colab-df-container {
      display:flex;
      flex-wrap:wrap;
      gap: 12px;
    }

    .colab-df-convert {
      background-color: #E8F0FE;
      border: none;
      border-radius: 50%;
      cursor: pointer;
      display: none;
      fill: #1967D2;
      height: 32px;
      padding: 0 0 0 0;
      width: 32px;
    }

    .colab-df-convert:hover {
      background-color: #E2EBFA;
      box-shadow: 0px 1px 2px rgba(60, 64, 67, 0.3), 0px 1px 3px 1px rgba(60, 64, 67, 0.15);
      fill: #174EA6;
    }

    [theme=dark] .colab-df-convert {
      background-color: #3B4455;
      fill: #D2E3FC;
    }

    [theme=dark] .colab-df-convert:hover {
      background-color: #434B5C;
      box-shadow: 0px 1px 3px 1px rgba(0, 0, 0, 0.15);
      filter: drop-shadow(0px 1px 2px rgba(0, 0, 0, 0.3));
      fill: #FFFFFF;
    }
  </style>

      <script>
        const buttonEl =
          document.querySelector('#df-db713a23-f685-4b70-aaea-b44903663295 button.colab-df-convert');
        buttonEl.style.display =
          google.colab.kernel.accessAllowed ? 'block' : 'none';

        async function convertToInteractive(key) {
          const element = document.querySelector('#df-db713a23-f685-4b70-aaea-b44903663295');
          const dataTable =
            await google.colab.kernel.invokeFunction('convertToInteractive',
                                                     [key], {});
          if (!dataTable) return;

          const docLinkHtml = 'Like what you see? Visit the ' +
            '<a target="_blank" href=https://colab.research.google.com/notebooks/data_table.ipynb>data table notebook</a>'
            + ' to learn more about interactive tables.';
          element.innerHTML = '';
          dataTable['output_type'] = 'display_data';
          await google.colab.output.renderOutput(dataTable, element);
          const docLink = document.createElement('div');
          docLink.innerHTML = docLinkHtml;
          element.appendChild(docLink);
        }
      </script>
    </div>
  </div>





```python
df_holi_takeoff = train.groupby(['holiweekend']).mean()[takeoff_col_list[:-1]].stack().reset_index()
df_holi_takeoff.columns = ['holiweekend', 'ride_time', 'count']
df_holi_takeoff.tail(10)
```





  <div id="df-820124df-4d40-42d4-b41c-39653eee1ccc">
    <div class="colab-df-container">
      <div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>holiweekend</th>
      <th>ride_time</th>
      <th>count</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>8</th>
      <td>N</td>
      <td>8~9_takeoff</td>
      <td>0.596110</td>
    </tr>
    <tr>
      <th>9</th>
      <td>N</td>
      <td>9~10_takeoff</td>
      <td>0.461054</td>
    </tr>
    <tr>
      <th>10</th>
      <td>N</td>
      <td>10~11_takeoff</td>
      <td>0.422800</td>
    </tr>
    <tr>
      <th>11</th>
      <td>N</td>
      <td>11~12_takeoff</td>
      <td>0.408717</td>
    </tr>
    <tr>
      <th>12</th>
      <td>WE</td>
      <td>6~7_takeoff</td>
      <td>0.094355</td>
    </tr>
    <tr>
      <th>13</th>
      <td>WE</td>
      <td>7~8_takeoff</td>
      <td>0.220120</td>
    </tr>
    <tr>
      <th>14</th>
      <td>WE</td>
      <td>8~9_takeoff</td>
      <td>0.318854</td>
    </tr>
    <tr>
      <th>15</th>
      <td>WE</td>
      <td>9~10_takeoff</td>
      <td>0.363184</td>
    </tr>
    <tr>
      <th>16</th>
      <td>WE</td>
      <td>10~11_takeoff</td>
      <td>0.377488</td>
    </tr>
    <tr>
      <th>17</th>
      <td>WE</td>
      <td>11~12_takeoff</td>
      <td>0.387368</td>
    </tr>
  </tbody>
</table>
</div>
      <button class="colab-df-convert" onclick="convertToInteractive('df-820124df-4d40-42d4-b41c-39653eee1ccc')"
              title="Convert this dataframe to an interactive table."
              style="display:none;">

  <svg xmlns="http://www.w3.org/2000/svg" height="24px"viewBox="0 0 24 24"
       width="24px">
    <path d="M0 0h24v24H0V0z" fill="none"/>
    <path d="M18.56 5.44l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94zm-11 1L8.5 8.5l.94-2.06 2.06-.94-2.06-.94L8.5 2.5l-.94 2.06-2.06.94zm10 10l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94z"/><path d="M17.41 7.96l-1.37-1.37c-.4-.4-.92-.59-1.43-.59-.52 0-1.04.2-1.43.59L10.3 9.45l-7.72 7.72c-.78.78-.78 2.05 0 2.83L4 21.41c.39.39.9.59 1.41.59.51 0 1.02-.2 1.41-.59l7.78-7.78 2.81-2.81c.8-.78.8-2.07 0-2.86zM5.41 20L4 18.59l7.72-7.72 1.47 1.35L5.41 20z"/>
  </svg>
      </button>

  <style>
    .colab-df-container {
      display:flex;
      flex-wrap:wrap;
      gap: 12px;
    }

    .colab-df-convert {
      background-color: #E8F0FE;
      border: none;
      border-radius: 50%;
      cursor: pointer;
      display: none;
      fill: #1967D2;
      height: 32px;
      padding: 0 0 0 0;
      width: 32px;
    }

    .colab-df-convert:hover {
      background-color: #E2EBFA;
      box-shadow: 0px 1px 2px rgba(60, 64, 67, 0.3), 0px 1px 3px 1px rgba(60, 64, 67, 0.15);
      fill: #174EA6;
    }

    [theme=dark] .colab-df-convert {
      background-color: #3B4455;
      fill: #D2E3FC;
    }

    [theme=dark] .colab-df-convert:hover {
      background-color: #434B5C;
      box-shadow: 0px 1px 3px 1px rgba(0, 0, 0, 0.15);
      filter: drop-shadow(0px 1px 2px rgba(0, 0, 0, 0.3));
      fill: #FFFFFF;
    }
  </style>

      <script>
        const buttonEl =
          document.querySelector('#df-820124df-4d40-42d4-b41c-39653eee1ccc button.colab-df-convert');
        buttonEl.style.display =
          google.colab.kernel.accessAllowed ? 'block' : 'none';

        async function convertToInteractive(key) {
          const element = document.querySelector('#df-820124df-4d40-42d4-b41c-39653eee1ccc');
          const dataTable =
            await google.colab.kernel.invokeFunction('convertToInteractive',
                                                     [key], {});
          if (!dataTable) return;

          const docLinkHtml = 'Like what you see? Visit the ' +
            '<a target="_blank" href=https://colab.research.google.com/notebooks/data_table.ipynb>data table notebook</a>'
            + ' to learn more about interactive tables.';
          element.innerHTML = '';
          dataTable['output_type'] = 'display_data';
          await google.colab.output.renderOutput(dataTable, element);
          const docLink = document.createElement('div');
          docLink.innerHTML = docLinkHtml;
          element.appendChild(docLink);
        }
      </script>
    </div>
  </div>





```python
plt.figure(figsize=(16,8))
plt.rc('font', family = 'NanumBarunGothic')
palette = sns.color_palette("Pastel1", 3)

plt.subplot(1,2,1)
sns.boxplot(x='holiweekend', y='count', data=df_holi_ride, palette = palette)
plt.title('승차(공휴일/평일/주말)', size=25)
plt.xlabel('일', size=12)
plt.ylabel('count', size=12)

plt.subplot(1,2,2)
sns.boxplot(x='holiweekend', y='count', data=df_holi_takeoff, palette = palette)
plt.title('하차(공휴일/평일/주말)', size=25)
plt.xlabel('일', size=12)
plt.ylabel('count', size=12)
```




    Text(0, 0.5, 'count')




    
![png](/data/2023-02-05-Bus/output_56_1.png)
    


다른날에 비해 평일 버스 수요가 확실히 높다

## 지도에 표시하기

(파일 용량을 고려해 결과 캡처본으로 결과를 대신함)


```python
coords_jejusi = (33.51411, 126.52969) #제주 측정소 근처 위도 경도
coords_seoquipo = (33.24616, 126.5653) #서귀포 측정소 근처 위도 경도
coords_gosan = (33.29382, 126.16283) #고산 측정소 근처 위도 경도
coords_seongsan = (33.38677, 126.8802) #성산 측정소 근처 위도 경도
```


```python
map_osm= folium.Map((33.399835, 126.506031),zoom_start=10)
mc = MarkerCluster()

mc.add_child( folium.Marker(location=coords_jejusi,popup='제주 측정소',icon=folium.Icon(color='red',icon='info-sign') ) ) #제주 측정소 마커 생성
map_osm.add_child(mc) #마커를 map_osm에 추가

mc.add_child( folium.Marker(location=coords_gosan,popup='고산 측정소',icon=folium.Icon(color='red',icon='info-sign') ) )
map_osm.add_child(mc) 

mc.add_child( folium.Marker(location=coords_seongsan,popup='성산 측정소',icon=folium.Icon(color='red',icon='info-sign') ) )
map_osm.add_child(mc) 

mc.add_child( folium.Marker(location=coords_seoquipo,popup='서귀포 측정소',icon=folium.Icon(color='red',icon='info-sign') ) )
map_osm.add_child(mc)
```

![img](https://ifh.cc/g/sFnTPY.jpg)


```python
#정류장의 위치만 확인하기 위해 drop_duplicates() 및 groupby()를 사용함
data=train[['latitude','longitude','station_name']].drop_duplicates(keep='first')

data2=data.groupby(['station_name'])['latitude','longitude'].mean()

data2.to_csv("folium.csv")

data2=pd.read_csv("folium.csv")

#정류장의 대략적인 위치를 확인하기 위하여, folium map에 해당 정류장을 표시
for row in data2.itertuples():
    mc.add_child(folium.Marker(location=[row.latitude,  row.longitude], popup=row.station_name)) #마커 생성
    map_osm.add_child(mc) #마커를 map_osm에 추가
    
map_osm
```

![img](https://ifh.cc/g/mZlhw2.jpg)

# 데이터 전처리

## date 컬럼

날(요일, 평일, 휴일)별 승하차량을 비교한 것을 토대로 전처리 진행


```python
# 전처리를 위해 데이터타입 int로 변경
train['date_week'] = pd.to_datetime(train['date'])
train['weekday'] = train['date_week'].dt.weekday
```


```python
test['date_week'] = pd.to_datetime(test['date'])
test['weekday'] = test['date_week'].dt.weekday
```

train 데이터는 2019년 9월, test 데이터는 2019년 10월 데이터다. <br/> 따라서, 19년도 9월, 10월의 공휴일 리스트를 생성한다.


```python
holidays = ['2019-09-12', '2019-09-13', '2019-09-14', '2019-10-03', '2019-10-09']
```

평일: N, 주말: WE, 공휴일: H


```python
train['holiday'] = train.apply(lambda row: 'Y' if row.date in holidays else 'N', axis=1)
train['holiweekend'] = train.apply(lambda row: 'H' if row.holiday == 'Y' else 'N', axis=1)
train['holiweekend'] = train.apply(lambda row: 'WE' if row.holiweekend =='N' and row.weekday in [5,6] else row.holiweekend, axis=1)


test['holiday'] = test.apply(lambda row: 'Y' if row.date in holidays else 'N', axis=1)
test['holiweekend'] = test.apply(lambda row: 'H' if row.holiday == 'Y' else 'N', axis=1)
test['holiweekend'] = test.apply(lambda row: 'WE' if row.holiweekend =='N' and row.weekday in [5,6] else row.holiweekend, axis=1)
```


```python
train['holiweekend'].value_counts()
```




    N     297247
    WE     87457
    H      30719
    Name: holiweekend, dtype: int64




```python
test['holiweekend'].value_counts()
```




    N     153063
    WE     50501
    H      24606
    Name: holiweekend, dtype: int64




```python
coords_jejusi = (33.51411, 126.52969) #제주 측정소 근처 위도 경도
coords_seoquipo = (33.24616, 126.5653) #서귀포 측정소 근처 위도 경도
coords_gosan = (33.29382, 126.16283) #고산 측정소 근처 위도 경도
coords_seongsan = (33.38677, 126.8802) #성산 측정소 근처 위도 경도
```

위도, 경도 묶어서 lacation 컬럼 생성


```python
train['location'] = train.apply(lambda row: (row.latitude, row.longitude), axis=1)
train['location']
```




    id
    0                   (33.4899, 126.49373)
    1                  (33.48944, 126.48508)
    2                  (33.48181, 126.47352)
    3                  (33.50577, 126.49252)
    4         (33.255790000000005, 126.4126)
                           ...              
    415418             (33.41437, 126.26336)
    415419             (33.49946, 126.51479)
    415420               (33.231, 126.26273)
    415421              (33.46483, 126.3187)
    415422             (33.24873, 126.50799)
    Name: location, Length: 415423, dtype: object




```python
#정류장의 위치 확인하기 위해 groupby() 사용
station_loc=train[['location','station_name']].drop_duplicates(keep='first')
station_loc
```





  <div id="df-9db6a9ba-9c1b-4628-bae1-e7ca9a5d4362">
    <div class="colab-df-container">
      <div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>location</th>
      <th>station_name</th>
    </tr>
    <tr>
      <th>id</th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>(33.4899, 126.49373)</td>
      <td>제주썬호텔</td>
    </tr>
    <tr>
      <th>1</th>
      <td>(33.48944, 126.48508)</td>
      <td>한라병원</td>
    </tr>
    <tr>
      <th>2</th>
      <td>(33.48181, 126.47352)</td>
      <td>정존마을</td>
    </tr>
    <tr>
      <th>3</th>
      <td>(33.50577, 126.49252)</td>
      <td>제주국제공항(600번)</td>
    </tr>
    <tr>
      <th>4</th>
      <td>(33.255790000000005, 126.4126)</td>
      <td>중문관광단지입구</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>374291</th>
      <td>(33.96252, 126.29429)</td>
      <td>대서리</td>
    </tr>
    <tr>
      <th>393524</th>
      <td>(33.33595, 126.26332)</td>
      <td>저지리알못</td>
    </tr>
    <tr>
      <th>397921</th>
      <td>(33.258990000000004, 126.27554)</td>
      <td>어썸브리즈</td>
    </tr>
    <tr>
      <th>400433</th>
      <td>(33.43489, 126.73242)</td>
      <td>셰프라인월드</td>
    </tr>
    <tr>
      <th>406662</th>
      <td>(33.54574, 126.8037)</td>
      <td>행원교차로</td>
    </tr>
  </tbody>
</table>
<p>3563 rows × 2 columns</p>
</div>
      <button class="colab-df-convert" onclick="convertToInteractive('df-9db6a9ba-9c1b-4628-bae1-e7ca9a5d4362')"
              title="Convert this dataframe to an interactive table."
              style="display:none;">

  <svg xmlns="http://www.w3.org/2000/svg" height="24px"viewBox="0 0 24 24"
       width="24px">
    <path d="M0 0h24v24H0V0z" fill="none"/>
    <path d="M18.56 5.44l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94zm-11 1L8.5 8.5l.94-2.06 2.06-.94-2.06-.94L8.5 2.5l-.94 2.06-2.06.94zm10 10l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94z"/><path d="M17.41 7.96l-1.37-1.37c-.4-.4-.92-.59-1.43-.59-.52 0-1.04.2-1.43.59L10.3 9.45l-7.72 7.72c-.78.78-.78 2.05 0 2.83L4 21.41c.39.39.9.59 1.41.59.51 0 1.02-.2 1.41-.59l7.78-7.78 2.81-2.81c.8-.78.8-2.07 0-2.86zM5.41 20L4 18.59l7.72-7.72 1.47 1.35L5.41 20z"/>
  </svg>
      </button>

  <style>
    .colab-df-container {
      display:flex;
      flex-wrap:wrap;
      gap: 12px;
    }

    .colab-df-convert {
      background-color: #E8F0FE;
      border: none;
      border-radius: 50%;
      cursor: pointer;
      display: none;
      fill: #1967D2;
      height: 32px;
      padding: 0 0 0 0;
      width: 32px;
    }

    .colab-df-convert:hover {
      background-color: #E2EBFA;
      box-shadow: 0px 1px 2px rgba(60, 64, 67, 0.3), 0px 1px 3px 1px rgba(60, 64, 67, 0.15);
      fill: #174EA6;
    }

    [theme=dark] .colab-df-convert {
      background-color: #3B4455;
      fill: #D2E3FC;
    }

    [theme=dark] .colab-df-convert:hover {
      background-color: #434B5C;
      box-shadow: 0px 1px 3px 1px rgba(0, 0, 0, 0.15);
      filter: drop-shadow(0px 1px 2px rgba(0, 0, 0, 0.3));
      fill: #FFFFFF;
    }
  </style>

      <script>
        const buttonEl =
          document.querySelector('#df-9db6a9ba-9c1b-4628-bae1-e7ca9a5d4362 button.colab-df-convert');
        buttonEl.style.display =
          google.colab.kernel.accessAllowed ? 'block' : 'none';

        async function convertToInteractive(key) {
          const element = document.querySelector('#df-9db6a9ba-9c1b-4628-bae1-e7ca9a5d4362');
          const dataTable =
            await google.colab.kernel.invokeFunction('convertToInteractive',
                                                     [key], {});
          if (!dataTable) return;

          const docLinkHtml = 'Like what you see? Visit the ' +
            '<a target="_blank" href=https://colab.research.google.com/notebooks/data_table.ipynb>data table notebook</a>'
            + ' to learn more about interactive tables.';
          element.innerHTML = '';
          dataTable['output_type'] = 'display_data';
          await google.colab.output.renderOutput(dataTable, element);
          const docLink = document.createElement('div');
          docLink.innerHTML = docLinkHtml;
          element.appendChild(docLink);
        }
      </script>
    </div>
  </div>




> 제주 위치와 정류소 사이 거리 컬럼


```python
train['dist_jj'] = train['location'].apply(lambda x: geopy.distance.geodesic( x, coords_jejusi).km)
```

> 서귀포 위치와 정류소 사이 거리 컬럼


```python
train['dist_sp'] = train['location'].apply(lambda x: geopy.distance.geodesic( x, coords_seoquipo).km)
```

> 고산 위치와 정류소 사이 거리 컬럼


```python
train['dist_gs'] = train['location'].apply(lambda x: geopy.distance.geodesic( x, coords_gosan).km)
```

> 성산 위치와 정류소 사이 거리 컬럼


```python
train['dist_ss'] = train['location'].apply(lambda x: geopy.distance.geodesic( x, coords_seongsan).km)
```


```python
train['center_name'] = train[['dist_jj', 'dist_sp', 'dist_gs', 'dist_ss']].apply(lambda row: ['dist_jj', 'dist_sp', 'dist_gs', 'dist_ss'][row.argmin()][5:], axis=1)
```

> 해당 정류장과 가장 가까운 거리에 있는 곳 이름(제주/서귀포/고산/성산) 지정

test 데이터도 같은 방식으로 진행


```python
#location컬럼 생성.
test['location'] = test.apply(lambda row: (row.latitude, row.longitude), axis=1)

#정류장 위치 확인
data_loc=test[['location','station_name']].drop_duplicates(keep='first')

#제주시
test['dist_jj'] = test['location'].apply(lambda x: geopy.distance.geodesic( x, coords_jejusi).km)
#서귀포시
test['dist_sp'] = test['location'].apply(lambda x: geopy.distance.geodesic( x, coords_seoquipo).km)
#고산
test['dist_gs'] = test['location'].apply(lambda x: geopy.distance.geodesic( x, coords_gosan).km)
#성산
test['dist_ss'] = test['location'].apply(lambda x: geopy.distance.geodesic( x, coords_seongsan).km)

test['center_name'] = test[['dist_jj', 'dist_sp', 'dist_gs', 'dist_ss']].apply(lambda row: ['dist_jj', 'dist_sp', 'dist_gs', 'dist_ss'][row.argmin()][5:], axis=1)
```

## 시간대별 승하차 인원수 컬럼

상관관계 그래프에서 <font color="3399FF">"18~20_ride"</font> 와 상관관계를 보이는 컬럼을 확인했다.
<br/> 바로, 오전 8시에서 11시 59분 사이의 승차인원이다.
<br/><font color="grey">BaseLine 중급 코드 참고

우선, 1시간 단위로 나뉜 것을 2시간 단위로 묶어주었다.


```python
#train 데이터
#승차
train['68a']=train['6~7_ride']+train['7~8_ride']
train['810a']=train['8~9_ride']+train['9~10_ride']
train['1012a']=train['10~11_ride']+train['11~12_ride']

#하차
train['68b']=train['6~7_takeoff']+train['7~8_takeoff']
train['810b']=train['8~9_takeoff']+train['9~10_takeoff']
train['1012b']=train['10~11_takeoff']+train['11~12_takeoff']
```


```python
#test데이터
#승차
test['68a']=test['6~7_ride']+test['7~8_ride']
test['810a']=test['8~9_ride']+test['9~10_ride']
test['1012a']=test['10~11_ride']+test['11~12_ride']

#하차
test['68b']=test['6~7_takeoff']+test['7~8_takeoff']
test['810b']=test['8~9_takeoff']+test['9~10_takeoff']
test['1012b']=test['10~11_takeoff']+test['11~12_takeoff']
```

각 시간대별 승하차한 컬럼들만 모아서 데이터프레임 생성


```python
train_time = train[['68a','810a','1012a','68b','810b','1012b','18~20_ride']]
train_time
```





  <div id="df-da713220-ad49-4198-a3fd-bfc9781d6cea">
    <div class="colab-df-container">
      <div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>68a</th>
      <th>810a</th>
      <th>1012a</th>
      <th>68b</th>
      <th>810b</th>
      <th>1012b</th>
      <th>18~20_ride</th>
    </tr>
    <tr>
      <th>id</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1.0</td>
      <td>7.0</td>
      <td>8.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>5.0</td>
      <td>6.0</td>
      <td>11.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>5.0</td>
    </tr>
    <tr>
      <th>2</th>
      <td>2.0</td>
      <td>2.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>2.0</td>
    </tr>
    <tr>
      <th>3</th>
      <td>17.0</td>
      <td>32.0</td>
      <td>30.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>53.0</td>
    </tr>
    <tr>
      <th>4</th>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>1.0</td>
      <td>0.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>415418</th>
      <td>4.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>415419</th>
      <td>4.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>415420</th>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>1.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>415421</th>
      <td>1.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>415422</th>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>4.0</td>
      <td>0.0</td>
      <td>0.0</td>
    </tr>
  </tbody>
</table>
<p>415423 rows × 7 columns</p>
</div>
      <button class="colab-df-convert" onclick="convertToInteractive('df-da713220-ad49-4198-a3fd-bfc9781d6cea')"
              title="Convert this dataframe to an interactive table."
              style="display:none;">

  <svg xmlns="http://www.w3.org/2000/svg" height="24px"viewBox="0 0 24 24"
       width="24px">
    <path d="M0 0h24v24H0V0z" fill="none"/>
    <path d="M18.56 5.44l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94zm-11 1L8.5 8.5l.94-2.06 2.06-.94-2.06-.94L8.5 2.5l-.94 2.06-2.06.94zm10 10l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94z"/><path d="M17.41 7.96l-1.37-1.37c-.4-.4-.92-.59-1.43-.59-.52 0-1.04.2-1.43.59L10.3 9.45l-7.72 7.72c-.78.78-.78 2.05 0 2.83L4 21.41c.39.39.9.59 1.41.59.51 0 1.02-.2 1.41-.59l7.78-7.78 2.81-2.81c.8-.78.8-2.07 0-2.86zM5.41 20L4 18.59l7.72-7.72 1.47 1.35L5.41 20z"/>
  </svg>
      </button>

  <style>
    .colab-df-container {
      display:flex;
      flex-wrap:wrap;
      gap: 12px;
    }

    .colab-df-convert {
      background-color: #E8F0FE;
      border: none;
      border-radius: 50%;
      cursor: pointer;
      display: none;
      fill: #1967D2;
      height: 32px;
      padding: 0 0 0 0;
      width: 32px;
    }

    .colab-df-convert:hover {
      background-color: #E2EBFA;
      box-shadow: 0px 1px 2px rgba(60, 64, 67, 0.3), 0px 1px 3px 1px rgba(60, 64, 67, 0.15);
      fill: #174EA6;
    }

    [theme=dark] .colab-df-convert {
      background-color: #3B4455;
      fill: #D2E3FC;
    }

    [theme=dark] .colab-df-convert:hover {
      background-color: #434B5C;
      box-shadow: 0px 1px 3px 1px rgba(0, 0, 0, 0.15);
      filter: drop-shadow(0px 1px 2px rgba(0, 0, 0, 0.3));
      fill: #FFFFFF;
    }
  </style>

      <script>
        const buttonEl =
          document.querySelector('#df-da713220-ad49-4198-a3fd-bfc9781d6cea button.colab-df-convert');
        buttonEl.style.display =
          google.colab.kernel.accessAllowed ? 'block' : 'none';

        async function convertToInteractive(key) {
          const element = document.querySelector('#df-da713220-ad49-4198-a3fd-bfc9781d6cea');
          const dataTable =
            await google.colab.kernel.invokeFunction('convertToInteractive',
                                                     [key], {});
          if (!dataTable) return;

          const docLinkHtml = 'Like what you see? Visit the ' +
            '<a target="_blank" href=https://colab.research.google.com/notebooks/data_table.ipynb>data table notebook</a>'
            + ' to learn more about interactive tables.';
          element.innerHTML = '';
          dataTable['output_type'] = 'display_data';
          await google.colab.output.renderOutput(dataTable, element);
          const docLink = document.createElement('div');
          docLink.innerHTML = docLinkHtml;
          element.appendChild(docLink);
        }
      </script>
    </div>
  </div>




시각화를 통한 상관관계 분석


```python
time_cor = round(train_time.corr(), 3)
time_cor
```





  <div id="df-b46439eb-d6f9-4ad7-a8aa-7fbf6cd3c0e8">
    <div class="colab-df-container">
      <div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>68a</th>
      <th>810a</th>
      <th>1012a</th>
      <th>68b</th>
      <th>810b</th>
      <th>1012b</th>
      <th>18~20_ride</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>68a</th>
      <td>1.000</td>
      <td>0.549</td>
      <td>0.472</td>
      <td>0.172</td>
      <td>0.121</td>
      <td>0.127</td>
      <td>0.394</td>
    </tr>
    <tr>
      <th>810a</th>
      <td>0.549</td>
      <td>1.000</td>
      <td>0.640</td>
      <td>0.174</td>
      <td>0.347</td>
      <td>0.282</td>
      <td>0.538</td>
    </tr>
    <tr>
      <th>1012a</th>
      <td>0.472</td>
      <td>0.640</td>
      <td>1.000</td>
      <td>0.200</td>
      <td>0.313</td>
      <td>0.416</td>
      <td>0.617</td>
    </tr>
    <tr>
      <th>68b</th>
      <td>0.172</td>
      <td>0.174</td>
      <td>0.200</td>
      <td>1.000</td>
      <td>0.471</td>
      <td>0.398</td>
      <td>0.253</td>
    </tr>
    <tr>
      <th>810b</th>
      <td>0.121</td>
      <td>0.347</td>
      <td>0.313</td>
      <td>0.471</td>
      <td>1.000</td>
      <td>0.641</td>
      <td>0.335</td>
    </tr>
    <tr>
      <th>1012b</th>
      <td>0.127</td>
      <td>0.282</td>
      <td>0.416</td>
      <td>0.398</td>
      <td>0.641</td>
      <td>1.000</td>
      <td>0.344</td>
    </tr>
    <tr>
      <th>18~20_ride</th>
      <td>0.394</td>
      <td>0.538</td>
      <td>0.617</td>
      <td>0.253</td>
      <td>0.335</td>
      <td>0.344</td>
      <td>1.000</td>
    </tr>
  </tbody>
</table>
</div>
      <button class="colab-df-convert" onclick="convertToInteractive('df-b46439eb-d6f9-4ad7-a8aa-7fbf6cd3c0e8')"
              title="Convert this dataframe to an interactive table."
              style="display:none;">

  <svg xmlns="http://www.w3.org/2000/svg" height="24px"viewBox="0 0 24 24"
       width="24px">
    <path d="M0 0h24v24H0V0z" fill="none"/>
    <path d="M18.56 5.44l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94zm-11 1L8.5 8.5l.94-2.06 2.06-.94-2.06-.94L8.5 2.5l-.94 2.06-2.06.94zm10 10l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94z"/><path d="M17.41 7.96l-1.37-1.37c-.4-.4-.92-.59-1.43-.59-.52 0-1.04.2-1.43.59L10.3 9.45l-7.72 7.72c-.78.78-.78 2.05 0 2.83L4 21.41c.39.39.9.59 1.41.59.51 0 1.02-.2 1.41-.59l7.78-7.78 2.81-2.81c.8-.78.8-2.07 0-2.86zM5.41 20L4 18.59l7.72-7.72 1.47 1.35L5.41 20z"/>
  </svg>
      </button>

  <style>
    .colab-df-container {
      display:flex;
      flex-wrap:wrap;
      gap: 12px;
    }

    .colab-df-convert {
      background-color: #E8F0FE;
      border: none;
      border-radius: 50%;
      cursor: pointer;
      display: none;
      fill: #1967D2;
      height: 32px;
      padding: 0 0 0 0;
      width: 32px;
    }

    .colab-df-convert:hover {
      background-color: #E2EBFA;
      box-shadow: 0px 1px 2px rgba(60, 64, 67, 0.3), 0px 1px 3px 1px rgba(60, 64, 67, 0.15);
      fill: #174EA6;
    }

    [theme=dark] .colab-df-convert {
      background-color: #3B4455;
      fill: #D2E3FC;
    }

    [theme=dark] .colab-df-convert:hover {
      background-color: #434B5C;
      box-shadow: 0px 1px 3px 1px rgba(0, 0, 0, 0.15);
      filter: drop-shadow(0px 1px 2px rgba(0, 0, 0, 0.3));
      fill: #FFFFFF;
    }
  </style>

      <script>
        const buttonEl =
          document.querySelector('#df-b46439eb-d6f9-4ad7-a8aa-7fbf6cd3c0e8 button.colab-df-convert');
        buttonEl.style.display =
          google.colab.kernel.accessAllowed ? 'block' : 'none';

        async function convertToInteractive(key) {
          const element = document.querySelector('#df-b46439eb-d6f9-4ad7-a8aa-7fbf6cd3c0e8');
          const dataTable =
            await google.colab.kernel.invokeFunction('convertToInteractive',
                                                     [key], {});
          if (!dataTable) return;

          const docLinkHtml = 'Like what you see? Visit the ' +
            '<a target="_blank" href=https://colab.research.google.com/notebooks/data_table.ipynb>data table notebook</a>'
            + ' to learn more about interactive tables.';
          element.innerHTML = '';
          dataTable['output_type'] = 'display_data';
          await google.colab.output.renderOutput(dataTable, element);
          const docLink = document.createElement('div');
          docLink.innerHTML = docLinkHtml;
          element.appendChild(docLink);
        }
      </script>
    </div>
  </div>





```python
plt.figure(figsize=(8,5))
sns.set(style="white")

plt.rc('font', family = 'NanumBarunGothic')
plt.title('Arrive and Leave Correlation', size=20)
palette = sns.color_palette('twilight') + sns.color_palette('bright')
cmap = sns.diverging_palette(200,10,as_cmap=True)

mask = np.zeros_like(time_cor, dtype=np.bool)
mask[np.triu_indices_from(mask)] = True

# 히트맵을 그린다.
heatmap2 = sns.heatmap(time_cor,
            annot=True,
            mask=mask, 
            cmap=cmap,
            linewidth=.5,
            cbar_kws={"shrink": .5},
            vmin = -1, vmax = 1)

sns.set(font_scale = 1.0)
heatmap2.set_xticklabels(heatmap2.get_xmajorticklabels(),fontsize = 14)
heatmap2.set_yticklabels(heatmap2.get_ymajorticklabels(),fontsize = 14)

plt.xticks(rotation=45)

plt.show()
```


    
![png](/data/2023-02-05-Bus/output_101_0.png)
    


## 날씨 데이터 추가(외부 데이터)


```python
weather = pd.read_csv('/content/drive/MyDrive/jeju_weather.csv', encoding = 'cp949')
weather.head()
```





  <div id="df-4706d166-3abf-484c-ac1c-c789ce1f416d">
    <div class="colab-df-container">
      <div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>지점</th>
      <th>지점명</th>
      <th>일시</th>
      <th>기온(°C)</th>
      <th>강수량(mm)</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>184</td>
      <td>제주</td>
      <td>2019-09-01 00:00</td>
      <td>23.7</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>1</th>
      <td>184</td>
      <td>제주</td>
      <td>2019-09-01 01:00</td>
      <td>23.7</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>2</th>
      <td>184</td>
      <td>제주</td>
      <td>2019-09-01 02:00</td>
      <td>23.5</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>3</th>
      <td>184</td>
      <td>제주</td>
      <td>2019-09-01 03:00</td>
      <td>23.4</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>4</th>
      <td>184</td>
      <td>제주</td>
      <td>2019-09-01 04:00</td>
      <td>23.4</td>
      <td>NaN</td>
    </tr>
  </tbody>
</table>
</div>
      <button class="colab-df-convert" onclick="convertToInteractive('df-4706d166-3abf-484c-ac1c-c789ce1f416d')"
              title="Convert this dataframe to an interactive table."
              style="display:none;">

  <svg xmlns="http://www.w3.org/2000/svg" height="24px"viewBox="0 0 24 24"
       width="24px">
    <path d="M0 0h24v24H0V0z" fill="none"/>
    <path d="M18.56 5.44l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94zm-11 1L8.5 8.5l.94-2.06 2.06-.94-2.06-.94L8.5 2.5l-.94 2.06-2.06.94zm10 10l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94z"/><path d="M17.41 7.96l-1.37-1.37c-.4-.4-.92-.59-1.43-.59-.52 0-1.04.2-1.43.59L10.3 9.45l-7.72 7.72c-.78.78-.78 2.05 0 2.83L4 21.41c.39.39.9.59 1.41.59.51 0 1.02-.2 1.41-.59l7.78-7.78 2.81-2.81c.8-.78.8-2.07 0-2.86zM5.41 20L4 18.59l7.72-7.72 1.47 1.35L5.41 20z"/>
  </svg>
      </button>

  <style>
    .colab-df-container {
      display:flex;
      flex-wrap:wrap;
      gap: 12px;
    }

    .colab-df-convert {
      background-color: #E8F0FE;
      border: none;
      border-radius: 50%;
      cursor: pointer;
      display: none;
      fill: #1967D2;
      height: 32px;
      padding: 0 0 0 0;
      width: 32px;
    }

    .colab-df-convert:hover {
      background-color: #E2EBFA;
      box-shadow: 0px 1px 2px rgba(60, 64, 67, 0.3), 0px 1px 3px 1px rgba(60, 64, 67, 0.15);
      fill: #174EA6;
    }

    [theme=dark] .colab-df-convert {
      background-color: #3B4455;
      fill: #D2E3FC;
    }

    [theme=dark] .colab-df-convert:hover {
      background-color: #434B5C;
      box-shadow: 0px 1px 3px 1px rgba(0, 0, 0, 0.15);
      filter: drop-shadow(0px 1px 2px rgba(0, 0, 0, 0.3));
      fill: #FFFFFF;
    }
  </style>

      <script>
        const buttonEl =
          document.querySelector('#df-4706d166-3abf-484c-ac1c-c789ce1f416d button.colab-df-convert');
        buttonEl.style.display =
          google.colab.kernel.accessAllowed ? 'block' : 'none';

        async function convertToInteractive(key) {
          const element = document.querySelector('#df-4706d166-3abf-484c-ac1c-c789ce1f416d');
          const dataTable =
            await google.colab.kernel.invokeFunction('convertToInteractive',
                                                     [key], {});
          if (!dataTable) return;

          const docLinkHtml = 'Like what you see? Visit the ' +
            '<a target="_blank" href=https://colab.research.google.com/notebooks/data_table.ipynb>data table notebook</a>'
            + ' to learn more about interactive tables.';
          element.innerHTML = '';
          dataTable['output_type'] = 'display_data';
          await google.colab.output.renderOutput(dataTable, element);
          const docLink = document.createElement('div');
          docLink.innerHTML = docLinkHtml;
          element.appendChild(docLink);
        }
      </script>
    </div>
  </div>





```python
weather = weather.drop(['지점', '지점명'], axis = 1)
weather.columns = ['date','temp','precipitation']
weather.head()
```





  <div id="df-58cecfb6-2f22-4b1f-85ad-3e2d01140db4">
    <div class="colab-df-container">
      <div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>date</th>
      <th>temp</th>
      <th>precipitation</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>2019-09-01 00:00</td>
      <td>23.7</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>1</th>
      <td>2019-09-01 01:00</td>
      <td>23.7</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>2</th>
      <td>2019-09-01 02:00</td>
      <td>23.5</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>3</th>
      <td>2019-09-01 03:00</td>
      <td>23.4</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>4</th>
      <td>2019-09-01 04:00</td>
      <td>23.4</td>
      <td>NaN</td>
    </tr>
  </tbody>
</table>
</div>
      <button class="colab-df-convert" onclick="convertToInteractive('df-58cecfb6-2f22-4b1f-85ad-3e2d01140db4')"
              title="Convert this dataframe to an interactive table."
              style="display:none;">

  <svg xmlns="http://www.w3.org/2000/svg" height="24px"viewBox="0 0 24 24"
       width="24px">
    <path d="M0 0h24v24H0V0z" fill="none"/>
    <path d="M18.56 5.44l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94zm-11 1L8.5 8.5l.94-2.06 2.06-.94-2.06-.94L8.5 2.5l-.94 2.06-2.06.94zm10 10l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94z"/><path d="M17.41 7.96l-1.37-1.37c-.4-.4-.92-.59-1.43-.59-.52 0-1.04.2-1.43.59L10.3 9.45l-7.72 7.72c-.78.78-.78 2.05 0 2.83L4 21.41c.39.39.9.59 1.41.59.51 0 1.02-.2 1.41-.59l7.78-7.78 2.81-2.81c.8-.78.8-2.07 0-2.86zM5.41 20L4 18.59l7.72-7.72 1.47 1.35L5.41 20z"/>
  </svg>
      </button>

  <style>
    .colab-df-container {
      display:flex;
      flex-wrap:wrap;
      gap: 12px;
    }

    .colab-df-convert {
      background-color: #E8F0FE;
      border: none;
      border-radius: 50%;
      cursor: pointer;
      display: none;
      fill: #1967D2;
      height: 32px;
      padding: 0 0 0 0;
      width: 32px;
    }

    .colab-df-convert:hover {
      background-color: #E2EBFA;
      box-shadow: 0px 1px 2px rgba(60, 64, 67, 0.3), 0px 1px 3px 1px rgba(60, 64, 67, 0.15);
      fill: #174EA6;
    }

    [theme=dark] .colab-df-convert {
      background-color: #3B4455;
      fill: #D2E3FC;
    }

    [theme=dark] .colab-df-convert:hover {
      background-color: #434B5C;
      box-shadow: 0px 1px 3px 1px rgba(0, 0, 0, 0.15);
      filter: drop-shadow(0px 1px 2px rgba(0, 0, 0, 0.3));
      fill: #FFFFFF;
    }
  </style>

      <script>
        const buttonEl =
          document.querySelector('#df-58cecfb6-2f22-4b1f-85ad-3e2d01140db4 button.colab-df-convert');
        buttonEl.style.display =
          google.colab.kernel.accessAllowed ? 'block' : 'none';

        async function convertToInteractive(key) {
          const element = document.querySelector('#df-58cecfb6-2f22-4b1f-85ad-3e2d01140db4');
          const dataTable =
            await google.colab.kernel.invokeFunction('convertToInteractive',
                                                     [key], {});
          if (!dataTable) return;

          const docLinkHtml = 'Like what you see? Visit the ' +
            '<a target="_blank" href=https://colab.research.google.com/notebooks/data_table.ipynb>data table notebook</a>'
            + ' to learn more about interactive tables.';
          element.innerHTML = '';
          dataTable['output_type'] = 'display_data';
          await google.colab.output.renderOutput(dataTable, element);
          const docLink = document.createElement('div');
          docLink.innerHTML = docLinkHtml;
          element.appendChild(docLink);
        }
      </script>
    </div>
  </div>





```python
weather['date'] = pd.to_datetime(weather['date'])
weather['hour'] = weather['date'].dt.hour
weather['date'] = weather['date'].dt.date

weather.tail()
```





  <div id="df-327e282c-2e01-4853-81a0-a7ccfca82b1c">
    <div class="colab-df-container">
      <div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>date</th>
      <th>temp</th>
      <th>precipitation</th>
      <th>hour</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>4411</th>
      <td>2019-10-16</td>
      <td>17.8</td>
      <td>NaN</td>
      <td>19</td>
    </tr>
    <tr>
      <th>4412</th>
      <td>2019-10-16</td>
      <td>17.0</td>
      <td>NaN</td>
      <td>20</td>
    </tr>
    <tr>
      <th>4413</th>
      <td>2019-10-16</td>
      <td>16.6</td>
      <td>NaN</td>
      <td>21</td>
    </tr>
    <tr>
      <th>4414</th>
      <td>2019-10-16</td>
      <td>15.8</td>
      <td>NaN</td>
      <td>22</td>
    </tr>
    <tr>
      <th>4415</th>
      <td>2019-10-16</td>
      <td>15.9</td>
      <td>NaN</td>
      <td>23</td>
    </tr>
  </tbody>
</table>
</div>
      <button class="colab-df-convert" onclick="convertToInteractive('df-327e282c-2e01-4853-81a0-a7ccfca82b1c')"
              title="Convert this dataframe to an interactive table."
              style="display:none;">

  <svg xmlns="http://www.w3.org/2000/svg" height="24px"viewBox="0 0 24 24"
       width="24px">
    <path d="M0 0h24v24H0V0z" fill="none"/>
    <path d="M18.56 5.44l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94zm-11 1L8.5 8.5l.94-2.06 2.06-.94-2.06-.94L8.5 2.5l-.94 2.06-2.06.94zm10 10l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94z"/><path d="M17.41 7.96l-1.37-1.37c-.4-.4-.92-.59-1.43-.59-.52 0-1.04.2-1.43.59L10.3 9.45l-7.72 7.72c-.78.78-.78 2.05 0 2.83L4 21.41c.39.39.9.59 1.41.59.51 0 1.02-.2 1.41-.59l7.78-7.78 2.81-2.81c.8-.78.8-2.07 0-2.86zM5.41 20L4 18.59l7.72-7.72 1.47 1.35L5.41 20z"/>
  </svg>
      </button>

  <style>
    .colab-df-container {
      display:flex;
      flex-wrap:wrap;
      gap: 12px;
    }

    .colab-df-convert {
      background-color: #E8F0FE;
      border: none;
      border-radius: 50%;
      cursor: pointer;
      display: none;
      fill: #1967D2;
      height: 32px;
      padding: 0 0 0 0;
      width: 32px;
    }

    .colab-df-convert:hover {
      background-color: #E2EBFA;
      box-shadow: 0px 1px 2px rgba(60, 64, 67, 0.3), 0px 1px 3px 1px rgba(60, 64, 67, 0.15);
      fill: #174EA6;
    }

    [theme=dark] .colab-df-convert {
      background-color: #3B4455;
      fill: #D2E3FC;
    }

    [theme=dark] .colab-df-convert:hover {
      background-color: #434B5C;
      box-shadow: 0px 1px 3px 1px rgba(0, 0, 0, 0.15);
      filter: drop-shadow(0px 1px 2px rgba(0, 0, 0, 0.3));
      fill: #FFFFFF;
    }
  </style>

      <script>
        const buttonEl =
          document.querySelector('#df-327e282c-2e01-4853-81a0-a7ccfca82b1c button.colab-df-convert');
        buttonEl.style.display =
          google.colab.kernel.accessAllowed ? 'block' : 'none';

        async function convertToInteractive(key) {
          const element = document.querySelector('#df-327e282c-2e01-4853-81a0-a7ccfca82b1c');
          const dataTable =
            await google.colab.kernel.invokeFunction('convertToInteractive',
                                                     [key], {});
          if (!dataTable) return;

          const docLinkHtml = 'Like what you see? Visit the ' +
            '<a target="_blank" href=https://colab.research.google.com/notebooks/data_table.ipynb>data table notebook</a>'
            + ' to learn more about interactive tables.';
          element.innerHTML = '';
          dataTable['output_type'] = 'display_data';
          await google.colab.output.renderOutput(dataTable, element);
          const docLink = document.createElement('div');
          docLink.innerHTML = docLinkHtml;
          element.appendChild(docLink);
        }
      </script>
    </div>
  </div>





```python
# 오전 6시 ~ 12시까지의 강수량, 기온을 피쳐로 사용
weather = weather[(weather['hour']>=6)&(weather['hour']<=12)].reset_index(drop=True)
weather = weather.groupby('date')[['precipitation', 'temp']].sum().reset_index()
weather
```





  <div id="df-d1cc8973-8ce1-4b94-b5f2-e57fe00f4b1c">
    <div class="colab-df-container">
      <div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>date</th>
      <th>precipitation</th>
      <th>temp</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>2019-09-01</td>
      <td>0.0</td>
      <td>674.4</td>
    </tr>
    <tr>
      <th>1</th>
      <td>2019-09-02</td>
      <td>92.5</td>
      <td>675.1</td>
    </tr>
    <tr>
      <th>2</th>
      <td>2019-09-03</td>
      <td>37.2</td>
      <td>686.1</td>
    </tr>
    <tr>
      <th>3</th>
      <td>2019-09-04</td>
      <td>133.4</td>
      <td>683.9</td>
    </tr>
    <tr>
      <th>4</th>
      <td>2019-09-05</td>
      <td>7.2</td>
      <td>731.5</td>
    </tr>
    <tr>
      <th>5</th>
      <td>2019-09-06</td>
      <td>3.7</td>
      <td>757.0</td>
    </tr>
    <tr>
      <th>6</th>
      <td>2019-09-07</td>
      <td>1.6</td>
      <td>735.8</td>
    </tr>
    <tr>
      <th>7</th>
      <td>2019-09-08</td>
      <td>10.0</td>
      <td>688.0</td>
    </tr>
    <tr>
      <th>8</th>
      <td>2019-09-09</td>
      <td>42.5</td>
      <td>753.3</td>
    </tr>
    <tr>
      <th>9</th>
      <td>2019-09-10</td>
      <td>0.0</td>
      <td>744.4</td>
    </tr>
    <tr>
      <th>10</th>
      <td>2019-09-11</td>
      <td>6.2</td>
      <td>748.6</td>
    </tr>
    <tr>
      <th>11</th>
      <td>2019-09-12</td>
      <td>0.6</td>
      <td>703.3</td>
    </tr>
    <tr>
      <th>12</th>
      <td>2019-09-13</td>
      <td>0.0</td>
      <td>673.2</td>
    </tr>
    <tr>
      <th>13</th>
      <td>2019-09-14</td>
      <td>0.0</td>
      <td>680.0</td>
    </tr>
    <tr>
      <th>14</th>
      <td>2019-09-15</td>
      <td>0.0</td>
      <td>698.6</td>
    </tr>
    <tr>
      <th>15</th>
      <td>2019-09-16</td>
      <td>0.0</td>
      <td>688.4</td>
    </tr>
    <tr>
      <th>16</th>
      <td>2019-09-17</td>
      <td>0.0</td>
      <td>669.7</td>
    </tr>
    <tr>
      <th>17</th>
      <td>2019-09-18</td>
      <td>0.0</td>
      <td>660.7</td>
    </tr>
    <tr>
      <th>18</th>
      <td>2019-09-19</td>
      <td>0.0</td>
      <td>658.7</td>
    </tr>
    <tr>
      <th>19</th>
      <td>2019-09-20</td>
      <td>0.0</td>
      <td>642.6</td>
    </tr>
    <tr>
      <th>20</th>
      <td>2019-09-21</td>
      <td>72.9</td>
      <td>567.7</td>
    </tr>
    <tr>
      <th>21</th>
      <td>2019-09-22</td>
      <td>129.9</td>
      <td>576.1</td>
    </tr>
    <tr>
      <th>22</th>
      <td>2019-09-23</td>
      <td>0.1</td>
      <td>577.2</td>
    </tr>
    <tr>
      <th>23</th>
      <td>2019-09-24</td>
      <td>0.0</td>
      <td>582.9</td>
    </tr>
    <tr>
      <th>24</th>
      <td>2019-09-25</td>
      <td>0.0</td>
      <td>612.3</td>
    </tr>
    <tr>
      <th>25</th>
      <td>2019-09-26</td>
      <td>1.1</td>
      <td>665.9</td>
    </tr>
    <tr>
      <th>26</th>
      <td>2019-09-27</td>
      <td>2.6</td>
      <td>688.2</td>
    </tr>
    <tr>
      <th>27</th>
      <td>2019-09-28</td>
      <td>0.0</td>
      <td>700.6</td>
    </tr>
    <tr>
      <th>28</th>
      <td>2019-09-29</td>
      <td>0.0</td>
      <td>688.5</td>
    </tr>
    <tr>
      <th>29</th>
      <td>2019-09-30</td>
      <td>0.0</td>
      <td>678.4</td>
    </tr>
    <tr>
      <th>30</th>
      <td>2019-10-01</td>
      <td>3.2</td>
      <td>690.6</td>
    </tr>
    <tr>
      <th>31</th>
      <td>2019-10-02</td>
      <td>225.2</td>
      <td>703.4</td>
    </tr>
    <tr>
      <th>32</th>
      <td>2019-10-03</td>
      <td>0.5</td>
      <td>662.0</td>
    </tr>
    <tr>
      <th>33</th>
      <td>2019-10-04</td>
      <td>0.0</td>
      <td>664.5</td>
    </tr>
    <tr>
      <th>34</th>
      <td>2019-10-05</td>
      <td>0.0</td>
      <td>615.2</td>
    </tr>
    <tr>
      <th>35</th>
      <td>2019-10-06</td>
      <td>1.3</td>
      <td>598.2</td>
    </tr>
    <tr>
      <th>36</th>
      <td>2019-10-07</td>
      <td>4.5</td>
      <td>637.0</td>
    </tr>
    <tr>
      <th>37</th>
      <td>2019-10-08</td>
      <td>0.0</td>
      <td>569.2</td>
    </tr>
    <tr>
      <th>38</th>
      <td>2019-10-09</td>
      <td>0.0</td>
      <td>502.7</td>
    </tr>
    <tr>
      <th>39</th>
      <td>2019-10-10</td>
      <td>0.0</td>
      <td>530.9</td>
    </tr>
    <tr>
      <th>40</th>
      <td>2019-10-11</td>
      <td>0.0</td>
      <td>588.0</td>
    </tr>
    <tr>
      <th>41</th>
      <td>2019-10-12</td>
      <td>0.0</td>
      <td>607.6</td>
    </tr>
    <tr>
      <th>42</th>
      <td>2019-10-13</td>
      <td>0.0</td>
      <td>549.9</td>
    </tr>
    <tr>
      <th>43</th>
      <td>2019-10-14</td>
      <td>0.0</td>
      <td>546.2</td>
    </tr>
    <tr>
      <th>44</th>
      <td>2019-10-15</td>
      <td>4.3</td>
      <td>490.0</td>
    </tr>
    <tr>
      <th>45</th>
      <td>2019-10-16</td>
      <td>0.0</td>
      <td>525.6</td>
    </tr>
  </tbody>
</table>
</div>
      <button class="colab-df-convert" onclick="convertToInteractive('df-d1cc8973-8ce1-4b94-b5f2-e57fe00f4b1c')"
              title="Convert this dataframe to an interactive table."
              style="display:none;">

  <svg xmlns="http://www.w3.org/2000/svg" height="24px"viewBox="0 0 24 24"
       width="24px">
    <path d="M0 0h24v24H0V0z" fill="none"/>
    <path d="M18.56 5.44l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94zm-11 1L8.5 8.5l.94-2.06 2.06-.94-2.06-.94L8.5 2.5l-.94 2.06-2.06.94zm10 10l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94z"/><path d="M17.41 7.96l-1.37-1.37c-.4-.4-.92-.59-1.43-.59-.52 0-1.04.2-1.43.59L10.3 9.45l-7.72 7.72c-.78.78-.78 2.05 0 2.83L4 21.41c.39.39.9.59 1.41.59.51 0 1.02-.2 1.41-.59l7.78-7.78 2.81-2.81c.8-.78.8-2.07 0-2.86zM5.41 20L4 18.59l7.72-7.72 1.47 1.35L5.41 20z"/>
  </svg>
      </button>

  <style>
    .colab-df-container {
      display:flex;
      flex-wrap:wrap;
      gap: 12px;
    }

    .colab-df-convert {
      background-color: #E8F0FE;
      border: none;
      border-radius: 50%;
      cursor: pointer;
      display: none;
      fill: #1967D2;
      height: 32px;
      padding: 0 0 0 0;
      width: 32px;
    }

    .colab-df-convert:hover {
      background-color: #E2EBFA;
      box-shadow: 0px 1px 2px rgba(60, 64, 67, 0.3), 0px 1px 3px 1px rgba(60, 64, 67, 0.15);
      fill: #174EA6;
    }

    [theme=dark] .colab-df-convert {
      background-color: #3B4455;
      fill: #D2E3FC;
    }

    [theme=dark] .colab-df-convert:hover {
      background-color: #434B5C;
      box-shadow: 0px 1px 3px 1px rgba(0, 0, 0, 0.15);
      filter: drop-shadow(0px 1px 2px rgba(0, 0, 0, 0.3));
      fill: #FFFFFF;
    }
  </style>

      <script>
        const buttonEl =
          document.querySelector('#df-d1cc8973-8ce1-4b94-b5f2-e57fe00f4b1c button.colab-df-convert');
        buttonEl.style.display =
          google.colab.kernel.accessAllowed ? 'block' : 'none';

        async function convertToInteractive(key) {
          const element = document.querySelector('#df-d1cc8973-8ce1-4b94-b5f2-e57fe00f4b1c');
          const dataTable =
            await google.colab.kernel.invokeFunction('convertToInteractive',
                                                     [key], {});
          if (!dataTable) return;

          const docLinkHtml = 'Like what you see? Visit the ' +
            '<a target="_blank" href=https://colab.research.google.com/notebooks/data_table.ipynb>data table notebook</a>'
            + ' to learn more about interactive tables.';
          element.innerHTML = '';
          dataTable['output_type'] = 'display_data';
          await google.colab.output.renderOutput(dataTable, element);
          const docLink = document.createElement('div');
          docLink.innerHTML = docLinkHtml;
          element.appendChild(docLink);
        }
      </script>
    </div>
  </div>




'date' 컬럼 데이터 타입 datetime 으로 변환


```python
weather['date'] = pd.to_datetime(weather['date'])
```


```python
train['date'] = pd.to_datetime(train['date'])
test['date'] = pd.to_datetime(test['date'])
```

데이터 병합


```python
train = pd.merge(train, weather, on ='date', how='left')
test = pd.merge(test, weather, on ='date', how='left')
```


```python
train = pd.get_dummies(train,columns=['weekday'])
test = pd.get_dummies(test,columns=['weekday'])
```


```python
lbl = LabelEncoder()

cat_cols = ['bus_route_id', 'station_code', 'station_name', 'center_name', 'holiday', 'holiweekend']

for col in tqdm_notebook(cat_cols):
    lbl.fit(train[col])
    train[col] = lbl.transform(train[col])
    
for col in tqdm_notebook(cat_cols):
    lbl.fit(test[col])
    test[col] = lbl.transform(test[col])
```


      0%|          | 0/6 [00:00<?, ?it/s]



      0%|          | 0/6 [00:00<?, ?it/s]



```python
train.head()
```





  <div id="df-2acf04e7-caea-48c4-943f-1c8f90c246bc">
    <div class="colab-df-container">
      <div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>date</th>
      <th>bus_route_id</th>
      <th>in_out</th>
      <th>station_code</th>
      <th>station_name</th>
      <th>latitude</th>
      <th>longitude</th>
      <th>6~7_ride</th>
      <th>7~8_ride</th>
      <th>8~9_ride</th>
      <th>...</th>
      <th>1012b</th>
      <th>precipitation</th>
      <th>temp</th>
      <th>weekday_0</th>
      <th>weekday_1</th>
      <th>weekday_2</th>
      <th>weekday_3</th>
      <th>weekday_4</th>
      <th>weekday_5</th>
      <th>weekday_6</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>2019-09-01</td>
      <td>0</td>
      <td>0</td>
      <td>321</td>
      <td>1481</td>
      <td>33.48990</td>
      <td>126.49373</td>
      <td>0.0</td>
      <td>1.0</td>
      <td>2.0</td>
      <td>...</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>674.4</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
    </tr>
    <tr>
      <th>1</th>
      <td>2019-09-01</td>
      <td>0</td>
      <td>0</td>
      <td>334</td>
      <td>1822</td>
      <td>33.48944</td>
      <td>126.48508</td>
      <td>1.0</td>
      <td>4.0</td>
      <td>4.0</td>
      <td>...</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>674.4</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
    </tr>
    <tr>
      <th>2</th>
      <td>2019-09-01</td>
      <td>0</td>
      <td>0</td>
      <td>407</td>
      <td>1406</td>
      <td>33.48181</td>
      <td>126.47352</td>
      <td>1.0</td>
      <td>1.0</td>
      <td>0.0</td>
      <td>...</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>674.4</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
    </tr>
    <tr>
      <th>3</th>
      <td>2019-09-01</td>
      <td>0</td>
      <td>1</td>
      <td>1440</td>
      <td>1431</td>
      <td>33.50577</td>
      <td>126.49252</td>
      <td>0.0</td>
      <td>17.0</td>
      <td>6.0</td>
      <td>...</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>674.4</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
    </tr>
    <tr>
      <th>4</th>
      <td>2019-09-01</td>
      <td>0</td>
      <td>1</td>
      <td>1501</td>
      <td>1575</td>
      <td>33.25579</td>
      <td>126.41260</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>...</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>674.4</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
    </tr>
  </tbody>
</table>
<p>5 rows × 44 columns</p>
</div>
      <button class="colab-df-convert" onclick="convertToInteractive('df-2acf04e7-caea-48c4-943f-1c8f90c246bc')"
              title="Convert this dataframe to an interactive table."
              style="display:none;">

  <svg xmlns="http://www.w3.org/2000/svg" height="24px"viewBox="0 0 24 24"
       width="24px">
    <path d="M0 0h24v24H0V0z" fill="none"/>
    <path d="M18.56 5.44l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94zm-11 1L8.5 8.5l.94-2.06 2.06-.94-2.06-.94L8.5 2.5l-.94 2.06-2.06.94zm10 10l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94z"/><path d="M17.41 7.96l-1.37-1.37c-.4-.4-.92-.59-1.43-.59-.52 0-1.04.2-1.43.59L10.3 9.45l-7.72 7.72c-.78.78-.78 2.05 0 2.83L4 21.41c.39.39.9.59 1.41.59.51 0 1.02-.2 1.41-.59l7.78-7.78 2.81-2.81c.8-.78.8-2.07 0-2.86zM5.41 20L4 18.59l7.72-7.72 1.47 1.35L5.41 20z"/>
  </svg>
      </button>

  <style>
    .colab-df-container {
      display:flex;
      flex-wrap:wrap;
      gap: 12px;
    }

    .colab-df-convert {
      background-color: #E8F0FE;
      border: none;
      border-radius: 50%;
      cursor: pointer;
      display: none;
      fill: #1967D2;
      height: 32px;
      padding: 0 0 0 0;
      width: 32px;
    }

    .colab-df-convert:hover {
      background-color: #E2EBFA;
      box-shadow: 0px 1px 2px rgba(60, 64, 67, 0.3), 0px 1px 3px 1px rgba(60, 64, 67, 0.15);
      fill: #174EA6;
    }

    [theme=dark] .colab-df-convert {
      background-color: #3B4455;
      fill: #D2E3FC;
    }

    [theme=dark] .colab-df-convert:hover {
      background-color: #434B5C;
      box-shadow: 0px 1px 3px 1px rgba(0, 0, 0, 0.15);
      filter: drop-shadow(0px 1px 2px rgba(0, 0, 0, 0.3));
      fill: #FFFFFF;
    }
  </style>

      <script>
        const buttonEl =
          document.querySelector('#df-2acf04e7-caea-48c4-943f-1c8f90c246bc button.colab-df-convert');
        buttonEl.style.display =
          google.colab.kernel.accessAllowed ? 'block' : 'none';

        async function convertToInteractive(key) {
          const element = document.querySelector('#df-2acf04e7-caea-48c4-943f-1c8f90c246bc');
          const dataTable =
            await google.colab.kernel.invokeFunction('convertToInteractive',
                                                     [key], {});
          if (!dataTable) return;

          const docLinkHtml = 'Like what you see? Visit the ' +
            '<a target="_blank" href=https://colab.research.google.com/notebooks/data_table.ipynb>data table notebook</a>'
            + ' to learn more about interactive tables.';
          element.innerHTML = '';
          dataTable['output_type'] = 'display_data';
          await google.colab.output.renderOutput(dataTable, element);
          const docLink = document.createElement('div');
          docLink.innerHTML = docLinkHtml;
          element.appendChild(docLink);
        }
      </script>
    </div>
  </div>




# 모델링


```python
target_col = '18~20_ride'
train_label = train[target_col]

train2 = train.drop(['date','latitude','longitude','location'], axis=1)
test2 = test.drop(['date','latitude','longitude','location'], axis=1)
```


```python
train2 = train2.drop('18~20_ride', axis=1)
```


```python
train2 = train2.drop(['date_week'], axis = 1)
test2 = test2.drop(['date_week'], axis = 1)
```


```python
test2.info()
```

    <class 'pandas.core.frame.DataFrame'>
    Int64Index: 228170 entries, 0 to 228169
    Data columns (total 38 columns):
     #   Column         Non-Null Count   Dtype  
    ---  ------         --------------   -----  
     0   bus_route_id   228170 non-null  int64  
     1   in_out         228170 non-null  int64  
     2   station_code   228170 non-null  int64  
     3   station_name   228170 non-null  int64  
     4   6~7_ride       228170 non-null  float64
     5   7~8_ride       228170 non-null  float64
     6   8~9_ride       228170 non-null  float64
     7   9~10_ride      228170 non-null  float64
     8   10~11_ride     228170 non-null  float64
     9   11~12_ride     228170 non-null  float64
     10  6~7_takeoff    228170 non-null  float64
     11  7~8_takeoff    228170 non-null  float64
     12  8~9_takeoff    228170 non-null  float64
     13  9~10_takeoff   228170 non-null  float64
     14  10~11_takeoff  228170 non-null  float64
     15  11~12_takeoff  228170 non-null  float64
     16  holiday        228170 non-null  int64  
     17  holiweekend    228170 non-null  int64  
     18  dist_jj        228170 non-null  float64
     19  dist_sp        228170 non-null  float64
     20  dist_gs        228170 non-null  float64
     21  dist_ss        228170 non-null  float64
     22  center_name    228170 non-null  int64  
     23  68a            228170 non-null  float64
     24  810a           228170 non-null  float64
     25  1012a          228170 non-null  float64
     26  68b            228170 non-null  float64
     27  810b           228170 non-null  float64
     28  1012b          228170 non-null  float64
     29  precipitation  228170 non-null  float64
     30  temp           228170 non-null  float64
     31  weekday_0      228170 non-null  uint8  
     32  weekday_1      228170 non-null  uint8  
     33  weekday_2      228170 non-null  uint8  
     34  weekday_3      228170 non-null  uint8  
     35  weekday_4      228170 non-null  uint8  
     36  weekday_5      228170 non-null  uint8  
     37  weekday_6      228170 non-null  uint8  
    dtypes: float64(24), int64(7), uint8(7)
    memory usage: 57.2 MB
    


```python
# 각 모델에 대한 oof 정의
lgbm_oof_train = np.zeros((train2.shape[0]))
lgbm_oof_test = np.zeros((test2.shape[0]))

# Hyperparameter 정의하기
n_splits= 5
NUM_BOOST_ROUND = 10000
SEED = 777
lgbm_param = {'objective':'rmse',
              'boosting_type': 'gbdt',
              'random_state':777,
              'learning_rate':0.1,
              'subsample':0.7,
              'tree_learner': 'serial',
              'colsample_bytree':0.78,
              'early_stopping_rounds':50,
              'subsample_freq': 1,
              'reg_lambda':7,
              'reg_alpha': 5,
              'num_leaves': 96,
              'seed' : SEED
            }

# Kfold 
kfolds = KFold(n_splits=n_splits, random_state=777, shuffle=True)

# Fold별로 학습진행
for ind, (trn_ind, val_ind) in tqdm_notebook(enumerate( kfolds.split( X = train2, y = train_label ) ) ):
    
    # Train/Valid-set을 정의
    X_train , y_train = train2.iloc[trn_ind], train_label[trn_ind]
    X_valid , y_valid = train2.iloc[val_ind], train_label[val_ind]
    
    # Light GBM
    print("---TRAINING---")
    
    # dtrain/dvalid 정의
    dtrain = lgbm.Dataset(X_train, y_train)
    dvalid = lgbm.Dataset(X_valid, y_valid)
    
    # model 정의&학습
    model = lgbm.train(lgbm_param , dtrain, NUM_BOOST_ROUND, 
                       valid_sets=(dtrain, dvalid), 
                       valid_names=('train2','valid'), 
                       verbose_eval= 100)
    
    # local_valid/local_test에 대한 예측
    lgbm_valid_pred = model.predict(X_valid)
    lgbm_test_pred = model.predict(test2)
        
    lgbm_oof_train[val_ind] = lgbm_valid_pred
    lgbm_oof_test += lgbm_test_pred/ n_splits #Fold한 결과 앙상블(평균)
```


    0it [00:00, ?it/s]


    ---TRAINING---
    Training until validation scores don't improve for 50 rounds.
    [100]	train2's rmse: 2.21057	valid's rmse: 2.74281
    [200]	train2's rmse: 1.93736	valid's rmse: 2.66244
    [300]	train2's rmse: 1.78329	valid's rmse: 2.634
    [400]	train2's rmse: 1.67919	valid's rmse: 2.61385
    [500]	train2's rmse: 1.59064	valid's rmse: 2.59649
    [600]	train2's rmse: 1.5184	valid's rmse: 2.58278
    [700]	train2's rmse: 1.45904	valid's rmse: 2.57458
    [800]	train2's rmse: 1.40951	valid's rmse: 2.56977
    [900]	train2's rmse: 1.36554	valid's rmse: 2.56368
    [1000]	train2's rmse: 1.32442	valid's rmse: 2.55946
    [1100]	train2's rmse: 1.28769	valid's rmse: 2.55693
    [1200]	train2's rmse: 1.2546	valid's rmse: 2.55519
    [1300]	train2's rmse: 1.22365	valid's rmse: 2.55211
    Early stopping, best iteration is:
    [1349]	train2's rmse: 1.20935	valid's rmse: 2.55057
    ---TRAINING---
    Training until validation scores don't improve for 50 rounds.
    [100]	train2's rmse: 2.21091	valid's rmse: 2.68397
    [200]	train2's rmse: 1.9522	valid's rmse: 2.62796
    [300]	train2's rmse: 1.80073	valid's rmse: 2.59815
    [400]	train2's rmse: 1.69631	valid's rmse: 2.58086
    [500]	train2's rmse: 1.60544	valid's rmse: 2.56059
    [600]	train2's rmse: 1.53444	valid's rmse: 2.55239
    [700]	train2's rmse: 1.47566	valid's rmse: 2.54488
    [800]	train2's rmse: 1.42496	valid's rmse: 2.5412
    [900]	train2's rmse: 1.3812	valid's rmse: 2.53807
    [1000]	train2's rmse: 1.34058	valid's rmse: 2.53339
    [1100]	train2's rmse: 1.30338	valid's rmse: 2.52975
    [1200]	train2's rmse: 1.27002	valid's rmse: 2.52797
    [1300]	train2's rmse: 1.23978	valid's rmse: 2.52648
    [1400]	train2's rmse: 1.21308	valid's rmse: 2.52524
    [1500]	train2's rmse: 1.18769	valid's rmse: 2.52363
    [1600]	train2's rmse: 1.1618	valid's rmse: 2.52277
    [1700]	train2's rmse: 1.13708	valid's rmse: 2.52116
    [1800]	train2's rmse: 1.11422	valid's rmse: 2.52051
    Early stopping, best iteration is:
    [1774]	train2's rmse: 1.11979	valid's rmse: 2.52012
    ---TRAINING---
    Training until validation scores don't improve for 50 rounds.
    [100]	train2's rmse: 2.20577	valid's rmse: 2.72537
    [200]	train2's rmse: 1.9487	valid's rmse: 2.66496
    [300]	train2's rmse: 1.79206	valid's rmse: 2.62683
    [400]	train2's rmse: 1.68205	valid's rmse: 2.60078
    [500]	train2's rmse: 1.59979	valid's rmse: 2.58725
    [600]	train2's rmse: 1.5298	valid's rmse: 2.57657
    [700]	train2's rmse: 1.4716	valid's rmse: 2.56719
    [800]	train2's rmse: 1.4182	valid's rmse: 2.56077
    [900]	train2's rmse: 1.37316	valid's rmse: 2.55542
    [1000]	train2's rmse: 1.33124	valid's rmse: 2.55125
    [1100]	train2's rmse: 1.29497	valid's rmse: 2.54768
    [1200]	train2's rmse: 1.26177	valid's rmse: 2.54603
    [1300]	train2's rmse: 1.23104	valid's rmse: 2.54285
    [1400]	train2's rmse: 1.2015	valid's rmse: 2.54236
    Early stopping, best iteration is:
    [1381]	train2's rmse: 1.20763	valid's rmse: 2.54183
    ---TRAINING---
    Training until validation scores don't improve for 50 rounds.
    [100]	train2's rmse: 2.2083	valid's rmse: 2.69719
    [200]	train2's rmse: 1.94631	valid's rmse: 2.62542
    [300]	train2's rmse: 1.79368	valid's rmse: 2.59231
    [400]	train2's rmse: 1.68411	valid's rmse: 2.56869
    [500]	train2's rmse: 1.59846	valid's rmse: 2.54939
    [600]	train2's rmse: 1.52783	valid's rmse: 2.53918
    [700]	train2's rmse: 1.46689	valid's rmse: 2.52926
    [800]	train2's rmse: 1.41865	valid's rmse: 2.52554
    [900]	train2's rmse: 1.37519	valid's rmse: 2.52181
    [1000]	train2's rmse: 1.33661	valid's rmse: 2.51866
    [1100]	train2's rmse: 1.29849	valid's rmse: 2.51474
    [1200]	train2's rmse: 1.26464	valid's rmse: 2.51249
    [1300]	train2's rmse: 1.2349	valid's rmse: 2.51056
    Early stopping, best iteration is:
    [1317]	train2's rmse: 1.23001	valid's rmse: 2.5099
    ---TRAINING---
    Training until validation scores don't improve for 50 rounds.
    [100]	train2's rmse: 2.21013	valid's rmse: 2.66212
    [200]	train2's rmse: 1.9534	valid's rmse: 2.61052
    [300]	train2's rmse: 1.80125	valid's rmse: 2.57792
    [400]	train2's rmse: 1.69253	valid's rmse: 2.55715
    [500]	train2's rmse: 1.6075	valid's rmse: 2.542
    [600]	train2's rmse: 1.53874	valid's rmse: 2.5338
    [700]	train2's rmse: 1.48118	valid's rmse: 2.52757
    [800]	train2's rmse: 1.42949	valid's rmse: 2.52508
    Early stopping, best iteration is:
    [770]	train2's rmse: 1.44374	valid's rmse: 2.52421
    


```python
# 전체 데이터로 적용
X_train=train2
y_train=train_label
X_test=test2

X_train.shape, y_train.shape, X_test.shape
```




    ((415423, 38), (415423,), (228170, 38))




```python
submission[target_col] = model.predict(X_test)
```


```python
submission[target_col].head()
```




    id
    415423     3.479912
    415424    10.868182
    415425     3.054823
    415426    35.471219
    415427     1.254349
    Name: 18~20_ride, dtype: float64


